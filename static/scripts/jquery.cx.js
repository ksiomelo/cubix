var SEPARATOR="-",DEFAULT_WIDTH=570,DEFAULT_HEIGHT=500,MAXIMIZED_HEIGHT=1040,MAXIMIZED_WIDTH=800,DEFAULT_ATTR_GRAPH_WIDTH=500,DEFAULT_ATTR_GRAPH_HEIGHT=600,MIN_ANGLE_FOR_LABELS=6,MAX_ENTITY_SIZE=35,DEFAULT_NODE_RADIUS=8,NODE_MAX_SIZE=16,NODE_MIN_SIZE=6,DEFAULT_EDGE_THICKNESS=4,EDGE_MAX_THICK=21,EDGE_MIN_THICK=1,SIZE_STABILITY=2,SIZE_SUPPORT=2,SIZE_DEFAULT=1,LABEL_REPETITIVE="repetitive",LABEL_MULTILABEL="multi-label",SELECTED_FILL_COLOR="#FF0000",DEFAULT_FILL_COLOR="#aaaaff",DEFAULT_OPACITY=0.3;
function getAssociationRules(){$.ajax({url:"/api/v1/",context:document.body}).done(function(){$(this).addClass("done")})}var association_rules,full_association_rules,color_set=d3.scale.category20(),premiseColor="#3B14AF",conclusionColor="#FFD500";
function get_attribute_list(){var b=[],c=[];s=0;for(a in a_rules_concerned_attributes){s++;for(i=0;i<a_rules_concerned_attributes[a].length;i++){t={};t.family=s;if("yes"==a_rules_concerned_attributes[a][i][0])t.text=a.toString(),b.push(t);else if("no"==a_rules_concerned_attributes[a][i][0])continue;else t.text=a.toString()+"-"+a_rules_concerned_attributes[a][i][0],b.push(t);c.push(t.text)}}11>s&&(color_set=d3.scale.category10());return[b,c]}
function fetchAssociationRules(b){if("undefined"==typeof lattice.id||null==lattice.id)flashAlert("The current concept lattice is not saved in the server - could not compute association rules.","error");else if("undefined"!=typeof association_rules)b();else{flashAlert("Calculating association rules, this may take some minutes...");var c=$("input[name=csrfmiddlewaretoken]").val();$.getJSON("/api/v1/association_rules/",{lattice_id:lattice.id,csrfmiddlewaretoken:c},function(c){association_rules=c;for(t=
0;t<association_rules.length;t++)association_rules[t].id="id"+t,association_rules[t].highlighted=!0;hideLoading();if("undefined"!=typeof b){for(i=0;i<filter.history.length;i++){filter.history[i].removedRules=[];arrjs=[];for(j=0;j<association_rules.length;j++){flag=!0;for(k=0;k<association_rules[j].premise.length;k++)association_rules[j].premise[k]==filter.history[i].attr+"-"+filter.history[i].value&&(flag=!1);for(k=0;k<association_rules[j].conclusion.length;k++)association_rules[j].conclusion[k]==
filter.history[i].attr+"-"+filter.history[i].value&&(flag=!1);flag&&(filter.history[i].removedRules.push(association_rules[j]),arrjs.push(j))}for(t=0;t<arrjs.length;t++)association_rules.splice(arrjs[t]-t,1)}full_association_rules||(full_association_rules=association_rules);b();createScatterPlotChart();createRulesList()}})}}
function select_rule(b){if(-1!==prevIndex){updated_prev=!1;for(t=0;!updated_prev;t++)rules_list_chart.series[0].data[t].category==prevIndex&&(rules_list_chart.series[0].data[t].update({color:"#4572A7"},!0,!1),updated_prev=!0)}updated_selection=!1;for(t=0;!updated_selection;t++)rules_list_chart.series[0].data[t].category==b&&(rules_list_chart.series[0].data[t].update({color:"#f00"},!0,!1),updated_selection=!0);"radiagram"==currentVis?d3.select("#chart").select("svg").selectAll("path").style("opacity",
function(c){flag=!1;for(i=0;i<c[0].ids.length;i++)if(c[0].ids[i]==b){flag=!0;break}return flag?0.99:0.1}):"matrixview"==currentVis?d3.select("#chart").select("svg").selectAll(".matrix-row").style("opacity",function(c){return c[0].id==b?0.99:0.05}):"gg_ar_plot"==currentVis&&(d3.select("#chart").select("svg").selectAll("line").style("opacity",function(c){return c[3]==b?0.99:0.1}),d3.select("#chart").select("svg").selectAll("polygon").style("opacity",function(c){return c[3]==b?0.99:0.1}),d3.select("#chart").select("svg").selectAll("circle").style("opacity",
function(c){flag=!1;console.log(c);if(c.ids){for(i=0;i<c.ids.length;i++)if(c.ids[i]==b){flag=!0;break}return flag?0.99:0.1}return 1}));prevIndex=b}
function unselect_all(){if(-1!==prevIndex){for(t=0;t<rules_list_chart.series[0].data.length;t++)if(rules_list_chart.series[0].data[t].category==prevIndex){rules_list_chart.series[0].data[t].update({color:"#4572A7"},!0,!1);break}"radiagram"==currentVis?d3.select("#chart").select("svg").selectAll("path").style("opacity",0.99):"matrixview"==currentVis?d3.select("#chart").select("svg").selectAll(".matrix-row").style("opacity",1):"gg_ar_plot"==currentVis&&(d3.select("#chart").select("svg").selectAll("line").style("opacity",
0.99),d3.select("#chart").select("svg").selectAll("polygon").style("opacity",0.99),d3.select("#chart").select("svg").selectAll("circle").style("opacity",1));prevIndex=-1}}
function addGradient(b,c,e,g){b=b.append("linearGradient").attr("id",function(){return"gradient"+c}).attr("spreadMethod","pad").attr("x1",function(){return e?"0%":"100%"}).attr("y1",function(){return g?"0%":"100%"}).attr("x2",function(){return e?"100%":"0%"}).attr("y2",function(){return g?"100%":"0%"});b.append("svg:stop").attr("offset","0%").attr("stop-color",d3.rgb(premiseColor)).attr("stop-opacity",1);b.append("svg:stop").attr("offset","100%").attr("stop-color",d3.rgb(conclusionColor)).attr("stop-opacity",
1)}function objectJoin(b,c){res="";for(i=0;i<b.length;i++)res+=b[i].text+c;return res.substring(0,res.length-1)}
function initARView(){function b(b){d3.select(this).selectAll(".cell").data(b.filter(function(b){return b.z})).enter().append("rect").attr("class","cell").attr("x",function(b){return b.y*(w-c[1]-1)/g}).attr("width",(w-1-c[1])/g).attr("height",Math.max((h-c[0])/association_rules.length,10)).style("fill-opacity",function(b){return b.confidence}).style("fill",function(b){return 1==b.z?d3.rgb(premiseColor):d3.rgb(conclusionColor)}).on("mouseover",Matrix_View_MouseOver).on("mouseout",Matrix_View_MouseOut).on("click",
function(b){console.log(b.id);select_rule(b.id)})}"undefined"==typeof association_rules&&flashAlert("The association rules couldn't be fetched from the server","error");for(var c=[0,0,0,0],e=[],g=0,p=get_attribute_list(),q=p[1],p=p[0],g=p.length,r=0;r<association_rules.length;r++)e[r]=[],e[r]=d3.range(g).map(function(b){return{x:r,y:b,z:0}});association_rules.sort(function(b,c){for(var e=0;e<q.length;e++){var g=b.premise.indexOf(q[e]),p=c.premise.indexOf(q[e]);if(!(0<=g&&0<=p||0>g&&0>p)){if(0<=g&&
0>p)return-1;if(0>g&&0<=p)return 1}}for(e=0;e<q.length;e++)if(g=b.conclusion.indexOf(q[e]),p=c.conclusion.indexOf(q[e]),!(0<=g&&0<=p||0>g&&0>p))if(0<=g&&0>p)break;else if(0>g&&0<=p)return 1;return-1});for(r=0;r<association_rules.length;r++)for(var v=0;v<g;v++){for(var z=0;z<association_rules[r].premise.length;z++)p[v].text==association_rules[r].premise[z]&&(e[r][v].z=1,e[r][v].confidence=association_rules[r].confidence,e[r][v].premise_supp=association_rules[r].premise_supp,e[r][v].conclusion_supp=
association_rules[r].conclusion_supp,e[r][v].premise=association_rules[r].premise,e[r][v].conclusion=association_rules[r].conclusion,e[r][0].id=association_rules[r].id,e[r][v].id=association_rules[r].id);for(z=0;z<association_rules[r].conclusion.length;z++)p[v].text==association_rules[r].conclusion[z]&&(e[r][v].z=2,e[r][v].confidence=association_rules[r].confidence,e[r][v].premise_supp=association_rules[r].premise_supp,e[r][v].conclusion_supp=association_rules[r].conclusion_supp,e[r][v].premise=association_rules[r].premise,
e[r][v].conclusion=association_rules[r].conclusion,e[r][0].id=association_rules[r].id,e[r][v].id=association_rules[r].id)}for(r=0;r<g;r++)c[0]=Math.max(c[0],p[r].text.length);c[0]*=7;c[1]=20+10*Math.log(association_rules.length)/Math.LN10;v=h<10*association_rules.length+c[0]+c[2]?10*association_rules.length+c[0]+c[2]:h;vis=d3.select("#chart").append("svg:svg").attr("width",w).attr("height",v).append("svg:g").attr("transform","translate("+c[1]+","+c[0]+")");b=vis.selectAll(".matrix-row").data(e).enter().append("g").attr("class",
"matrix-row").attr("id",function(b){return b[0].id}).attr("transform",function(b){return"translate(0,"+b[0].x*Math.max(10,(h-c[0])/association_rules.length)+")"}).each(b);b.append("line").attr("x2",w).attr("y1",Math.max(10,(h-c[0])/association_rules.length)).attr("y2",Math.max(10,(h-c[0])/association_rules.length)).attr("class","matrix_view_separator").style("fill-opacity",0.99);b.append("line").attr("x2",w).attr("class","matrix_view_separator").style("fill-opacity",0.99);b.append("text").attr("x",
0).attr("dy","1em").attr("text-anchor","end").attr("class","label").text(function(b){return b[0].id});e=vis.selectAll(".column").data(p).enter().append("g").attr("class","column").attr("transform",function(b,e){return b[e]?"translate("+e*(w-c[1]-1)/g+")rotate(-90)":"translate(0)rotate(-90)"});e.append("line").attr("x1",Math.min(10*-association_rules.length,-h)).attr("transform",function(b,e){return"translate(0,"+e*(w-c[1]-1)/g+")"}).attr("class","matrix_view_separator");e.append("text").attr("class",
"label").attr("x",0).attr("dy","1em").attr("text-anchor","start").attr("transform",function(b,e){return"translate(12,"+e*(w-c[1]-1)/g+")rotate(+45)"}).style("stroke",function(b,c){return color_set(p[c].family-1)}).text(function(b,c){return p[c].text})}
function Matrix_View_MouseOver(b){d3.selectAll(".matrix-row text").classed("highlighted",function(c,e){return e==b.x});d3.selectAll(".column text").classed("highlighted",function(c,e){return e==b.y});d3.select(this).style("stroke","red");A_rules_box.style("opacity",0);A_rules_box.style("display","block");A_rules_box.transition().delay(800).duration(300).style("opacity",1);A_rules_box.style("left",d3.event.pageX+0+"px").style("top",d3.event.pageY-40+"px").style("width","270px").style("height",11+1.7*
Math.max(b.premise.length,b.conclusion.length)+"em");1==b.z?wrapperElementsInList($("ul.hb_role"),["Antecedent"]):wrapperElementsInList($("ul.hb_role"),["Consequent"]);wrapperElementsInList($("ul.hb_confidence"),[Math.round(100*b.confidence).toString()+"%"]);wrapperElementsInList($("ul.hb_p_support"),b.premise_supp);wrapperElementsInList($("ul.hb_c_support"),b.conclusion_supp);wrapperElementsInList($("ul.hb_premise_list"),b.premise);wrapperElementsInList($("ul.hb_consequence_list"),b.conclusion)}
function Matrix_View_MouseOut(){d3.selectAll("text").classed("highlighted",!1);mouseOverHoverBox||(d3.select(this).style("stroke","none"),A_rules_box.transition().delay(800).duration(200).style("opacity",0),A_rules_box.style("display","none"))}var rx=w/2,ry=h/2,rotate=0;
function initDiagonalARView(){if("undefined"==typeof association_rules)flashAlert("The association rules couldn't be fetched from the server","error");else{flashAlert('Select a rule by clicking on a bar in the "Generated Rules" chart ',"info",5E3);attr_list=get_attribute_list()[0];var b=0,c=0;for(a in context.attributeNames)b++;var b=b+attr_list.length,c=b-attr_list.length,e=[0,120,20,120];for(i=0;i<attr_list.length;i++)e[0]=Math.max(e[0],attr_list[i].text.length);e[0]*=0;vis=d3.select("#chart").append("svg:svg").attr("width",
w).attr("height",h).attr("viewBox","0 0 "+w+" "+h).attr("preserveAspectRatio","xMidYMid").append("svg:g").attr("transform","translate("+w/2+","+h/2+")");var e=[],g=0,p=0,q={children:[],x:0,y:0};s_parent={children:[],name:"<Nothing family>"};s_parent.parent=q;s_parent.x=w/4-50;s_parent.y=0;f={};f.family=p;f.parent=s_parent;f.x=w/2-100;f.y=0;f.name="Nothing";s_parent.children.push(f);e.push(f);g++;g++;c++;b++;for(a in context.attributeNames){var r={children:[]};r.name=a.toString();r.parent=q;r.x=(w/
4-50)*Math.cos(2*p*Math.PI/c);r.y=(w/4-50)*Math.sin(2*p*Math.PI/c);p++;for(i=0;i<context.attributeNames[a].length;i++){var v={};"yes"==context.attributeNames[a][i][0]?(v.family=p,v.parent=r,v.x=(w/2-100)*Math.cos(2*g*Math.PI/b),v.y=(w/2-100)*Math.sin(2*g*Math.PI/b),v.name=a.toString(),r.children.push(v),e.push(v),g++):"no"!=context.attributeNames[a][i][0]&&(v.family=p,v.parent=r,v.x=(w/2-100)*Math.cos(2*g*Math.PI/b),v.y=(w/2-100)*Math.sin(2*g*Math.PI/b),v.name=a.toString()+"-"+context.attributeNames[a][i][0],
g++,e.push(v),r.children.push(v))}q.children.push(r);g++}c=[];for(u=0;u<e.length;u++)for(t=0;t<e.length;t++)if(u!==t){ids=[];confidencies=[];for(l=0;l<association_rules.length;l++)if(0==association_rules[l].premise.length&&0==t)ids.push(association_rules[l].id),confidencies.push(association_rules[l].confidence);else{in_conclusion=in_premise=link_in_rule=!1;for(counter=0;counter<association_rules[l].premise.length;counter++)if(association_rules[l].premise[counter]==e[t].name){in_premise=!0;break}for(counter=
0;counter<association_rules[l].conclusion.length;counter++)if(association_rules[l].conclusion[counter]==e[u].name){in_conclusion=!0;break}if(link_in_rule=in_premise&&in_conclusion)ids.push(association_rules[l].id),confidencies.push(association_rules[l].confidence)}0<ids.length&&(source={},source.parent=e[t].parent,source.ids=ids,source.conf=confidencies,source.x=e[t].x,source.y=e[t].y,target={},target.parent=e[u].parent,target.x=e[u].x,target.y=e[u].y,g={},g.source=source,g.target=target,c.push(g))}d3.layout.cluster().size([2*
Math.PI,500]);m_splines=d3.layout.bundle()(c);c=d3.select("#chart").select("svg").append("defs");addGradient(c,"lt-rb",!0,!0);addGradient(c,"lb-rt",!0,!1);addGradient(c,"rt-lb",!1,!0);addGradient(c,"rb-lt",!1,!1);vis.selectAll("path").data(m_splines).enter().append("path").style("stroke-width",function(b){return 2*d3.max(b[0].conf)+1}).style("fill","none").attr("ids",function(b){return b[0].ids}).attr("confs",function(b){return b[0].conf}).attr("d",function(b){pathinfo=[];for(a=0;a<b.length;a++)point=
{},point.x=b[a].x,point.y=b[a].y,pathinfo.push(point);return d3.svg.line().x(function(b){return b.x}).y(function(b){return b.y}).interpolate("bundle").tension(0.1)(pathinfo)}).style("stroke",function(b){left_to_right=b[0].x>b[b.length-1].x?!1:!0;top_to_bottom=b[0].y>b[b.length-1].y?!1:!0;return left_to_right&&top_to_bottom?"url(#gradientlt-rb)":!left_to_right&&top_to_bottom?"url(#gradientrt-lb)":left_to_right&&!top_to_bottom?"url(#gradientlb-rt)":"url(#gradientrb-lt)"});circle=vis.selectAll("g.node").data(e).enter().append("svg:line").attr("x1",
function(c){return c.x-Math.max(1,(w/2-100)*(Math.PI/(2*b)))}).attr("y1",function(b){return b.y}).attr("x2",function(c){return c.x+Math.max(1,(w/2-100)*(Math.PI/(2*b)))}).attr("y2",function(b){return b.y}).attr("transform",function(b){return"rotate("+180*Math.atan(-1*b.x/b.y)/Math.PI+" "+b.x+" "+b.y+")"}).style("stroke",function(b){return color_set(b.family-1)});text=vis.selectAll("g.node").data(e).enter().append("svg:text").attr("dx",function(b){return 0<b.x?"1em":"-1em"}).attr("dy","0.31em").style("pointer-events",
"none").attr("text-anchor",function(b){return 0<b.x?"start":"end"}).text(function(b){return b.name}).style("stroke",function(b){return color_set(b.family-1)}).attr("transform",function(b){return"translate("+b.x+","+b.y+")rotate("+180*Math.atan(b.y/b.x)/Math.PI+")"})}}function cross(b,c){return b[0]*c[1]-b[1]*c[0]}function dot(b,c){return b[0]*c[0]+b[1]*c[1]}function isParentOf(b,c){return b===c?!0:b.children?b.children.some(function(b){return isParentOf(b,c)}):!1}
function init_scatter_plot(b){function c(b){var e=c.extent();association_rules=[];z.selectAll("circle").attr("class",function(c){if(e[0][0]<=c[b.x]&&c[b.x]<=e[1][0]&&e[0][1]<=c[b.y]&&c[b.y]<=e[1][1]){topush=!0;for(i=0;i<association_rules.length;i++)compare_a_rules(association_rules[i],c)&&(topush=!1);topush&&association_rules.push(c);return 1}return"spl"})}b=b||"#chart";get_attribute_list();var e=full_association_rules,g=["confidence","conclusion_supp","premise_supp","lift"],p={},q={};e.forEach(function(b){b.lift=
b.confidence/b.conclusion_supp});var r={traits:g};r.values=e;r.traits.forEach(function(b){var c=function(c){return c[b]},c=[d3.min(r.values,c),d3.max(r.values,c)],e=[8.75,81.25];p[b]=d3.scale.linear().domain(c).range(e);q[b]=d3.scale.linear().domain(c).range(e.slice().reverse())});var v=d3.svg.axis().ticks(5).tickSize(90*g.length),c=d3.svg.brush().on("brushstart",function(b){c.data!==b&&(A.call(c.clear()),c.x(p[b.x]).y(q[b.y]).data=b)}).on("brush",c).on("brushend",function(){c.empty()&&z.selectAll("circle").attr("class",
function(){association_rules=full_association_rules;return 1});document.getElementById("chart").innerHTML="";redrawCurVis();createRulesList()}),z=d3.select(b).append("svg").attr("width",90*g.length+17.5).attr("align","center").attr("height",90*g.length+17.5);z.append("svg:rect").attr("x",0).attr("y",0).attr("height","100%").attr("width","100%").attr("fill","#FFFFFF");z.selectAll("g.x.axis").data(r.traits).enter().append("g").attr("class","x axis").attr("transform",function(b,c){return"translate("+
90*c+",0)"}).each(function(b){d3.select(this).call(v.scale(p[b]).orient("bottom"))});z.selectAll("g.y.axis").data(r.traits).enter().append("g").attr("class","y axis").attr("transform",function(b,c){return"translate(0,"+90*c+")"}).each(function(b){d3.select(this).call(v.scale(q[b]).orient("right"))});var A=z.selectAll("g.cell").data(function(b,c){var e=[],g=b.length,p=c.length,q,r;for(q=-1;++q<g;)for(r=-1;++r<p;)e.push({x:b[q],i:q,y:c[r],j:r});return e}(r.traits,r.traits)).enter().append("g").attr("class",
"cell").attr("transform",function(b){return"translate("+90*b.i+","+90*b.j+")"}).each(function(b){var e=d3.select(this);e.append("rect").attr("class","frame").attr("x",8.75).attr("y",8.75).attr("width",72.5).attr("height",72.5);e.selectAll("circle").data(r.values).enter().append("circle").attr("class",function(){return 1}).attr("cx",function(c){return p[b.x](c[b.x])}).attr("cy",function(c){return q[b.y](c[b.y])}).attr("r",function(){return 3}).on("mouseover",Matrix_View_MouseOver).on("mouseout",Matrix_View_MouseOut);
e.call(c.x(p[b.x]).y(q[b.y]))});A.filter(function(b){return b.i==b.j}).append("text").attr("x",17.5).attr("y",17.5).attr("dy",".71em").text(function(b){return b.x})}
function init_gg_plot(){for(var b=0,c=get_attribute_list()[0],e=clone(association_rules),b=e.length,g=0;g<e.length;g++){for(j=0;j<e[g].premise.length;j++)for(k=0;k<c.length;k++)e[g].premise[j]==c[k].text&&(res={},res.family=c[k].family,res.text=c[k].text,e[g].premise[j]=res);for(j=0;j<e[g].conclusion.length;j++)for(k=0;k<c.length;k++)e[g].conclusion[j]==c[k].text&&(res={},res.family=c[k].family,res.text=c[k].text,e[g].conclusion[j]=res)}c=[];common_parent={children:[]};for(var g=0;g<b;g++){t_link=
[-1,-1];p_parent={occurencies:1};p_parent.parent=common_parent;p_parent.ids=[];p_parent.ids.push(e[g].id);p_parent.text=objectJoin(e[g].premise,"&");p_parent.children=e[g].premise;p_parent.children=p_parent.children.map(function(b){res={};res=b;res.occurencies=1;res.parent=p_parent;res.ids=p_parent.ids;return res});c_parent={occurencies:1};c_parent.parent=common_parent;c_parent.ids=[];c_parent.ids.push(e[g].id);c_parent.text=objectJoin(e[g].conclusion,"&");c_parent.children=e[g].conclusion;c_parent.children=
c_parent.children.map(function(b){res={};res=b;res.occurencies=1;res.parent=p_parent;res.ids=c_parent.ids;return res});for(j=0;j<common_parent.children.length;j++)objectJoin(e[g].premise,"&")==common_parent.children[j].text&&(t_link[0]=j,common_parent.children[j].occurencies++,common_parent.children[j].ids.push(e[g].id),p_parent.occurencies++,common_parent.children[j].children=common_parent.children[j].children.map(function(b){b.occurencies=common_parent.children[j].occurencies/common_parent.children[j].children.length;
b.ids=common_parent.children[j].ids;return b})),objectJoin(e[g].conclusion,"&")==common_parent.children[j].text&&(t_link[1]=j,common_parent.children[j].occurencies++,common_parent.children[j].ids.push(e[g].id),c_parent.occurencies++,common_parent.children[j].children=common_parent.children[j].children.map(function(b){b.occurencies=common_parent.children[j].occurencies/common_parent.children[j].children.length;b.ids=common_parent.children[j].ids;return b}));1==p_parent.occurencies&&(t_link[0]=common_parent.children.length,
common_parent.children.push(p_parent));1==c_parent.occurencies&&(t_link[1]=common_parent.children.length,common_parent.children.push(c_parent));t_link[2]=e[g].confidence;t_link[3]=e[g].id;c.push(t_link)}var p=d3.scale.linear().range([0,w]),q=d3.scale.linear().range([0,h]),r=d3.select("#chart").append("svg").attr("width",w).attr("height",h),b=d3.layout.pack().size([w,h]).value(function(b){return 100*b.occurencies}),v=common_parent.children,b=b.nodes(common_parent),z,A;A=z=common_parent;r.selectAll("circle").data(b).enter().append("svg:circle").attr("class",
function(b){return b.children?"parent":"child"}).attr("ids",function(b){return b.ids}).style("fill",function(b){if(b.family)return color_set(b.family-1)}).attr("cx",function(b){return b.x}).attr("cy",function(b){return b.y}).attr("r",function(b){return b.r}).on("click",function(b){var b=z==b?A:b,c=common_parent.r/b.r;w>h?(p.domain([b.x-Math.abs(h-w)/(2*c)-b.r,b.x+Math.abs(h-w)/(2*c)+b.r]),q.domain([b.y-b.r,b.y+b.r])):(p.domain([b.x-b.r,b.x+b.r]),q.domain([b.y-Math.abs(h-w)/(2*c)-b.r,b.y+Math.abs(h-
w)/(2*c)+b.r]));var e=r.transition().duration(d3.event.altKey?7500:750);e.selectAll("circle").attr("cx",function(b){return p(b.x)}).attr("cy",function(b){return q(b.y)}).attr("r",function(b){return c*b.r});e.selectAll("line").attr("x1",function(b){return p(v[b[0]].x)}).attr("y1",function(b){return q(v[b[0]].y)}).attr("x2",function(b){return p(v[b[1]].x)}).attr("y2",function(b){return q(v[b[1]].y)});e.selectAll("polygon").attr("transform",function(b){return"translate("+p(0.5*(v[b[0]].x+v[b[1]].x))+
","+q(0.5*(v[b[0]].y+v[b[1]].y))+"), rotate("+180*(1/Math.PI)*Math.atan((v[b[1]].y-v[b[0]].y)/(v[b[1]].x-v[b[0]].x))+")"});e.selectAll("text").attr("x",function(b){return p(b.x)}).attr("y",function(b){return q(b.y)}).style("opacity",function(b){return 30<c*b.r?1:0});z=b});c=unique_set(c);r.selectAll("line").data(c).enter().append("svg:line").style("stroke-width",function(b){return 2*b[2]+1}).attr("id",function(b){return b[3]}).attr("x1",function(b){return v[b[0]].x}).attr("y1",function(b){return v[b[0]].y}).attr("x2",
function(b){return v[b[1]].x}).attr("y2",function(b){return v[b[1]].y}).style("stroke",d3.interpolateRgb(premiseColor,conclusionColor)(0.5));r.selectAll("polygon").data(c).enter().append("svg:polygon").attr("id",function(b){return b[3]}).attr("points",function(b){return-5*(b[2]+1)+","+3*(b[2]+1)+" "+-5*(b[2]+1)+","+-3*(b[2]+1)+" "+3*(b[2]+1)+",0"}).style("fill",d3.interpolateRgb(premiseColor,conclusionColor)(0.5)).attr("transform",function(b){return"translate("+0.5*(v[b[0]].x+v[b[1]].x)+","+0.5*(v[b[0]].y+
v[b[1]].y)+"), rotate("+180*(1/Math.PI)*Math.atan((v[b[1]].y-v[b[0]].y)/(v[b[1]].x-v[b[0]].x))+")"});r.selectAll("text").data(b).enter().append("svg:text").style("pointer-events","none").attr("x",function(b){return b.x}).attr("y",function(b){return b.y}).attr("dy",".35em").attr("text-anchor","middle").style("opacity",function(b){return 30<b.r?1:0}).text(function(b){return 2==b.depth?b.text:""})}
function flashAlert(b,c,e){c&&"error"==c?($("div.alert-error > span").text(b),$("div.alert-error").show()):c&&"info"==c?($("div.alert-info > span").text(b),$("div.alert-info").show()):($("div.alert-block > span").text(b),$("div.alert-block").show());e&&setTimeout(function(){$("div.alert").fadeOut()},e)}function showLoading(){$("div.alert").hide();$("div.alert-block > span").text("Loading...");$("div.alert-block").show()}function hideLoading(){$("div.alert").hide()}
$(function(){$(".dismiss-alert").click(function(){$("div.alert").fadeOut("fast")});$(".dropdown-toggle").dropdown()});
function Context(b,c,e,g){this.initialAttributeNames=HashClone(g);this.initialObjects=b.slice(0);this.attributeNames=g;this.attributes=c;this.objects=b;this.rel=e;this.getEntitiesCount=function(){return this.objects.length};this.whatValueForThisAttribute=function(b,c){for(var e=0;e<rel[b].length;e++){var g=rel[b][e];if(g.split(SEPARATOR)[0]==c)return g.substring(g.indexOf(SEPARATOR)+1,g.length)}return null};this.getAttrValues=function(b){for(var c=[],b=attributes[b],e=0;e<b.length;e+=2)c.push(b[e]);
return c};this.intersection=function(b,c){var e=this.getObjectsHavingOrNot(b),g=this.getObjectsHavingOrNot(c);return ArrayIntersect(e,g)};this.booleanPositive=function(b,c){if(b==c||b+"-yes"==c)return!0;var e=c.split("-");return 0<e.length&&e[0]!=b&&"no"==e[1]?!0:!1};this.getObjectsHavingOrNot=function(b){var c=[],e=b.split("-"),g=e.length-1,z=0<=g&&"no"==e[g];if(0<e.length&&("no"==e[g]||"yes"==e[g]))for(var b="",A=0;A<g;A++)b+=e[A];b=this.attributes.indexOf(b);for(e=0;e<this.objects.length;e++)g=
this.objects[e],z?this.rel[e][b]||c.push(g):this.rel[e][b]&&c.push(g);return c};this.getObjectIndex=function(b){for(var c=0;c<this.objects.length;c++)if(this.objects[c]==b)return c;return-1};this.getSubcontextForExtent=function(b,c){for(var e=[],g=[],z=[],A=0;A<b.length;A++){e.push(b[A]);var B=this.getObjectIndex(b[A]);if(c)z.push(this.rel[B]);else{z[A]=[];for(var C=0;C<this.rel[B].length;C++)if(this.rel[B][C]){var D=g.indexOf(this.attributes[C]);0>D&&g.push(this.attributes[C]);D=g.indexOf(this.attributes[C]);
z[A][D]=!0}}}c&&(g=this.attributes);return new Context(e,g,z,g)}}
function eliminateEntities(){for(var b=[],c=[],e=[],g=0;g<context.objects.length;){for(var p=!1,q=0;q<lattice.concepts.length&&!p;q++)p=0<=lattice.concepts[q].extent.indexOf(context.objects[g]);p?g++:(c.push(context.objects[g]),context.objects.splice(g,1))}for(var r=getAttributeValuesPairs(),g=0;g<r.length;g++){p=!1;for(q=0;q<lattice.concepts.length&&!p;q++)p=0<=lattice.concepts[q].intent.indexOf(r[g].name);if(!p){var p=r[g].attrName,q=r[g].valueName,v={};v.name=r[g].name;v.booleanAttr=r[g].booleanAttr;
v.attrName=p;v.value=q?context.attributeNames[p][getValueIdxfromAttr(p,q)]:context.attributeNames[p];e.push(v);r[g].booleanAttr?delete context.attributeNames[p]:p in context.attributeNames&&(1==context.attributeNames[p].length?delete context.attributeNames[p]:removeValuefromAttr(p,q))}}b.push(c);b.push(e);updateEntityList();return b}function removeValuefromAttr(b,c){var e=getValueIdxfromAttr(b,c);0<=e&&context.attributeNames[b].splice(e,1)}
function getValueIdxfromAttr(b,c){for(var e=context.attributeNames[b],g=0;g<e.length;g++)if(e[g][0]==c)return g;return-1}function addEntities(b,c){ArrayAddAll(b,context.objects);for(var e=0;e<c.length;e++)c[e].attrName in context.attributeNames?0>context.attributeNames[c[e].attrName].indexOf(c[e].value)&&context.attributeNames[c[e].attrName].push(c[e].value):context.attributeNames[c[e].attrName]=c[e].booleanAttr?c[e].value:[c[e].value];updateEntityList()}Highcharts.theme={colors:["#4572A7"]};
var highchartsOptions=Highcharts.getOptions(),prevIndex=-1;function removeWatermarks(){$('text[text-anchor="end"]').remove()}function initDashboard(){createDistributionChart()}function loadDashboard(){multiSelectOptionsForAttributes("#control_1");multiSelectOptionsForAttributes("#control_2");$("#control_1, #control_2").multiSelect();updateDistributionChart(lattice.topConcept)}
function multiSelectOptionsForAttributes(b){var c=$(b);c.empty();c.append($("<option></option>"));$.each(context.attributeNames,function(b,g){var p=$("<optgroup label='"+b+"'></optgroup>");c.append(p);for(var q=0;q<g.length;q++)$("<option label='"+g[q][0]+"' value='"+b+SEPARATOR+g[q][0]+"'>"+g[q][0]+"</option>").appendTo(p)})}var chart;
function createHorizontalBarChart(b,c,e){chart=new Highcharts.Chart({chart:{renderTo:b,defaultSeriesType:"bar"},title:{text:"Attribute Co-occurrence"},subtitle:{text:""},xAxis:{categories:c,title:{text:null}},yAxis:{min:0,title:{text:"Objects",align:"high"}},tooltip:{formatter:function(){return""+this.series.name+": "+this.y+" objects"}},plotOptions:{bar:{dataLabels:{enabled:!0}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",floating:!0,borderWidth:1,backgroundColor:Highcharts.theme.legendBackgroundColor||
"#FFFFFF",shadow:!0},credits:{enabled:!1},series:getStackedBarSeries(c,e)})}function getStackedBarSeries(b,c){for(var e=[],g=0;g<c.length;g++){var p={};p.name=c[g];p.data=[];for(var q=0;q<b.length;q++){var r=context.intersection(b[q],c[g]);p.data.push(r.length)}e.push(p)}return e}var distributionChart;
function createVerticalBarChart(b,c,e,g){distributionChart=new Highcharts.Chart({chart:{renderTo:b,type:"column",margin:[50,50,100,80]},title:{text:c},xAxis:{categories:e,labels:{rotation:-45,align:"right",style:{font:"normal 13px Verdana, sans-serif"}}},yAxis:{min:0,title:{text:"Objects"}},legend:{enabled:!1},tooltip:{formatter:function(){return"<b>"+this.x+" : "+this.y+" objects</b><br/>"}},series:[{name:"Attributes",data:g,dataLabels:{enabled:!0,rotation:-90,color:"#FFFFFF",align:"right",x:-3,
y:10,formatter:function(){return this.y},style:{font:"normal 13px Verdana, sans-serif"}}}]})}function createDistributionPieChart(){createPieChart("distribution-chart","Distribution",[])}
function createPieChart(b,c,e){distributionChart=new Highcharts.Chart({chart:{renderTo:b,plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:c},tooltip:{pointFormat:"{series.name}: <b>{point.percentage}%</b>",percentageDecimals:1},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",formatter:function(){return"<b>"+this.point.name+"</b>: "+Math.round(100*this.percentage)/100+" %"}}}},series:[{type:"pie",name:"Attributes",
data:e}]})}function createDistributionChart(){createVerticalBarChart("distribution-chart","Distribution",[],[])}
function updateDistributionChart(b){var c=$("#distribution-chart-type").val();if("bar"==c){if("undefined"!=typeof b){for(var c=[],b=context.getSubcontextForExtent(b.extent,!1),e=0;e<b.attributes.length;e++){for(var g=0,p=0;p<b.objects.length;p++)!0==b.rel[p][e]&&g++;c.push(g)}distributionChart.series[0].setData(c);distributionChart.xAxis[0].setCategories(b.attributeNames)}}else if("pie"==c&&"undefined"!=typeof b){c=[];b=context.getSubcontextForExtent(b.extent,!1);for(e=0;e<b.attributes.length;e++){for(p=
g=0;p<b.objects.length;p++)!0==b.rel[p][e]&&g++;c.push([b.attributes[e],g])}distributionChart.series[0].setData(c)}}var polarChart;
function createPolarChart(){polarChart=new Highcharts.Chart({chart:{renderTo:"polar-chart",polar:!0,type:"line"},title:{text:"Budget vs spending",x:-80},pane:{size:"80%"},xAxis:{categories:["Support","Stability","Probability","Separation"],tickmarkPlacement:"on",lineWidth:0},yAxis:{gridLineInterpolation:"polygon",lineWidth:0,min:0},tooltip:{shared:!0,valuePrefix:"$"},legend:{align:"right",verticalAlign:"top",y:100,layout:"vertical"},series:[{name:"Allocated Budget",data:[43E3,19E3,6E4,35E3],pointPlacement:"on"},
{name:"Actual Spending",data:[5E4,39E3,42E3,31E3],pointPlacement:"on"}]})}function createScatterPlotChart(){distributionChart=new Highcharts.Chart({chart:{renderTo:"sc_pl_div",type:"area",margin:[50,50,100,80]},title:{text:"Association Rules Distribution"}});distributionChart.container.innerHTML="";init_scatter_plot(distributionChart.container)}
function createRulesList(){if("undefined"!=typeof association_rules){a1=[];a2=[];for(i=0;i<association_rules.length;i++)a1.push(association_rules[i].id),a2.push(Math.round(100*association_rules[i].confidence)/100);chart=new Highcharts.Chart({chart:{height:50+20*association_rules.length,renderTo:"rules_render_area",type:"bar",events:{click:function(){if(-1!==prevIndex){for(t=0;t<this.series[0].data.length;t++)if(this.series[0].data[t].category==prevIndex){this.series[0].data[t].update({color:"#4572A7"},
!0,!1);break}d3.select("#chart").select("svg").selectAll("path").style("opacity",0.99);prevIndex=-1}}}},title:{text:"Generated rules"},legend:{enabled:null},xAxis:{categories:a1,title:{text:null}},yAxis:{min:0,title:{text:null,align:"high"},labels:{overflow:"justify"}},tooltip:{formatter:function(){return""+this.series.name+": "+this.y}},plotOptions:{bar:{dataLabels:{enabled:!0},events:{click:function(b){if(-1!==prevIndex)for(t=0;t<this.data.length;t++)if(this.data[t].category==prevIndex){this.data[t].update({color:"#4572A7"},
!0,!1);break}b.point.update({color:"#f00"},!0,!1);vis.selectAll("path").style("opacity",function(c){return 0<=c[0].ids.indexOf(b.point.category)?0.99:0.1});prevIndex=b.point.category}}}},series:[{name:"Confidence",data:a2}]})}}function updateDashboard(){}function disableDrawingOptionsForAR(b){$("#select-color").prop("disabled",b);$("#select-edge").prop("disabled",b);$("#select-size").prop("disabled",b);$("#select-label").prop("disabled",b)}var edge_type="default";
function getEdgeThickness(b){if("default"==edge_type)return DEFAULT_EDGE_THICKNESS;b=metrics.getLinkScore(b.source.id,b.target.id,edge_type);return Math.round(b*(EDGE_MAX_THICK-EDGE_MIN_THICK))+EDGE_MIN_THICK}function getEdgeValue(b){if("default"==edge_type)return-1;b=metrics.getLinkScore(b.source.id,b.target.id,edge_type);return Math.round(100*b)/100}function changeEdgeThickness(b){edge_type=b;0<=noLinks.indexOf(b)||updateVis()}var color_type="default";
function changeNodeSize(b){size_type=b;updateVis()}function getNodeSize(b){if("default"==size_type)return DEFAULT_NODE_RADIUS;b=metrics.getScore(b.id,size_type);return Math.round(b*(NODE_MAX_SIZE-NODE_MIN_SIZE))+NODE_MIN_SIZE}function changeNodeColor(b){color_type=b;vis.selectAll(".concept").style("fill",function(b){return getNodeColor(b)})}
function getNodeColor(b){if("ids"==color_type)return mapColor(b.id);if("cluster"==color_type){var c=d3.scale.category10();c.domain();b=metrics.getScore(b.id,color_type);console.log(b+"-"+c(b));return mapColor(""+13*b)}return DEFAULT_FILL_COLOR}
function mapColor(b){for(var c=0,e=0;e<b.length;e++)c=b.charCodeAt(e)+((c<<20)-c);b="#3182bd #6baed6 #9ecae1 #c6dbef #e6550d #fd8d3c #fdae6b #fdd0a2 #31a354 #74c476 #a1d99b #c7e9c0 #756bb1 #9e9ac8 #bcbddc #dadaeb #636363 #969696 #bdbdbd #d9d9d9".split(" ");c=Math.abs(c)%b.length;return b[c]}var displayAttrLabel,displayObjLabel=!0;function get_upper_label(b){return!displayAttrLabel?"":labeling_type==LABEL_REPETITIVE?b.intent:b.upperLabel}
function get_lower_label(b){if(!displayObjLabel)return"";if(labeling_type==LABEL_REPETITIVE)return b.extent;if(labeling_type==LABEL_MULTILABEL)return b.lowerLabel;b=metrics.getScore(b.id,labeling_type);return"esupport"==labeling_type?Math.round(100*b)+"% ("+Math.round(context.objects.length*b)+")":Math.round(100*b)+"%"}function changeLabel(b){labeling_type=b;(labeling_type==LABEL_REPETITIVE||labeling_type==LABEL_MULTILABEL)&&labelizeData();updateVis()}
function labelize(){alert("active");for(var b=vis.select('circle[id="'+lattice.topConcept.id+'"]'),b=getOutgoingNodes(b),c=0;c<b.length;c++){for(var e=b[c],g=e.attr("intent").split(","),p=getIncomingNodes(e),q=0;q<p.length&&0<g.length;q++)var r=p[q].attr("intent").split(","),g=ArraySubtract(g,r);vis.select('text[id="intent_'+e.attr("id")+'"]').text(g.join(", "));ArrayAddAll(getOutgoingNodes(e),b)}b=vis.select('circle[id="'+lattice.bottomConcept.id+'"]');b=getIncomingNodes(b);for(c=0;c<b.length;c++){e=
b[c];g=e.attr("extent").split(",");p=getOutgoingNodes(e);for(q=0;q<p.length&&0<g.length;q++)r=p[q].attr("extent").split(","),g=ArraySubtract(g,r);vis.select('text[id="extent_'+e.attr("id")+'"]').text(g.join(", "));ArrayAddAll(getIncomingNodes(e),b)}}
function labelizeFirst(){for(var b=getTopMostConcepts(),c=0;c<b.length;c++){for(var e=b[c],g=getParentsData(e),p=e.intent,q=0;q<g.length&&0<p.length;q++)p=ArraySubtract(p,g[q].intent);q=p.join(", ");e.name=q;e.upperLabel=q;g=getChildrenData(e);ArrayAddAll(g,b)}b=getBottomMostConcepts();for(c=0;c<b.length;c++){e=b[c];g=getChildrenData(e);p=e.extent;for(q=0;q<g.length&&0<p.length;q++)p=ArraySubtract(p,g[q].extent);q=p.join(", ");e.lowerLabel=q;ArrayAddAll(getParentsData(e),b)}}
function labelizeData(){for(var b=getTopMostConcepts(),c=0;c<b.length;c++){for(var e=b[c],g="undefined"!=typeof lattice.original_id?getTreeParentsData(e):getParentsData(e),p=e.intent,q=0;q<g.length&&0<p.length;q++)p=ArraySubtract(p,g[q].intent);q=p.join(", ");e.name=q;e.upperLabel=q;p="undefined"!=typeof lattice.original_id?getTreeChildrenData(e):getChildrenData(e);ArrayAddAll(p,b)}if($("input[name='label-for-attr']").is(":checked")){b=getBottomMostConcepts();for(c=0;c<b.length;c++){e=b[c];p=getChildrenData(e);
g=e.extent;for(q=0;q<p.length&&0<g.length;q++)g=ArraySubtract(g,p[q].extent);5<g.length?(q=g.length-5,q=g.join("\n")+"\n("+q+" more)"):q=g.join("\n");e.lowerLabel=q;ArrayAddAll(getParentsData(e),b)}}}
var visualFilters=[],filter=new function(){this.history=[];this.addFilter=function(b,c,e,g){var p=eliminateEntities();updateVisualFilters();var q={};q.filterType=b;q.attr=c;q.value=e;q.excludedNodes=g;q.remObjs=p[0];if(void 0!==association_rules){association_rules=full_association_rules;q.removedRules=[];arrjs=[];for(j=0;j<association_rules.length;j++){flag=!0;for(k=0;k<association_rules[j].premise.length;k++)association_rules[j].premise[k]==q.attr+"-"+q.value&&(flag=!1);for(k=0;k<association_rules[j].conclusion.length;k++)association_rules[j].conclusion[k]==
q.attr+"-"+q.value&&(flag=!1);flag&&(q.removedRules.push(association_rules[j]),arrjs.push(j))}for(t=0;t<arrjs.length;t++)association_rules.splice(arrjs[t]-t,1);full_association_rules=association_rules;createScatterPlotChart()}q.remAttrsVals=p[1];this.history.push(q)};this.removeFilter=function(b,c){var e=this.indexOfFilter(b,c);removeFilterAt(e)};this.removeFilterAt=function(b){if(this.history[b].removedRules){if(b!==this.history.length-1)for(j=0;j<this.history[b].removedRules.length;j++){console.log("going through rule",
j);attributed=!1;for(i=b+1;i<this.history.length&&!attributed;i++){console.log("going through filter",i);console.log(this.history[b].removedRules[j].premise,this.history[b].removedRules[j].conclusion);for(k=0;k<this.history[b].removedRules[j].premise.length;k++)if(this.history[b].removedRules[j].premise[k]==this.history[i].attr+"-"+this.history[i].value){association_rules.push(this.history[b].removedRules[j]);attributed=!0;break}if(!attributed)for(k=0;k<this.history[b].removedRules[j].conclusion.length;k++)if(this.history[b].removedRules[j].conclusion[k]==
this.history[i].attr+"-"+this.history[i].value){association_rules.push(this.history[b].removedRules[j]);attributed=!0;break}attributed||this.history[i].removedRules.push(this.history[b].removedRules[j])}}else association_rules=association_rules.concat(this.history[b].removedRules);full_association_rules=association_rules;createScatterPlotChart()}addEntities(this.history[b].remObjs,this.history[b].remAttrsVals);updateVisualFilters();ArrayRemove(this.history,b)};this.indexOfAttr=function(b){for(var c=
0;c<this.history.length;c++)if(this.history[c].attr==b)return c;return-1};this.indexOfFilter=function(b,c){for(var e=0;e<this.history.length;e++)if(this.history[e].attr==b&&this.history[e].value==c)return e;return-1};this.indexOfFilter=function(b){for(var c=0;c<this.history.length;c++)if(this.history[c].attr==b)return c;return-1};this.getFilter=function(b,c){var e=this.indexOfFilter(b,c);return 0>e?null:this.history[e]};this.clear=function(){this.history.length=0}};
function removeFilter(b,c){var e;e=c?filter.indexOfFilter(b,c):filter.indexOfFilter(b);var g=filter.history[e].excludedNodes;filter.removeFilterAt(e);for(e=0;e<filter.history.length&&0<g.length;e++)g=ArraySubtract(g,filter.history[e].excludedNodes);for(e=0;e<g.length;e++)0>lattice.concepts.indexOf(g[e])&&lattice.concepts.push(g[e]);keepLinks();c?$("#"+b+"-"+c).remove():$("#"+b).remove();labelizeData();updateVis()}
function resetFilters(){$("#showFiltersPanel").html("<span>Filters &raquo;</span>");if(association_rules)for(b=0;b<filter.history.length;b++)association_rules=association_rules.concat(filter.history[b].removedRules);full_association_rules=association_rules;filter.clear();for(var b=0;b<visualFilters.length;b++)visualFilters[b].series[0].redraw();lattice.concepts=lattice.initialConcepts.slice(0);lattice.edges=lattice.initialEdges.slice(0);context.attributeNames=HashClone(context.initialAttributeNames);
context.objects=context.initialObjects.slice(0);updateEntityList();updateVisualFilters();updateVis();createScatterPlotChart()}function keepLinks(){lattice.edges=lattice.initialEdges.filter(function(b){return 0<=lattice.concepts.indexOf(b.source)&&0<=lattice.concepts.indexOf(b.target)})}
function clickFilterValue(){var b=this.name,c=this.series.name;if(this.sliced){for(var e=[],g=0;g<lattice.initialConcepts.length;g++){var p=lattice.initialConcepts[g];if(0==p.extent.length)e.push(p);else{var q=c;"yes"!=b&&"no"!=b&&(q+=SEPARATOR+b);0>p.intent.indexOf(q)?"no"!=b&&e.push(p):"no"==b&&e.push(p)}}lattice.concepts=ArraySubtract(lattice.concepts,e);keepLinks();filter.addFilter("attribute",c,b,e);$("#"+c+"-"+b).remove();$('<span id="'+c+"-"+b+'"> | '+c+": "+b+' <a href="#" class="remove-filter"><img src="'+
STATIC_URL+'/images/remove.gif"></a></span>').appendTo("#showFiltersPanel");labelizeData();updateVis()}else removeFilter(c,b)}function loadFilters(){for(var b=getKeys(context.attributeNames),c=0;c<b.length;c++){var e=[{animation:!0,type:"pie",name:b[c],data:context.attributeNames[b[c]]}];$('<div class="chartFilter"><span> '+b[c]+' </span><div id="chart_'+c+'" />').appendTo("#filters_container");visualFilters.push(createChart(b[c],"chart_"+c,e))}}
function createChart(b,c,e){return new Highcharts.Chart({chart:{renderTo:c,backgroundColor:"rgba(50,50,50,0)",plotBorderWidth:null,plotShadow:!1},title:{text:""},tooltip:{formatter:function(){return"<b>"+this.point.name.escapeHTML()+"</b>: "+Math.round(this.percentage)+" %"}},legend:{itemWidth:80,style:{width:"100px"},layout:"vertical",backgroundColor:"#666",align:"right",verticalAlign:"middle",itemStyle:{color:"#fff"}},plotOptions:{pie:{allowPointSelect:!0,innerSize:"40%",point:{events:{select:clickFilterValue,
unselect:clickFilterValue}},cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0}},series:e})}function updateVisualFilters(){for(var b=0;b<visualFilters.length;b++){var c=visualFilters[b].series[0];c.name in context.attributeNames?(document.getElementById("chart_"+b).style.opacity=1,c.setData(context.attributeNames[c.name],!0)):document.getElementById("chart_"+b).style.opacity=0}}var selFilterCt=0;
function filterSelected(){var b=[];vis.selectAll("circle.selected").each(function(c){b.push(c)});var c=ArraySubtract(lattice.concepts,b);lattice.concepts=b;keepLinks();var e="selection_"+selFilterCt;filter.addFilter("selection",e,"filter",c);$('<span id="'+e+'"> | selection <a href="#" class="remove-filter"><img src="'+STATIC_URL+'/images/remove.gif"></a></span>').appendTo("#showFiltersPanel");selFilterCt++;labelizeData();updateVis()}var attrFilterCt=0;
function filterAttributes(){var b=[];$("input[name='attr']:checked").each(function(){b.push($(this).val())});for(var c=[],e=0;e<lattice.concepts.length;e++)0==lattice.concepts[e].extent.length?c.push(lattice.concepts[e]):ArrayContainsAll(lattice.concepts[e].intent,b)||c.push(lattice.concepts[e]);lattice.concepts=ArraySubtract(lattice.concepts,c);keepLinks();e="attribute_"+attrFilterCt;filter.addFilter("attribute_sel",e,"filter",c);$('<span id="'+e+'" rel="tooltip" data-trigger="hover" data-placement="top" data-title="'+
b.join(", ")+'"> | attributes sel. <a href="#" class="remove-filter"><img src="'+STATIC_URL+'/images/remove.gif"></a></span>').appendTo("#showFiltersPanel");attrFilterCt++;labelizeData();updateVis()}var objFilterCt=0;
function filterObjects(){var b=[];$("input[name='obj']:checked").each(function(){b.push($(this).val())});for(var c=[],e=0;e<lattice.concepts.length;e++)0==lattice.concepts[e].intent.length?c.push(lattice.concepts[e]):ArrayContainsAll(lattice.concepts[e].extent,b)||c.push(lattice.concepts[e]);lattice.concepts=ArraySubtract(lattice.concepts,c);keepLinks();e="object_"+objFilterCt;filter.addFilter("object_sel",e,"filter",c);$('<span id="'+e+'" rel="tooltip" data-trigger="hover" data-placement="top" data-title="'+
b.join(", ")+'"> | objects sel. <a href="#" class="remove-filter"><img src="'+STATIC_URL+'/images/remove.gif"></a></span>').appendTo("#showFiltersPanel");objFilterCt++;labelize2();updateVis()}function loadAttributeLattices(b){var c=0,e;for(e in context.attributeNames){var g="minilattice_"+c++;$('<div class="chartFilter"><span> '+e+' </span><div id="'+g+'" />').appendTo("#graph_container");createMiniLattice(b[e].nodes,b[e].links,g)}}var context,lattice,a_rules_concerned_attributes,_data_a_rules_concerned_attributes;
function loadData(b){context=new Context(b.context.objects,b.context.attributes,b.context.rel,b.attributes);lattice=new Lattice(b);a_rules_concerned_attributes=clone(b.attributes);_data_a_rules_concerned_attributes=clone(b.attributes);if("undefined"!=typeof n_concepts){var c=1-lattice.edges.length/n_links;$("#tree-opts").popover({title:"Tree stats",placement:"bottom",html:!0,trigger:"hover",content:"Concepts (source): "+n_concepts+" <br/> Links (source): "+n_links+" <br/><br/> Concepts (tree): "+
lattice.concepts.length+" <br/> Links (tree): "+lattice.edges.length+"<br/><br/> Reduction: "+Math.round(100*c)/100+"%"})}$("input.search").tokenInput(getAttributeValuesPairs(),{propertyToSearch:"name",preventDuplicates:!1,hintText:"Type an attribute name",theme:"facebook",onAdd:searchInput,onDelete:searchInput});$("#slider-clustering").slider({min:1,max:lattice.concepts.length,value:[lattice.concepts.length],slide:function(b,c){$("#n_clusters").val(c.value)}});$("#n_clusters").val(lattice.concepts.length);
"undefined"!=typeof lattice.original_id&&($("#tree-opts").show(),$("a.undo-link").show());hoverbox=d3.select("#hoverbox");A_rules_box=d3.select("#A_rules_box");labelizeFirst();checkLatticeConstraints();displayAttrLabel=$("input[name='label-for-attr']").is(":checked");displayObjLabel=$("input[name='label-for-attr']").is(":checked");labelizeData();updateEntityList();loadFilters();loadDashboard();$('text[text-anchor="end"]').remove();b.attribute_lattices&&loadAttributeLattices(JSON.parse(b.attribute_lattices));
lattice.attr_graph&&loadAttributeGraph(lattice.attr_graph)}
function Lattice(b){this.initialConcepts=b.nodes.slice(0);this.initialEdges=b.links.slice(0);this.attr_graph=JSON.parse(b.attribute_graph);this.concepts=b.nodes;this.edges=b.links;this.id=b.id;this.original_id=b.original_id;this.getConcept=function(b){for(var e=0;e<this.concepts.length;e++)if(this.concepts[e].id==b)return this.concepts[e]};this.getConceptById=function(b){for(var e=0;e<this.concepts.length;e++)if(this.concepts[e].id==b)return this.concepts[e]};this.getEdge=function(b,e){for(var g=
0;g<this.edges.length;g++)if(this.edges[g].source.id==b.id&&this.edges[g].target.id==e.id||this.edges[g].target.id==b.id&&this.edges[g].source.id==e.id)return this.edges[g]};this.topConcept=this.getConcept(b.top_id);this.bottomConcept=this.getConcept(b.bottom_id);this.isEmpty=function(){return!1};this.conceptsCount=function(){return concepts.length};this.resetLattice=function(){concepts=initialConcepts.slice(0);edges=initialEdges.slice(0)};this.getPredecessors=function(b){for(var e=[],g=0;g<b.children_ids.length;g++)e.push(this.concepts[b.children_ids[g]]);
return e};this.getSucessors=function(b){for(var e=[],g=0;g<b.parents_ids.length;g++)e.push(this.concepts[b.parents_ids[g]]);return e};this.getSuccessorsEdges=function(b){for(var e=[],g=0;g<this.edges.length;g++)this.edges[g].source.id==b.id&&e.push(this.edges[g]);return e};this.getPredecessorsEdges=function(b){for(var e=[],g=0;g<this.edges.length;g++)this.edges[g].target.id==b.id&&e.push(this.edges[g]);return e};this.removeConcept=function(b){for(var e=0;e<lattice.concepts.length;e++)if(lattice.concepts[e].id==
b.id){lattice.concepts.splice(e,1);for(e=0;e<lattice.edges.length;e++){var g=lattice.edges[e];if(g.target.id==b.id||g.source.id==b.id)lattice.edges.splice(e,1),e-=1}break}};this.existsEdge=function(b,e){for(var g=0;g<lattice.edges.length;g++)if(lattice.edges[g].source.id==b&&lattice.edges[g].target.id==e)return!0;return!1};this.readdConcept=function(b){if("undefined"==typeof lattice.getConceptById(b.id)){lattice.concepts.push(b);for(var e=0;e<lattice.initialEdges.length;e++){var g=lattice.initialEdges[e];
g.target.id==b.id&&!lattice.existsEdge(g.source.id,g.target.id)?lattice.edges.push(g):g.source.id==b.id&&!lattice.existsEdge(g.source.id,g.target.id)&&lattice.edges.push(g)}}};this.treeCache=[];this.getTree=function(){function b(e){var c={};c.id=e.id;c.name=e.intent.join(", ");c.lowerLabel=e.lowerLabel;c.upperLabel=e.upperLabel;c.support=e.support;c.intent=e.intent;c.extent=e.extent;c.depth=0;c.children=[];0>lattice.treeCache.indexOf(c)&&lattice.treeCache.push(c);return c}function e(g){if(0==g.children_ids.length)return null;
for(var q=b(g),g=getChildrenData(g),r=0;r<g.length;r++){var v=0<g[r].children_ids.length?e(g[r]):b(g[r]);v.depth=q.depth+1;q.children.push(v)}return q}var g=getTopMostConcepts()[0];return e(g)};this.getHeight=function(){return this.bottomConcept.depth+1};this.getEdgeLength=function(b){return lattice.getHeight()-b.target.depth-(lattice.getHeight()-b.source.depth)};this.doTopSort=function(b){for(var e=[this.conceptsCount()],g=e.length;0<=--g;)e[g]=this.getPredecessors(this.nodes[g]).length;for(var p=
this.topConcept,q=this.concepts.indexOf(p);p!=this.bottomConcept;){succ=this.getSuccessorsEdges(p);b[this.concepts.indexOf(p)]=p.depth;for(g=0;g<succ.length;g++)tmp2=this.concepts(succ[g].target),0==--e[this.concepts.indexOf(tmp2)]&&(e[q]=this.concepts.indexOf(tmp2),q=this.concepts.indexOf(tmp2));p=this.concepts[e[this.concepts.indexOf(p)]]}b[this.concepts.indexOf(this.bottomConcept)]=this.bottomConcept.depth}}
function checkLatticeConstraints(){if("undefined"!=typeof lattice.original_id)changeVis("sunburst");else{if(OVERWHELMING&&(context.attributes.length>MAX_ENTITY_SIZE||context.objects.length>MAX_ENTITY_SIZE)){if(confirm("Labeling concepts in this lattice may be overwhelming, do you want to switch to a suitable tree visualisation?")){$("#modal-tree-transform").modal({keyboard:!0,show:!0});return}setOverwhelmingOff()}$("#select-vis").val(PREF_VIS);changeVis(PREF_VIS)}}
function getTopMostConcepts(b){b||(b=lattice.concepts);for(var c=[],e=Number.MAX_VALUE,g=0;g<b.length;g++){var p=b[g];if(0==p.depth){c.push(p);break}p.depth<e?(c.length=0,c.push(p),e=p.depth):p.depth==e&&c.push(p)}return c}function getBottomMostConcepts(){for(var b=[],c=Number.MIN_VALUE,e=0;e<lattice.concepts.length;e++){var g=lattice.concepts[e];g.depth>c?(b.length=0,b.push(g),c=g.depth):g.depth==c&&b.push(g)}return b}function visitEdges(){for(var b=0;b<get.length;b++)get[b]}
function visitEdgesUp(b,c){for(var e=getIncomingEdgesData(b),g=0;g<e.length;g++)c(e[g]),visitEdgesUp(e[g].source,c)}function visitEdgesDown(b,c){for(var e=getOutgoingEdgesData(b),g=0;g<e.length;g++)c(e[g]),visitEdgesDown(e[g].target,c)}function getIncomingEdgesData(b,c){for(var e=[],g=0;g<lattice.edges.length;g++){var p=lattice.edges[g];p.target.id==b.id&&(e.push(p),"undefined"!=typeof c&&c(p))}return e}
function getOutgoingEdgesData(b,c){for(var e=[],g=0;g<lattice.edges.length;g++){var p=lattice.edges[g];p.source.id==b.id&&(e.push(p),"undefined"!=typeof c&&c(p))}return e}function getIncomingEdges(b,c){alert("avoid it. cubix.lattice.js line 668");var e=[],e=vis.selectAll('line[target_id="'+b.attr("id")+'"]');"undefined"!=typeof c&&e.each(c);return e}
function getOutgoingEdges(b,c){alert("avoid it. cubix.lattice.js line 678");var e=[],e=vis.selectAll('line[source_id="'+b.attr("id")+'"]');"undefined"!=typeof c&&e.each(c);return e}function getIncomingNodes(b){var c=[];vis.selectAll('line[target_id="'+b.attr("id")+'"]').each(function(){var b=vis.select('circle[id="'+d3.select(this).attr("source_id")+'"]');0>c.indexOf(b)&&c.push(b)});return c}
function getOutgoingNodes(b){var c=[];vis.selectAll('line[source_id="'+b.attr("id")+'"]').each(function(){var b=vis.select('circle[id="'+d3.select(this).attr("target_id")+'"]');0>c.indexOf(b)&&c.push(b)});return c}function getTreeParentsData(b){for(var c=0;c<lattice.treeCache.length;c++){var e=lattice.treeCache[c].children;if(null!=e)for(var g=0;g<e.length;g++)if(e[g].id==b.id)return[lattice.treeCache[c]]}return[]}
function getParentsData(b){for(var c=[],e=0;e<lattice.concepts.length;e++)0<=b.parents_ids.indexOf(lattice.concepts[e].id)&&c.push(lattice.concepts[e]);return c}function getTreeChildrenData(b){for(var c=0;c<lattice.treeCache.length;c++)if(lattice.treeCache[c].id==b.id)return lattice.treeCache[c].children;return[]}function getChildrenData(b){for(var c=[],e=0;e<lattice.concepts.length;e++)0<=b.children_ids.indexOf(lattice.concepts[e].id)&&c.push(lattice.concepts[e]);return c}
function areNeighbor(b,c){return(0<=b.parents_ids.indexOf(c.id)||0<=b.children_ids.indexOf(c.id))&&0<=lattice.concepts.indexOf(b)&&0<=lattice.concepts.indexOf(c)?!0:!1}function hasChild(b,c){return 0<=b.children_ids.indexOf(c.id)&&0<=lattice.concepts.indexOf(b)&&0<=lattice.concepts.indexOf(c)?!0:!1}
var isParentOf=function(b,c){return b===c?!0:b.children?b.children.some(function(b){return isParentOf(b,c)}):!1},followScroll=!0,latticeVisOpts=[{name:"Hasse diagram",val:"dagre",tooltip:"A layered graph diagram"},{name:"Matrix",val:"matrix",tooltip:"matrix"},{name:"Sankey",val:"sankey",tooltip:"Snakey"},{name:"Tree",val:"tree",tooltip:"A concept in a tree has only one parent and no edges crossings"},{name:"Sunburst",val:"sunburst",tooltip:"A radial tree-like layout where the root node is at the center, with leaves on the circumference"},
{name:"iCicle",val:"icicle",tooltip:"Similar to sunburst but not radial"}],ARVisOpts=[{name:"Matrix",val:"matrixview",tooltip:"Association rules interdependence"},{name:"Radial diagram",val:"radiagram",tooltip:"Association rules interdependence"}],sizeOpts=[{name:"Default",val:"default",tooltip:"Default option"}],colorOpts=[{name:"Default",val:"default",tooltip:"Default option"},{name:"IDs",val:"ids",tooltip:"Assign colors according to node id, making easier to identify the same concept across the visualisations"}],
LabelOpts=[{name:"Multi-label",val:"multi-label",tooltip:"Labels are not repeated down in the hierarchy"},{name:"Repetitive",val:"repetitive",tooltip:"Labels are repeated for each node"}],edgeOpts=[{name:"Default",val:"default",tooltip:"Default edge"}],selectedConcepts=[];$(document).mouseup(function(b){$(b.target).closest(".toolbarPanel").length||$(".toolbarPanel").hide()});
$(function(){var b=$("#chart");$(window).scroll(function(){followScroll&&("matrixview"==currentVis?b.css({position:"absolute",top:"128px"}):102<=document.documentElement.scrollTop||102<=window.pageYOffset?$.browser.msie&&"6.0"==$.browser.version?b.css("top",document.documentElement.scrollTop+55+"px"):b.css({position:"fixed",top:"55px"}):(102>document.documentElement.scrollTop||102>window.pageYOffset)&&b.css({position:"absolute",top:"128px"}))});$("body").tooltip({selector:"[rel=tooltip]",delay:{show:300,
hide:100}});$("#hideVisPanel").click(function(){$(".toolbarPanel").hide()});$(".visButton").click(function(){$(".toolbarPanel").hide();$("#visPanel").show()});$(".highlightButton").click(function(){$(".toolbarPanel").hide();$("#highlightPanel").show()});$(".metricButton").click(function(){$(".toolbarPanel").hide();$("#metricPanel").show()});$("input:radio[name='toggle']").change(function(){"rules"==$(this).val()?($("#dashboard_lattice").hide(),$("#dashboard_ar").show(),d3.select("#chart").html(""),
fetchAssociationRules(initARView),currentVis="matrixview",buildOptionsForSelect(ARVisOpts,"select-vis","matrixview"),disableDrawingOptionsForAR(!0)):($("#dashboard_ar").hide(),$("#toolbar").show(),$("#dashboard_lattice").show(),changeVis("dagre"),buildOptionsForSelect(latticeVisOpts,"select-vis","matrix"),disableDrawingOptionsForAR(!1))});buildOptionsForSelect(latticeVisOpts,"select-vis","dagre");buildOptionsForSelect(edgeOpts,"select-edge","default");buildOptionsForSelect(sizeOpts,"select-size",
"default");buildOptionsForSelect(colorOpts,"select-color","default");buildOptionsForSelect(LabelOpts,"select-label","multi-label");metrics.addLinkListener(addLinkMetricComponentsCallback);metrics.addListener(addMetricComponentsCallback);metrics.addListener(appendMetricFilterCallback);$("input[name='label-for-attr']").change(function(){displayAttrLabel=$(this).is(":checked");updateVis()});$("input[name='label-for-obj']").change(function(){displayObjLabel=$(this).is(":checked");updateVis()});$("#select-label").change(function(){changeLabel($(this).attr("value"))});
$("#select-edge").change(function(){changeEdgeThickness($(this).attr("value"))});$("#select-size").change(function(){changeNodeSize($(this).attr("value"))});$("#select-color").change(function(){changeNodeColor($(this).attr("value"))});$("#select-vis").change(function(){changeVis($(this).attr("value"))});$("input[name='highlight_path']").change(function(){highlightPath=$(this).is(":checked")});$(".distribution-view").click(function(){$(".graph-view").removeClass("active");$(".distribution-view").addClass("active");
$("#filters_container").show();$("#graph_container").hide()});$(".graph-view").click(function(){$(".graph-view").addClass("active");$(".distribution-view").removeClass("active");$("#graph_container").show();$("#filters_container").hide()});$(".filter-search").click(function(){filterSelected();$("input.search").tokenInput("clear")});$("a.remove-filter").live("click",function(b){var e=this.parentNode.id.split("-");1<e.length?removeFilter(e[0],e[1]):removeFilter(e[0]);b.stopPropagation();return!1});
$("#selAllAttr").click(function(){var b=this.checked;$("input[name='attr']").each(function(){this.checked=b})});$("#selAllObj").click(function(){var b=this.checked;$("input[name='obj']").each(function(){this.checked=b})});$(".filter-objs").click(function(){filterObjects()});$(".filter-attrs").click(function(){filterAttributes()});$("#slider-zoom").slider({value:100,min:10,max:500,step:10,slide:function(b,e){zoomInOut(e.value)}});$("#zoom_level").val("100%");$("#zoom_level").click(function(){resetZoom()});
$("a.collapse-dashboard").click(function(){inflateDiv(1);$("#expand-dashboard").show()});$("a.expand-dashboard").click(function(){inflateDiv(2);$("#expand-dashboard").hide()});$("#hoverbox").hover(function(){mouseOverHoverBox=!0},function(){mouseOverHoverBox=!1;setTimeout(function(){mouseOverHoverBox||hoverbox.transition().duration(200).style("opacity",0).style("display","none")},1800)});$("#hidePanel").click(function(){$("#showEntitiesPanel").show("normal").animate({width:"40px",opacity:1},200);
$("#panel").animate({marginLeft:"-175px"},500);$("#colleft").animate({width:"0px",opacity:0},400);$("#showPanel").show("normal").animate({width:"40px",opacity:1},200)});$("#showPanel").click(function(){$("#showEntitiesPanel").hide();$("#panel").animate({marginLeft:"0px"},400);$("#colleft").animate({width:"175px",opacity:1},400);$("#showPanel").animate({width:"0px",opacity:0},600).hide("slow")});$("#hideEntPanel").click(function(){$("#showPanel").show("normal").animate({width:"40px",opacity:1},200);
$("#entityPanel").animate({marginLeft:"-175px"},500);$("#entityContainer").animate({width:"0px",opacity:0},400);$("#showEntitiesPanel").show("normal").animate({width:"40px",opacity:1},200)});$("#showEntitiesPanel").click(function(){$("#showPanel").hide();$("#entityPanel").animate({marginLeft:"0px"},400);$("#entityContainer").animate({width:"175px",opacity:1},400);$("#showEntitiesPanel").animate({width:"0px",opacity:0},600).hide("slow")});$(".tabs").bind("change",function(b){b.target;b.relatedTarget});
$("#hideFiltersPanel").click(function(){$("#thepanel").animate({marginLeft:"-210px"},500);$("#filtersPanel").animate({height:"1px",opacity:0},400);$("#showFiltersPanel").show("normal").animate({height:"20px",opacity:1},200)});$("#showFiltersPanel").live("click",function(){$("#thepanel").animate({marginLeft:"0px"},400);$("#filtersPanel").animate({height:"210px",opacity:1},400);$("#showFiltersPanel").animate({height:"0px",opacity:0},600).hide("slow")});$("a.clear-sel").click(function(){clearSelection()});
$("a.reset-filters").click(function(){resetFilters()});$(".draw-chart-1a").click(function(){createHorizontalBarChart("box1a-chart",$("#control_1").selectedPairsArray(),$("#control_2").selectedPairsArray())});initDashboard();$("a.cancel-upload").live("click",function(){$("#cxt-file").popover("hide")});$("#cxt-file").click(function(){$("#cxt-file").popover("show")});$("#cxt-file").popover({placement:"bottom",html:"true",trigger:"manual",title:function(){return"Open cxt file"},content:function(){return $("#open-file").html()}});
$("a.compare").click(function(){plotCompare()})});function inflateDiv(b){1==b?($("#columns").animate({width:"1px",opacity:0},400),$("#columns").hide(),$("#chart").animate({width:"1040px"},400),followScroll=!1,w=MAXIMIZED_WIDTH,h=MAXIMIZED_HEIGHT,redrawCurVis()):(followScroll=!0,w=DEFAULT_WIDTH,h=$("#chart").height(),redrawCurVis(),$("#chart").animate({width:"570px"},400),$("#columns").show(),$("#columns").animate({width:"570px",opacity:1},400))}
function getAttributeValuesPairs(){var b=[],c;for(c in context.attributeNames)for(var e=context.attributeNames[c],g=0;g<e.length;g++){var p={};p.valueIdx=g;if("yes"==e[g][0]||"no"==e[g][0]){p.name=c;p.attrName=c;p.booleanAttr=!0;b.push(p);break}else p.booleanAttr=!1,p.attrName=c,p.valueName=e[g][0],p.name=c+SEPARATOR+e[g][0],b.push(p)}return b}function searchInput(){for(var b=$("#search").tokenInput("get"),c="",e=0;e<b.length;e++)c+=b[e].name+",";searchConcept(c)}
function buildOptionsForSelect(b,c,e){c=$("#"+c);c.empty();for(var g,p=0;p<b.length;p++)g=$('<option value="'+b[p].val+'" rel="tooltip"  data-trigger="hover" data-placement="right" data-title="'+b[p].tooltip+'">'+b[p].name+"</option>"),b[p].val==e&&g.attr("selected","selected"),c.append(g)}function appendOptionForSelect(b,c,e,g){b=$('<option value="'+c+'" rel="tooltip"  data-trigger="hover" data-placement="right" data-title="'+e+'">'+b+"</option>");$("#"+g).append(b)}
function addOrReplaceToSelectionList(b,c){c&&$("#selection_list").empty();for(var e=0;e<b.length;e++){var g=b[e];$("<li>").appendTo("#selection_list").html("Attributes: <span>"+g.attr("intent")+"</span><BR/> Objects: <span>"+g.attr("extent")+"</span>")}}
function updateEntityList(){$("#attr_list").empty();$("#obj_list").empty();for(var b=getAttributeValuesPairs(),c=0;c<b.length;c++){var e=$("<li>").appendTo("#attr_list");e.html("<span><input type='checkbox' name='attr' value='"+b[c].name+"'> "+b[c].name+"</span>")}for(var g=context.objects,c=0;c<g.length;c++)e=$("<li>").appendTo("#obj_list"),e.html("<span><input type='checkbox' name='obj' value='"+g[c]+"'> "+g[c]+"</span>");$("#attr-count").html(b.length);$("#obj-count").html(g.length)}
function addMetricComponentsCallback(b,c){"cluster"==b?appendOptionForSelect(c,b,"Nodes are drawn according to this metric value","select-color"):(appendOptionForSelect(c,b,"Nodes are drawn according to this metric value","select-label"),appendOptionForSelect(c,b,"Nodes are drawn according to this metric value","select-size"))}function addLinkMetricComponentsCallback(b,c){appendOptionForSelect(c,b,"Edge thickness are drawn according to this metric value","select-edge")}
function appendMetricFilterCallback(b,c){if("cluster"!=b){var e=$('<label for="'+b+'" style="text-align: left; ">'+c+":</label>"),g=$('<input type="text" id="'+b+'-value" class="metric-value" name="'+c+'"  />'),p=$('<div id="slider-'+b+'" class="slider"></div>'),q=$("<div></div>");$(q).append(e);$(q).append(g);$(q).append(p);$("#metric-filter-content").append(q);"esupport"==b?$("#slider-"+b).slider({range:!0,min:0,max:100,values:[0,100],slide:function(e,c){$("#"+b+"-value").val(c.values[0]+"% - "+
c.values[1]+"%");filterConceptsByMetric(b,c.values[0],c.values[1])}}):$("#slider-"+b).slider({min:0,max:100,value:[0],slide:function(e,c){$("#"+b+"-value").val(c.value+"%");filterConceptsByMetric(b,c.value,null)}})}}function wrapperElementsInList(b,c){b.empty();$(c).each(function(e,c){b.append($(document.createElement("li")).text(c))})}
function wrapperMetricsinTable(b,c){$("#"+b).html("");$("<table></table>");$("<table></table>");$("<table></table>");var e="<table><tr><th>Metric</th><th>Value</th></tr>",g;for(g in c)e+="<tr><td>"+metrics.getHumanName(g)+"</td><td>"+Math.round(100*c[g])+"%</td></tr>";$("#"+b).append(e+"</table>")}
function showHoverbox(b){mouseOverHoverBox=!0;hoverbox.style("display","block");hoverbox.transition().delay(800).duration(300).style("opacity",1);hoverbox.style("left",d3.event.pageX+20+"px").style("top",d3.event.pageY-20+"px");$(".attr-count-concept").text(b.intent.length);$(".obj-count-concept").text(b.extent.length);wrapperElementsInList($("ul.hb_attr_list"),b.intent);wrapperElementsInList($("ul.hb_obj_list"),b.extent);wrapperMetricsinTable("metrics-table",metrics.getScores(b.id))}
function hideHoverbox(){mouseOverHoverBox=!1;setTimeout(function(){mouseOverHoverBox||hoverbox.transition().duration(200).style("opacity",0).style("display","none")},1800)}function nodeMouseOver(b){showHoverbox(b);updateDistributionChart(b)}function nodeMouseOut(){hideHoverbox()}var selection=[];
function nodeClick(b){clearSearch();var c=selection.indexOf(b);0>c?selection.push(b):selection.splice(c,1);$("#sel-count").text("("+selection.length+")");radarChart.updateSeries(selection);c=$("li#sel-"+b.id);c.length?c.remove():$('<li id="sel-'+b.id+'">').appendTo("#selection_list").html("Attributes: <span>"+b.intent.join(", ")+"</span><BR/> Objects: <span>"+b.extent.join(", ")+"</span>");d3.select("#node-"+b.id).classed("selected",!c.length)}
$(function(){$("input[name='metric']").change(function(){calculate($(this).val())});$(".clustering-ok").click(function(){calculate("cluster",$("#n_clusters").val())})});
function calculate(b,c){if("undefined"==typeof lattice.id||null==lattice.id)flashAlert("The current concept lattice is not saved in the server - could not compute metric.","error");else if("undefined"==typeof metric_stability){"cluster"==b?showLoading():$("input[name='metric'][value='"+b+"']").parent().append("<img name='"+b+"' src='"+STATIC_URL+"/images/loading-trans.gif'/>");var e=$("input[name=csrfmiddlewaretoken]").val(),e={lattice_id:lattice.id,metric:b,csrfmiddlewaretoken:e};c&&(e.param=c);
$.getJSON("/api/v1/metrics/",e,function(e){"cluster"==b?(hideLoading(),e.human_name="Cluster"):($("img[name='"+b+"']").remove(),$("input[name='metric'][value='"+b+"']").prop("disabled",!0));e.link_score?metrics.appendLinkMetric(e.name,e.human_name,e.scores):metrics.appendMetricValues(e.name,e.human_name,e.scores)})}}
var metrics=new function(){var b={},c={},e=[],g={},p=[];this.addListener=function(b){e.push(b)};this.addLinkListener=function(b){p.push(b)};this.appendLinkMetric=function(b,e,c){var z={},A;for(A in c){var B=A.split("-"),C=B[1];"undefined"==typeof z[B[0]]&&(z[B[0]]={});z[B[0]][C]=c[A]}g[b]={humanName:e,scores:z};for(z=0;z<p.length;z++)p[z](b,e,c)};this.appendMetricValues=function(g,p,v){c[g]=p;for(var z in v)z in b||(b[z]={}),b[z][g]=v[z];for(z=0;z<e.length;z++)e[z](g,p,v)};this.getCalculatedMetrics=
function(){var e=[],c=Object.keys(b)[0];for(metric in b[c])e.push(metric);return e};this.getScore=function(e,c){return b[e][c]};this.getScores=function(b){for(var e={},c=this.getCalculatedMetrics(),g=0;g<c.length;g++){var p=c[g];e[p]=this.getScore(b,p)}return e};this.getLinkScore=function(b,e,c){return g[c].scores[b][e]};this.getHumanName=function(b){return c[b]}};
function filterConceptsByMetric(b,c,e){$("input.metric-value");for(var g=0;g<lattice.initialConcepts.length;g++){var p=lattice.initialConcepts[g];null!=e?metrics.getScore(p.id,b)<c/100||metrics.getScore(p.id,b)>e/100?lattice.removeConcept(p):lattice.readdConcept(p):metrics.getScore(p.id,b)<c/100?lattice.removeConcept(p):lattice.readdConcept(p)}updateVis()}
function clearSearch(){0<selection.length&&0<$("#search").val().length&&confirm("Selecting will discard your current search. Proceed?")&&(selection=[],$("#search").val(""))}function clearSelection(){clearSearch();vis.selectAll(".selected").classed("selected",!1);$("#selection_list").empty()}
function searchConcept(b){var c=b.split(",");c.splice(c.length-1,1);removeWhiteSpaces(b);for(b=0;b<lattice.concepts.length;b++){var e=lattice.concepts[b];if(0!=e.extent.length)if(ArrayContainsAll(e.intent,c)){var g=selection.indexOf(e);0>g&&selection.push(e);g=$("li#sel-"+e.id);g.length?g.remove():$('<li id="sel-'+e.id+'">').appendTo("#selection_list").html("Attributes: <span>"+e.intent.join(", ")+"</span><BR/> Objects: <span>"+e.extent.join(", ")+"</span>");d3.select("#node-"+e.id).classed("selected",
!0)}else g=selection.indexOf(e),0<=g&&selection.splice(g,1),d3.select("#node-"+e.id).classed("selected",!1)}$("#sel-count").text("("+selection.length+")");radarChart.updateSeries(selection)}var queryResults,colTypes={};
$(function(){$("input.load-context").prop("disabled",!0);$("ul.nav > li.active").removeClass("active");$("li#semantics").addClass("active");$(".sel-col-type").live("click",function(b){var c=b.target.name.split("_col-");colTypes[c[0]]=c[1];$('i[name="'+c[0]+'-selected"]').remove();$(b.target).append('<i name="'+c[0]+'-selected" class="icon-ok"></i>')});$("a.sparql-search").click(function(){var b=$("textarea#search_prefix").val(),c=$("textarea#search_query").val(),e=$("input[name=csrfmiddlewaretoken]").val();
$("div#sparql_result").empty();showLoading();$.get("/"+WORKSPACE_SLUG+"/semantics/search",{format:"json",search_prefix:b,search_query:c,csrfmiddlewaretoken:e},function(b){queryResults=b;hideLoading();$("input.load-context").prop("disabled",!1);$("input.load-context").removeClass("disabled");if("undefined"==typeof b.error){for(var e=$('<table class="table table-striped"></table>'),c=$("<tr></tr>"),r=0;r<b.head.vars.length;r++)c.append("<th>"+getOptionsHeader(b.head.vars[r])+"</th>");e.append(c.appendTo("<thead></thead>"));
for(r=0;r<b.results.bindings.length;r++){for(var c=$("<tr></tr>"),v=b.results.bindings[r],z=0;z<b.head.vars.length;z++){var A=v[b.head.vars[z]].value;-1!=A.indexOf("#")&&(A=A.split("#")[1]);c.append("<td>"+A+"</td>")}e.append(c)}e.appendTo("div#sparql_result")}else $("div#sparql_result").html(b.error)})})});
function getOptionsHeader(b){return' <ul class="nav nav-tabs">  <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#">  '+b+' <b class="caret"></b> </a><ul class="dropdown-menu"> <a href="#" name="'+b+'_col-obj" class="sel-col-type ">Object</a> <a href="#" name="'+b+'_col-attr" class="sel-col-type "> Attribute name</a> <a href="#" name="'+b+'_col-attrval" class="sel-col-type "> Attribute value</a></ul></li></ul>'}
function prepareForSubmission(){var b=JSON.stringify(queryResults,null,2),c=JSON.stringify(colTypes,null,2);$("input[name=col_types]").val(c);$("input[name=results_table]").val(b);return!0}function flatten(b){function c(b){b.children&&b.children.forEach(c);b.id||(b.id=++g);e.push(b)}var e=[],g=0;c(b);return e}
function unique_set(b,c){c||(c=!1);arr=[];if(c)for(i=0;i<b.length;i++){flag=!0;for(j=0;j<arr.length;j++){var e;e=arr[j];var g=b[i];result=!0;if(e.length!==g.length)e=!1;else{for(k=0;k<e.length;k++)compare_objects(e[k],g[k])||(result=!1);e=result}e&&(flag=!1)}flag&&arr.push(b[i])}else for(i=0;i<b.length;i++){flag=!0;for(j=0;j<arr.length;j++)compare_objects(arr[j],b[i])&&(flag=!1);flag&&arr.push(b[i])}return arr}
var compare_objects=function(b,c){if(b===c)return!0;if(!(b instanceof Object)||!(c instanceof Object)||b.constructor!==c.constructor)return!1;for(var e in b)if(b.hasOwnProperty(e)&&(!c.hasOwnProperty(e)||b[e]!==c[e]&&("object"!==typeof b[e]||!Object.equals(b[e],c[e]))))return!1;for(e in c)if(c.hasOwnProperty(e)&&!b.hasOwnProperty(e))return!1;return!0};
function compare_a_rules(b,c){tmp1={};tmp2={};tmp1.prem=clone(b.premise);tmp1.conc=clone(b.conclusion);tmp2.prem=clone(c.premise);tmp2.conc=clone(c.conclusion);sub_sets_equal=compare_objects(tmp1.prem,tmp2.prem)&&compare_objects(tmp1.conc,tmp2.conc);tmp1=clone(b);tmp2=clone(c);tmp1.premise=1;tmp1.conclusion=1;tmp2.premise=1;tmp2.conclusion=1;return compare_objects(tmp1,tmp2)&&sub_sets_equal}
Array.prototype.transpose=function(){var b=this.length?this.length:0,c=this[0]instanceof Array?this[0].length:0;if(0===c||0===b)return[];var e,g,p=[];for(e=0;e<c;e++){p[e]=[];for(g=0;g<b;g++)p[e][g]=this[g][e]}return p};function clone(b){if(!b||"object"!==typeof b)return b;var c="function"===typeof b.pop?[]:{},e,g;for(e in b)b.hasOwnProperty(e)&&(g=b[e],c[e]=g&&"object"===typeof g?clone(g):g);return c}function ArrayAddAll(b,c){for(var e=0;e<b.length;e++)0>c.indexOf(b[e])&&c.push(b[e])}
function ArraySubtract(b,c){for(var e=[],g=0;g<b.length;g++)0<=c.indexOf(b[g])||e.push(b[g]);return e}function ArraySubtractId(b,c){for(var e=[],g=0;g<b.length;g++){for(var p=!1,q=0;q<c.length&&!p;q++)b[g].id==c[q].id&&(p=!0);p||e.push(b[g])}return e}function ArrayIntersect(b,c){for(var e=[],g=0;g<b.length;g++)!isBlank(b[g])&&0<=c.indexOf($.trim(b[g]))&&e.push(b[g]);return e}
function ArrayContainsAll(b,c){if(0==b.length)return!1;for(var e=0;e<c.length;e++)if(!isBlank(c[e])&&0>b.indexOf($.trim(c[e])))return!1;return!0}function ArrayIntersectId(b,c){for(var e=[],g=0;g<b.length;g++)for(var p=0;p<c.length;p++)b[g].id==c[p].id&&e.push(b[g]);return e}function ArrayRemove(b,c,e){e=b.slice((e||c)+1||b.length);b.length=0>c?b.length+c:c;return b.push.apply(b,e)}function HashClone(b){return jQuery.extend(!0,{},b)}function getKeys(b){var c=[],e;for(e in b)c.push(e);return c}
String.prototype.escapeHTML=function(){return this.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")};function isBlank(b){return!b||/^\s*$/.test(b)}function removeWhiteSpaces(b){return b=b.replace(/\s/g,"")}
var dagreVis=new function(){this.config={displayLabels:!0,nodePadding:10,widthLabelBox:60,paddingToNode:12};this.run=function(){d3.select("#chart").html("");vis=d3.select("#chart").append("svg:svg").attr("width",w).attr("height",h).attr("viewBox","0 0 "+w+" "+h).attr("preserveAspectRatio","xMidYMid").append("svg:g");lattice.concepts.forEach(function(b){b.edges=[]});lattice.edges.forEach(function(b){"number"===typeof b.source&&(b.source=lattice.concepts[b.source],b.target=lattice.concepts[b.target]);
b.source.edges.push(b);b.target.edges.push(b)});var b=vis.selectAll("path .dedge").data(lattice.edges).enter().append("path").attr("class","dedge").style("stroke-width",getEdgeThickness).attr("source_id",function(b){return b.source.id}).attr("target_id",function(b){return b.target.id}),c=vis.selectAll("circle .concept").data(lattice.concepts).enter().append("circle").attr("class","concept node").style("fill",getNodeColor).attr("x",function(){return-10}).attr("y",function(){return-10}).attr("r",getNodeSize).attr("id",
function(b){return"node-"+b.id}).on("click",this.nodeClick).on("mouseover",this.nodeMouseOver).on("mouseout",this.nodeMouseOut),e=vis.selectAll("text .intent").data(lattice.concepts).enter().append("text").attr("id",function(b){return"intent-"+b.id}).attr("class","intent").attr("x",4).attr("y",-dagreVis.config.paddingToNode).text(get_upper_label),g=vis.selectAll("text .extent").data(lattice.concepts).enter().append("text").attr("id",function(b){return"extent-"+b.id}).attr("class","extent").attr("x",
4).attr("y",dagreVis.config.paddingToNode).text(get_lower_label);c.each(function(b){var e=this.getBBox();b.bbox=e;b.width=getNodeSize(b);b.height=getNodeSize(b)});dagre.layout().nodeSep(50).edgeSep(10).rankSep(80).invert(!0).nodes(lattice.concepts).edges(lattice.edges).debugLevel(1).run();c.attr("transform",function(b){return"translate("+b.dagre.x+","+b.dagre.y+")"});b.attr("id",function(b){return"edge-"+b.dagre.id}).attr("d",function(b){return dagreVis.spline(b)});e.attr("transform",function(b){return"translate("+
(b.dagre.x-dagreVis.config.widthLabelBox/2)+","+(b.dagre.y-dagreVis.config.paddingToNode)+")"});g.attr("transform",function(b){return"translate("+(b.dagre.x-dagreVis.config.widthLabelBox/2)+","+(b.dagre.y+dagreVis.config.paddingToNode)+")"});var b=d3.select("#chart").select("svg"),p=b.node().getBBox();b.attr("viewBox","0 0 "+p.width+" "+h);b=d3.behavior.drag().origin(function(b){return b.pos?{x:b.pos.x,y:b.pos.y}:{x:b.dagre.x,y:b.dagre.y}}).on("dragstart",function(){vis.on("mousedown.zoom",null);
vis.on("mousemove.zoom",null)}).on("dragend",function(){console.log("drag ended");dragging=!1}).on("drag",function(b){var e=b.dagre.x,c=b.dagre.y;b.dagre.x=Math.max(b.width/2,Math.min(p.width-b.width/2,d3.event.x));b.dagre.y=Math.max(b.height/2,Math.min(p.height-b.height/2,d3.event.y));d3.select(this).attr("transform","translate("+b.dagre.x+","+b.dagre.y+")");var g=b.dagre.x-e,A=b.dagre.y-c;b.edges.forEach(function(b){dagreVis.translateEdge(b,g,A);d3.select("#edge-"+b.dagre.id).attr("d",dagreVis.spline(b))});
d3.select("#intent-"+b.id).attr("transform","translate("+(b.dagre.x-dagreVis.config.widthLabelBox/2)+","+(b.dagre.y-dagreVis.config.paddingToNode)+")");d3.select("#extent-"+b.id).attr("transform","translate("+(b.dagre.x-dagreVis.config.widthLabelBox/2)+","+(b.dagre.y+dagreVis.config.paddingToNode)+")")});g=d3.behavior.drag().on("dragstart",function(b){this.__originx__=b.lpos?b.lpos.x:b.dagre.x-dagreVis.config.widthLabelBox/2;this.__originy__=b.lpos?b.lpos.y:b.dagre.y-dagreVis.config.paddingToNode}).on("drag",
function(b){b.lpos={x:Math.max(0,Math.min(this.__originx__+=d3.event.dx,w)),y:Math.max(0,Math.min(this.__originy__+=d3.event.dy,h))};d3.select(this).attr("transform","translate("+b.lpos.x+","+b.lpos.y+")")});c.call(b);e.call(g)};this.move=function(){this.parentNode.appendChild(this);var b=d3.select(this);b.attr("cx",function(){return d3.event.dx+parseInt(b.attr("cx"))}).attr("cy",function(){return d3.event.dy+parseInt(b.attr("cy"))})};this.spline=function(b){var c=b.dagre.points.slice(0),e=dagre.util.intersectRect(b.source.dagre,
0<c.length?c[0]:b.source.dagre),b=dagre.util.intersectRect(b.target.dagre,0<c.length?c[c.length-1]:b.source.dagre);c.unshift(e);c.push(b);pts=[e,b];return d3.svg.line().x(function(b){return b.x}).y(function(b){return b.y}).interpolate("linear")(pts)};this.translateEdge=function(b,c,e){b.dagre.points.forEach(function(b){b.x=Math.max(0,Math.min(800,b.x+c));b.y=Math.max(0,Math.min(600,b.y+e))})};this.nodeMouseOver=function(b){d3.select(this).transition().duration(250).attr("r",function(b){return 2*getNodeSize(b)});
nodeMouseOver(b);d3.select(this).classed("hover",!0);highlightPath&&visitEdgesDown(b,function(b){d3.select('path.dedge[source_id="'+b.source.id+'"][target_id="'+b.target.id+'"]').classed("highlighted",!0)})};this.nodeMouseOut=function(b){d3.select(this).transition().duration(250).attr("r",function(b){return getNodeSize(b)});nodeMouseOut(b);d3.select(this).classed("hover",!1);d3.selectAll("path.dedge.highlighted").classed("highlighted",!1)};this.nodeClick=function(b){nodeClick(b)}},labeling_type=LABEL_MULTILABEL,
size_type="default",color_type="default",highlightPath=!0,color=mapColor,currentVis="dagre",previousVis="dagre",w=DEFAULT_WIDTH,h=DEFAULT_HEIGHT,trans=[0,0],scale=1,force,vis,dragging=!1,noLinks=["sunburst","icicle","sankey"];function resetZoom(){scale=1;d3.behavior.zoom().scale(1);vis.attr("transform","translate("+w/2+","+h/2+") scale("+scale+")");$("#zoom_level").val("100%")}
function zoomInOut(b){var c=Math.round(100*(b/100))/100;d3.behavior.zoom().scale(1);vis.attr("transform","translate("+w/2+","+h/2+") scale("+c+")");$("#zoom_level").val(b+"%")}function redraw(){trans=d3.event.translate;scale=d3.event.scale;$("#zoom_level").val(Math.round(100*scale)+"%");vis.attr("transform","translate("+trans+") scale("+scale+")")}
function redrawCurVis(){d3.select("#chart").html("");"lattice"==currentVis?initFDLattice():"sankey"==currentVis?sankeyVis.run():"matrix"==currentVis?matrixVis.run():"dagre"==currentVis?dagreVis.run():"sunburst"==currentVis?sunburstVis.run():"icicle"==currentVis?initIcicle():"treemap"==currentVis?treemap():"tree"==currentVis?initTree():"matrixview"==currentVis?(initARView(),createRulesList()):"radiagram"==currentVis?(initDiagonalARView(),createRulesList()):"gg_ar_plot"==currentVis&&(init_gg_plot(),
createRulesList())}function changeVis(b){prevIndex=-1;currentVis=b;redrawCurVis();setPreferredVis(b)}function updateVis(){redrawCurVis()}function setPreferredVis(b){var c=$("input[name=csrfmiddlewaretoken]").val();$.post("/"+WORKSPACE_SLUG+"/fca/set_preferred_vis",{pref_vis:b,csrfmiddlewaretoken:c},function(){})}function setOverwhelmingOff(){var b=$("input[name=csrfmiddlewaretoken]").val();$.post("/"+WORKSPACE_SLUG+"/fca/set_overwhelming_off",{csrfmiddlewaretoken:b},function(){})}
function exportCurVis(){var b=d3.select("svg").attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;d3.select("#export-link").attr("title","file.svg").attr("target","_blank").attr("href-lang","image/svg+xml").attr("href","data:image/svg+xml;base64,\n"+btoa(b)).text("Download")}var rect;
function initIcicle(){x=d3.scale.linear().range([0,w]);y=d3.scale.linear().range([0,h]);vis=d3.select("#chart").append("svg:svg").attr("width",w).attr("height",h);partition=d3.layout.partition().value(function(){return 1});updateIcicle()}
function updateIcicle(){var b=lattice.getTree();vis.data([b]);partition.nodes(b);rect=vis.selectAll("rect").data(partition.nodes);rect.enter().append("svg:rect").attr("x",function(b){return x(b.x)}).attr("y",function(b){return y(b.y)}).attr("width",function(b){return x(b.dx)}).attr("height",function(b){return y(b.dy)}).attr("fill",getNodeColor).on("mouseover",nodeMouseOver).on("mouseout",nodeMouseOut).on("click",nodeClick).on("dblclick",icclick);vis.selectAll("rect").data(partition.nodes).enter().append("svg:text").attr("class",
"intent").attr("x",-22).attr("y","-1em").attr("id",function(b){return"intent_"+b.id}).text(d.intent.join(", "));rect.exit().remove()}function icclick(b){x.domain([b.x,b.x+b.dx]);y.domain([b.y,1]).range([b.y?20:0,h]);rect.transition().duration(750).attr("x",function(b){return x(b.x)}).attr("y",function(b){return y(b.y)}).attr("width",function(b){return x(b.x+b.dx)-x(b.x)}).attr("height",function(b){return y(b.y+b.dy)-y(b.y)})}var tree,root,diagonal,m,duration,treei=0;
function initTree(){function b(c){c.children&&(c._children=c.children,c._children.forEach(b),c.children=null)}m=[20,120,20,120];duration=500;tree=d3.layout.tree().size([h,w]);diagonal=d3.svg.diagonal().projection(function(b){return[b.y,b.x]});vis=d3.select("#chart").append("svg:svg").attr("width",w+m[1]+m[3]).attr("height",h+m[0]+m[2]).append("svg:g").attr("transform","translate("+m[3]+","+m[0]+")");root=lattice.getTree();root.x0=h/2;root.y0=0;root.children.forEach(b);updateTree(root)}
function updateTree(b){var c=tree.nodes(root).reverse();c.forEach(function(b){b.y=180*b.depth});var e=vis.selectAll("g.node").data(c,function(b){return b.id}),g=e.enter().append("svg:g").attr("class","node").attr("transform",function(){return"translate("+b.y0+","+b.x0+")"}).on("dblclick",clickCollapse);g.append("svg:circle").attr("class","node concept").attr("id",function(b){return"node-"+b.id}).attr("r",getNodeSize).style("fill",getNodeColor).on("click",nodeClick).on("mouseover",nodeMouseOver).on("mouseout",
nodeMouseOut);g.append("svg:text").attr("class","intent").attr("x",function(b){return b.children||b._children?-10:10}).attr("dy","-1.5em").attr("text-anchor",function(b){return b.children||b._children?"end":"start"}).text(get_upper_label).style("fill-opacity",1E-6);g.append("svg:text").attr("class","extent").attr("x",function(b){return b.children||b._children?-10:10}).attr("dy","1.5em").attr("text-anchor",function(b){return b.children||b._children?"end":"start"}).text(get_lower_label).style("fill-opacity",
1E-6);e.transition().duration(duration).attr("transform",function(b){return"translate("+b.y+","+b.x+")"}).selectAll("text").style("fill-opacity",1);e.exit().transition().duration(duration).attr("transform",function(){return"translate("+b.y+","+b.x+")"}).remove().selectAll("text").style("fill-opacity",1E-6);e=vis.selectAll("path.treelink").data(tree.links(c),function(b){return b.target.id});e.enter().insert("svg:path","g").attr("class","treelink").attr("source_id",function(b){return b.source_id}).attr("target_id",
function(b){return b.target_id}).attr("d",function(){var e={x:b.x0,y:b.y0};return diagonal({source:e,target:e})}).transition().duration(duration).attr("d",diagonal);e.transition().duration(duration).attr("d",diagonal);e.exit().transition().duration(duration).attr("d",function(){var e={x:b.x,y:b.y};return diagonal({source:e,target:e})}).remove();c.forEach(function(b){b.x0=b.x;b.y0=b.y})}
function clickCollapse(b){b.children?(b._children=b.children,b.children=null):(b.children=b._children,b._children=null);updateTree(b)}var tm_root;
function treemap(){console.log("initilizing treemap");m=[20,120,20,120];duration=500;treemap=d3.layout.treemap().size([h,w]).sticky(!0).value(function(b){return size_type==SIZE_SUPPORT?b.support:size_type==SIZE_STABILITY?b.stability:1});vis=d3.select("#chart").append("svg:svg").attr("width",w+m[1]+m[3]).attr("height",h+m[0]+m[2]).append("svg:g");tm_root=getTree0();tm_root.x0=0;tm_root.y0=0;tm_updateTree(tm_root)}
function tm_updateTree(b){console.log("updating");color=d3.scale.category20c();var c=treemap.nodes(tm_root),c=vis.selectAll("g.node").data(c,function(){return size_type==SIZE_SUPPORT?d.support:size_type==SIZE_STABILITY?d.stability:1}),e=c.enter().append("svg:g").attr("class","node").attr("transform",function(){return"translate("+tm_root.y0+","+tm_root.x0+")"}).on("dblclick",clickCollapse);e.append("svg:rect").attr("x",function(b){return b.x}).attr("y",function(b){return b.y}).attr("width",function(b){return Math.max(0,
b.dx)}).attr("height",function(b){return Math.max(0,b.dy)}).style("fill",function(b){return color(b.depth)}).style("stroke","white").style("opacity",1).on("mouseover",nodeMouseOver).on("mouseout",nodeMouseOut);e.append("svg:text").attr("class","intent").attr("x",function(b){return b.x}).attr("y",function(b){return b.y+30}).text(get_upper_label).style("fill-opacity",1E-6);e.append("svg:text").attr("class","extent").attr("x",function(b){return b.x}).attr("y",function(b){return b.y+15}).text(get_lower_label).style("fill-opacity",
1E-6);c.transition().duration(duration).attr("transform",function(b){return"translate("+b.y0+","+b.x0+")"}).selectAll("text").style("fill-opacity",1);c.exit().transition().duration(duration).style("fill-opacity",1).attr("transform",function(){return"translate("+b.y0+","+b.x0+")"}).remove().selectAll("text").style("fill-opacity",1E-6)}
function init_matrix_view(){function b(b){d3.select(this).selectAll(".cell").data(b.filter(function(b){return b.z})).enter().append("rect").attr("class","cell").attr("x",function(b){return b.y*w/g}).attr("width",w/g).attr("height",h/myobject.length).style("fill-opacity",function(b){return b.confidence}).style("fill",function(b){return z(b.z)})}var c=[20,120,20,120],e=[],g=0,p=[];for(a in context.attributeNames)for(q=0;q<context.attributeNames[a].length;q++)"yes"==context.attributeNames[a][q][0]?p.push(a.toString()):
"no"!=context.attributeNames[a][q][0]&&p.push(a.toString()+"-"+context.attributeNames[a][q][0]);for(var g=p.length,q=0;q<myobject.length;q++)e[q]=[],e[q]=d3.range(g).map(function(b){return{x:q,y:b,z:0}});for(q=0;q<myobject.length;q++)for(var r=0;r<g;r++){for(var v=0;v<myobject[q].premise.length;v++)p[r]==myobject[q].premise[v]&&(e[q][r].z=1,e[q][r].confidence=myobject[q].confidence,e[q][r].premise_supp=myobject[q].premise_supp,e[q][r].conclusion_supp=myobject[q].conclusion_supp,e[q][r].premise=myobject[q].premise,
e[q][r].conclusion=myobject[q].conclusion);for(v=0;v<myobject[q].conclusion.length;v++)p[r]==myobject[q].conclusion[v]&&(e[q][r].z=2,e[q][r].confidence=myobject[q].confidence,e[q][r].premise_supp=myobject[q].premise_supp,e[q][r].conclusion_supp=myobject[q].conclusion_supp,e[q][r].premise=myobject[q].premise,e[q][r].conclusion=myobject[q].conclusion)}d3.scale.ordinal().rangeBand([0,w]);d3.scale.linear().domain([0,4]).clamp(!0);var z=d3.scale.category10().domain(d3.range(10)),r=0;for(q in context.attributeNames)r=
Math.max(r,q.length);c[0]=12*r;for(q=r=0;q<myobject.length;q++)r=Math.max(r,myobject[q].premise.toString().length);c[1]=10+10*Math.log(myobject.length)/Math.LN10;vis=d3.select("#chart").append("svg:svg").attr("width",w+c[1]+c[3]).attr("height",h+c[0]+c[2]).append("svg:g").attr("transform","translate("+c[1]+","+c[0]+")");vis.append("rect").attr("class","background").attr("width",width).attr("height",height);b=vis.selectAll(".row").data(e).enter().append("g").attr("class","row").attr("transform",function(b){return"translate(0,"+
b[0].x*h/myobject.length+")"}).each(b);b.append("line").attr("x2",w).attr("class","matrix_view_separator");b.append("text").attr("x",0).attr("dy","1em").attr("text-anchor","end").attr("class","label").text(function(b,e){return"R"+e.toString()});c=vis.selectAll(".column").data(e.transpose()).enter().append("g").attr("class","column").attr("transform",function(b,e){return"translate("+b[e].y*w/g+")rotate(-90)"});c.append("line").attr("x1",-w).attr("class","matrix_view_separator");c.append("text").attr("class",
"label").attr("x",0).attr("dy","1em").attr("text-anchor","start").text(function(b,e){return p[e]})}function initFDLattice(){force=d3.layout.force().gravity(0.1).distance(100).charge(-320).on("tick",tick).size([w,h]);vis=d3.select("#chart").append("svg:svg").attr("width",w).attr("height",h).attr("pointer-events","all").append("svg:g").call(d3.behavior.zoom().on("zoom",redraw)).append("svg:g");vis.append("svg:rect").attr("width",w).attr("height",h).attr("fill","white");updateFDLattice()}
function updateFDLattice(){var b=lattice.concepts,c=lattice.edges;force.nodes(b).links(c).start();clink=vis.selectAll("line.link").data(c);clink.enter().insert("svg:line",".node").attr("class","link").attr("x1",function(b){return b.source.x}).attr("y1",function(b){return b.source.y}).attr("x2",function(b){return b.target.x}).attr("y2",function(b){return b.target.y}).attr("source_id",function(b){return b.source.id}).attr("target_id",function(b){return b.target.id});clink.exit().remove();cnode=vis.selectAll("circle.node").data(b,
function(b){return b.id});cnode.enter().append("svg:circle").attr("class","node").attr("cx",function(b){return b.x}).attr("cy",function(b){return b.y}).attr("r",getNodeSize).attr("intent",function(b){return b.intent}).attr("extent",function(b){return b.extent}).attr("id",function(b){return b.id}).attr("children",function(b){return b.children}).on("click",nodeClick).on("mouseover",nodeMouseOver).on("mouseout",nodeMouseOut).call(force.drag);cnode.exit().remove();ulabel=vis.selectAll("text.intent").data(b,
function(b){return b.id});ulabel.enter().append("svg:text").attr("class","intent").attr("x",-22).attr("y","-1em").attr("id",function(b){return"intent_"+b.id}).text(get_upper_label);ulabel.exit().remove();llabel=vis.selectAll("text.extent").data(b,function(b){return b.id});llabel.enter().append("svg:text").attr("x",-22).attr("y","2em").attr("class","extent").attr("id",function(b){return"extent_"+b.id}).text(get_lower_label);llabel.exit().remove()}
function tick(b){clink.attr("x1",function(b){return b.source.x}).attr("y1",function(b){return b.source.y}).attr("x2",function(b){return b.target.x}).attr("y2",function(b){return b.target.y});cnode.attr("cx",function(b){return b.x}).attr("cy",function(b){return b.y});ulabel.attr("transform",function(b){return"translate("+b.x+","+b.y+")"});llabel.attr("transform",function(b){return"translate("+b.x+","+b.y+")"});var c=0.2*b.alpha;cnode.each(function(b){b.y+=(100*b.depth-b.y)*c})}
function labelizeLattice(b,c){function e(e){for(var e=b.indexOf(e),g=[],p=0;p<c.length;p++)c[p].source==e&&g.push(b[c[p].target]);return g}var g;a:{for(g=0;g<b.length;g++){for(var p=b.indexOf(b[g]),q=[],r=0;r<c.length;r++)c[r].target==p&&q.push(b[c[r].source]);if(0==q.length){g=b[g];break a}}g=void 0}a:{for(p=0;p<b.length;p++)if(0==e(b[p]).length){p=b[p];break a}p=void 0}var v=p.intent,p=g;g=function(b){b.upperLabel=ArrayIntersect(v,b.intent).join(", ");v=ArraySubtract(v,b.intent)};g(p);p=e(p);for(q=
0;q<p.length;q++)g(p[q]),r=e(p[q]),0<r.length&&ArrayAddAll(r,p)}
function createMiniLattice(b,c,e){labelizeLattice(b,c);var g=d3.select("#"+e).append("svg:svg").attr("width",200).attr("height",150).attr("viewBox","0 0 200 150").attr("preserveAspectRatio","xMidYMid").append("svg:g").attr("transform","translate(100,20)");b.forEach(function(b,c){b.id=e+"-"+c;b.edges=[]});c.forEach(function(c){"number"===typeof c.source&&(c.source=b[c.source],c.target=b[c.target]);c.id=c.source.id+"-"+c.target.id;c.source.edges.push(c);c.target.edges.push(c)});var p=g.selectAll("path .dedge").data(c).enter().append("path").attr("id",
function(b){return"mini-edge-"+b.id}).attr("class","dedge"),q=g.selectAll("circle .node").data(b).enter().append("circle").attr("class","node").attr("x",function(){return-10}).attr("y",function(){return-10}).attr("r",5).attr("id",function(b){return"mini-node-"+b.id}),g=g.selectAll("text .mini-intent").data(b).enter().append("text").attr("id",function(b){return"mini-intent-"+b.id}).attr("class","mini-intent").text(function(b){return b.upperLabel});q.each(function(b){b.width=10;b.height=10});g.attr("x",
function(){return-10}).attr("y",function(){return-5});dagre.layout().nodeSep(15).edgeSep(15).rankSep(25).invert(!1).nodes(b).edges(c).debugLevel(1).run();q.attr("transform",function(b){return"translate("+b.dagre.x+","+b.dagre.y+")"});g.attr("transform",function(b){return"translate("+(b.dagre.x-5)+","+(b.dagre.y-5)+")"});p.attr("d",function(b){return spline(b)});d3.select("#"+e).select("svg");d3.behavior.drag().origin(function(b){return b.pos?{x:b.pos.x,y:b.pos.y}:{x:b.dagre.x,y:b.dagre.y}}).on("drag",
function(b){var c=b.dagre.x,e=b.dagre.y;b.dagre.x=Math.max(b.width/2,Math.min(svgBBox2.width-b.width/2,d3.event.x));b.dagre.y=Math.max(b.height/2,Math.min(svgBBox2.height-b.height/2,d3.event.y));d3.select(this).attr("transform","translate("+b.dagre.x+","+b.dagre.y+")");var g=b.dagre.x-c,p=b.dagre.y-e;b.edges.forEach(function(b){translateEdge(b,g,p);d3.select("#mini-edge-"+b.id).attr("d",spline(b))});d3.select("#mini-intent-"+b.id).attr("transform","translate("+(b.dagre.x-5)+","+(b.dagre.y-5)+")")})}
function spline(b){var c=b.dagre.points.slice(0),e=dagre.util.intersectRect(b.source.dagre,0<c.length?c[0]:b.source.dagre),b=dagre.util.intersectRect(b.target.dagre,0<c.length?c[c.length-1]:b.source.dagre);c.unshift(e);c.push(b);pts=[e,b];return d3.svg.line().x(function(b){return b.x}).y(function(b){return b.y}).interpolate("linear")(pts)}function translateEdge(b,c,e){b.dagre.points.forEach(function(b){b.x=Math.max(0,Math.min(800,b.x+c));b.y=Math.max(0,Math.min(600,b.y+e))})}
function loadAttributeGraph(b){var c=DEFAULT_ATTR_GRAPH_WIDTH,e=DEFAULT_ATTR_GRAPH_HEIGHT,g=b.links,p=b.nodes;g.forEach(function(b){b.source=p[b.source_idx]||(p[b.source_idx]={name:b.source});b.target=p[b.target_idx]||(p[b.target_idx]={name:b.target})});b=d3.layout.force().nodes(d3.values(p)).links(g).size([c,e]).linkDistance(150).charge(-300).on("tick",function(){q.attr("d",function(b){var c=b.target.x-b.source.x,e=b.target.y-b.source.y,c=Math.sqrt(c*c+e*e);return"M"+b.source.x+","+b.source.y+"A"+
c+","+c+" 0 0,1 "+b.target.x+","+b.target.y});r.attr("transform",function(b){return"translate("+b.x+","+b.y+")"});v.attr("transform",function(b){return"translate("+b.x+","+b.y+")"})}).start();c=d3.select("#attr-graph").append("svg:svg").attr("width",c).attr("height",e);c.append("svg:defs").selectAll("marker").data(["suit","licensing","resolved"]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 -5 10 10").attr("refX",15).attr("refY",-1.5).attr("markerWidth",10).attr("markerHeight",
10).attr("markerUnits","userSpaceOnUse").attr("orient","auto").style("stroke-width",1).append("svg:path").attr("d","M0,-5L10,0L0,5");var q=c.append("svg:g").selectAll("path").data(b.links()).enter().append("svg:path").attr("class",function(){return"aglink suit"}).attr("marker-end",function(){return"url(#suit)"}).style("stroke-width",function(b){if(0!=b.total)return Math.round(14*(b.count/b.total))+2}),r=c.append("svg:g").selectAll("circle").data(b.nodes()).enter().append("svg:circle").attr("class",
"agcircle").attr("r",6).call(b.drag),v=c.append("svg:g").selectAll("g").data(b.nodes()).enter().append("svg:g");v.append("svg:text").attr("x",8).attr("y",".31em").attr("class","shadow").text(function(b){return b.name});v.append("svg:text").attr("x",8).attr("y",".31em").text(function(b){return b.name})}
function radialAttributeGraph(b){var c=DEFAULT_ATTR_GRAPH_WIDTH,e=DEFAULT_ATTR_GRAPH_HEIGHT,g=b.links,p=b.nodes;n=b.nodes.length;for(var b=function(b){return d3.svg.line().x(function(b){return b.x}).y(function(b){return b.y}).interpolate("linear")([{x:b.source.x,y:b.source.y},{x:b.target.x,y:b.target.y}])},q=function(b){var c=b.target.x-b.source.x,e=b.target.y-b.source.y,c=Math.sqrt(c*c+e*e);return"M"+b.source.x+","+b.source.y+"A"+c+","+c+" 0 0,1 "+b.target.x+","+b.target.y},r=0;r<p.length;r++){var v=
p[r];v.x=(c/2-50)*Math.cos(2*r*Math.PI/n);v.y=(c/2-50)*Math.sin(2*r*Math.PI/n)}g.forEach(function(b){b.source=p[b.source_idx];b.target=p[b.target_idx]});e=d3.select("#attr-graph").append("svg:svg").attr("width",c).attr("height",e).attr("viewBox","0 0 "+c+" "+e).attr("preserveAspectRatio","xMidYMid").append("svg:g").attr("transform","translate("+c/2+","+e/2+")");e.selectAll("path.attr-graph").data(g).enter().append("path").attr("class","attr-graph").style("stroke-width",function(b){if(0!=b.total)return Math.round(10*
(b.count/b.total))}).style("fill","none").attr("d",curvedEdgesAttrGraph?q:b).attr("x1",function(b){return b.source.x}).attr("y1",function(b){return b.source.y}).attr("x2",function(b){return b.target.x}).attr("y2",function(b){return b.target.y}).style("stroke",function(){return"#000000"});e.selectAll("g.node").data(p).enter().append("svg:line").attr("x1",function(b){return b.x-Math.max(1,(c/2-100)*(Math.PI/(2*n)))}).attr("y1",function(b){return b.y}).attr("x2",function(b){return b.x+Math.max(1,(c/
2-100)*(Math.PI/(2*n)))}).attr("y2",function(b){return b.y}).attr("transform",function(b){return"rotate("+180*Math.atan(-1*b.x/b.y)/Math.PI+" "+b.x+" "+b.y+")"}).style("stroke",function(){return"#000000"});e.selectAll("g.node").data(p).enter().append("svg:text").attr("dx",function(b){return 0<b.x?"1em":"-1em"}).attr("dy","0.31em").style("pointer-events","none").attr("text-anchor",function(b){return 0<b.x?"start":"end"}).text(function(b){return b.name}).style("stroke",function(){return"#000000"}).attr("transform",
function(b){return"translate("+b.x+","+b.y+")rotate("+180*Math.atan(b.y/b.x)/Math.PI+")"})}$(function(){$("#attr-graph-layout").change(function(){changeAttributeGraphLayout($(this).attr("value"))});$("#attr-graph-curved-edges").change(function(){curvedEdgesAttrGraph=$(this).attr("checked");changeAttributeGraphLayout("radial")});$("#distribution-chart-type").change(function(){changeDistributionChartType($(this).attr("value"))})});
function changeDistributionChartType(b){$("#distribution-chart").html("");"bar"==b?createDistributionChart():"pie"==b&&createDistributionPieChart()}var curvedEdgesAttrGraph=!1;function changeAttributeGraphLayout(b){$("#attr-graph").html("");"fd"==b?loadAttributeGraph(lattice.attr_graph):"radial"==b&&radialAttributeGraph(lattice.attr_graph)}
var radarChart=new function(){var b,c,e,g,p;this.init=function(){};this.updateSeries=function(q){var r=function(b){for(var c=[],b=context.getSubcontextForExtent(b.extent,!0),e=0;e<b.attributes.length;e++){for(var g=0,p=0;p<b.objects.length;p++)b.rel[p][e]&&(g+=1);c.push(g)}return c};b=[];for(var v=0;v<q.length;v++)b.push(r(q[v]));c=context.attributes;mergedArr=[];for(v=0;v<b.length;v++)mergedArr=mergedArr.concat(b[v]);e=d3.min(mergedArr);g=d3.max(mergedArr);g+=0.25*(g-e);for(v=e=0;v<b.length;v+=1)b[v].push(b[v][0]);
$("#polar-chart").html("");q=d3.select("#polar-chart").append("svg:svg").attr("width",500).attr("height",400).attr("class","vizSvg");q.append("svg:rect").attr("id","axis-separator").attr("x",0).attr("y",0).attr("height",0).attr("width",0).attr("height",0);vizBody=q.append("svg:g").attr("id","body");setScales();addAxes();highlightedDotSize=4;q=vizBody.selectAll(".series").data(b);q.enter().append("svg:g").attr("class","series").style("fill",function(b,c){return mapColor(context.attributes[c])}).style("stroke",
function(b,c){return mapColor(context.attributes[c])});q.exit().remove();r=q.append("svg:path").attr("class","line").attr("d",d3.svg.line.radial().radius(function(){return 0}).angle(function(b,c){24===c&&(c=0);return 2*(c/24)*Math.PI})).style("stroke-width",3).style("fill","none");q.selectAll(".curr-point").data(function(b){return[b[0]]}).enter().append("svg:circle").attr("class","curr-point").attr("r",0);q.selectAll(".clicked-point").data(function(b){return[b[0]]}).enter().append("svg:circle").attr("r",
0).attr("class","clicked-point");r.attr("d",d3.svg.line.radial().radius(function(b){return p(b)}).angle(function(b,c){24===c&&(c=0);return 2*(c/24)*Math.PI}))};setScales=function(){var b;b=d3.min([375,500]);p=d3.scale.linear().domain([e,g]).range([0,b/2]);p(g);vizBody.attr("transform","translate(250, 197.5)")};addAxes=function(){var b=p.ticks(5);vizBody.selectAll(".circle-ticks").remove();vizBody.selectAll(".line-ticks").remove();b=vizBody.selectAll(".circle-ticks").data(b).enter().append("svg:g").attr("class",
"circle-ticks");b.append("svg:circle").attr("r",function(b){return p(b)}).attr("class","circle").style("stroke","#CCC").style("fill","none");b.append("svg:text").attr("text-anchor","middle").attr("dy",function(b){return-1*p(b)}).text(String);b=vizBody.selectAll(".line-ticks").data(c).enter().append("svg:g").attr("transform",function(b,e){return"rotate("+(360*(e/c.length)-90)+")translate("+p(g)+")"}).attr("class","line-ticks");b.append("svg:line").attr("x2",-1*p(g)).style("stroke","#CCC").style("fill",
"none");b.append("svg:text").text(String).attr("text-anchor","middle").attr("transform",function(b,e){return 180>360*(e/c.length)?null:"rotate(180)"})}},matrixVis=new function(){this.config={margin:{top:80,right:0,bottom:10,left:80},width:60,height:12};d3.scale.ordinal().rangeBands([0,w]);d3.scale.ordinal().rangeBands([0,h]);d3.scale.linear().domain([0,4]).clamp(!0);d3.scale.category10().domain(d3.range(10));var b,c;this.run=function(){b=context.objects.length;c=context.attributes.length;d3.select("#chart").html("");
vis=d3.select("#chart").append("svg:svg").attr("width",w+matrixVis.config.margin.left+matrixVis.config.margin.right).attr("height",h+matrixVis.config.margin.top+matrixVis.config.margin.bottom).style("margin-left",-matrixVis.config.margin.left+"px").append("g").attr("transform","translate("+matrixVis.config.margin.left+","+matrixVis.config.margin.top+")");var e=[];context.objects.forEach(function(b,g){e[g]=d3.range(c).map(function(b){return{x:b,y:g,z:0}})});for(var g=0;g<context.rel.length;g++)for(var p=
0;p<context.rel[g].length;p++)e[g][p].z=context.rel[g][p]?1:0;lattice.concepts.forEach(function(b){for(var c=0;c<b.intent.length;c++)for(var g=0;g<b.extent.length;g++)context.attributes.indexOf(b.intent[c]),context.objects.indexOf(b.extent[g]),"undefined"==typeof e[c][g].concepts&&(e[c][g].concepts=[]),e[c][g].concepts.push(b)});vis.append("rect").attr("class","background").attr("width",w).attr("height",h);g=vis.selectAll(".row").data(e).enter().append("g").attr("class","row").attr("transform",function(c,
e){return"translate(0,"+e*(h/b)+")"}).each(this.row);g.append("line").attr("x2",w);g.append("text").attr("x",-6).attr("y",h/b/2).attr("dy",".32em").attr("text-anchor","end").text(function(b,c){return context.objects[c]});g=vis.selectAll(".column").data(e[0]).enter().append("g").attr("class","column").attr("transform",function(b,e){return"translate("+w/c*e+")rotate(-90)"});g.append("line").attr("x1",-h);g.append("text").attr("x",6).attr("y",w/c/2).attr("dy",".32em").attr("text-anchor","start").text(function(b,
c){return context.attributes[c]})};this.row=function(e){d3.select(this).selectAll(".cell").data(e).enter().append("g").each(function(e){if("undefined"!=typeof e.concepts)for(var p=0;p<e.concepts.length;p++)d3.select(this).append("rect").attr("class","cell").attr("x",function(b){return w/c*b.x}).attr("width",w/c).attr("height",h/b).style("fill-opacity",function(){return 0.2}).style("fill",function(b){return mapColor(b.concepts[p].id)}).on("mouseover",this.mouseover).on("mouseout",this.mouseout)})};
this.mouseover=function(b){d3.selectAll(".row text").classed("active",function(c,p){return p==b.y});d3.selectAll(".column text").classed("active",function(c,p){return p==b.x})};this.mouseout=function(){d3.selectAll("text").classed("active",!1)}},sankeyVis=new function(){var b,c,e;this.config={nodeWidth:15,nodePadding:10};this.run=function(){vis=d3.select("#chart").append("svg").attr("width",w).attr("height",h).append("g");b=d3.sankey().nodeWidth(this.config.nodeWidth).nodePadding(this.config.nodePadding).size([w,
h]);c=b.link();b.nodes(lattice.concepts).links(lattice.edges).layout(32);e=vis.append("g").selectAll(".sklink").data(lattice.edges).enter().append("path").attr("class","sklink").attr("source_id",function(b){return b.source_id}).attr("target_id",function(b){return b.target_id}).attr("d",c).style("stroke-width",function(b){return 1.5*getEdgeThickness(b)}).sort(function(b,c){return c.dy-b.dy});e.append("title").text(function(b){var c=getEdgeValue(b);return 0>c?b.source.name+" \u2192 "+b.target.name+
"\n":edge_type+": "+100*c+"%"});var g=vis.append("g").selectAll(".sknode").data(lattice.concepts).enter().append("g").attr("class","sknode").attr("transform",function(b){return"translate("+b.x+","+b.y+")"}).on("click",this.nodeClick).on("mouseover",this.nodeMouseOver).on("mouseout",this.nodeMouseOut).call(d3.behavior.drag().origin(function(b){return b}).on("dragstart",function(){this.parentNode.appendChild(this)}).on("drag",this.dragmove));g.append("rect").attr("class","concept").attr("id",function(b){return"node-"+
b.id}).attr("height",function(b){return b.dy}).attr("width",b.nodeWidth()).style("fill",function(b){return b.color=getNodeColor(b)}).append("title").text(function(b){return b.name+"\n"});g.append("text").attr("x",-6).attr("y",function(b){return b.dy/2}).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text(function(b){return b.name}).filter(function(b){return b.x<w/2}).attr("x",6+b.nodeWidth()).attr("text-anchor","start")};this.dragmove=function(g){d3.select(this).attr("transform",
"translate("+g.x+","+(g.y=Math.max(0,Math.min(h-g.dy,d3.event.y)))+")");b.relayout();e.attr("d",c)};this.nodeMouseOver=function(b){nodeMouseOver(b);d3.select(this).classed("hover",!0);highlightPath&&visitEdgesDown(b,function(b){d3.select('path.sklink[source_id="'+b.source.id+'"][target_id="'+b.target.id+'"]').classed("highlighted",!0)})};this.nodeMouseOut=function(b){nodeMouseOut(b);d3.select(this).classed("hover",!1);d3.selectAll("path.sklink.highlighted").classed("highlighted",!1)};this.nodeClick=
function(b){nodeClick(b)}},sunburstVis=new function(){this.config={};var b,c,e,g=d3.svg.arc().startAngle(function(b){return Math.max(0,Math.min(2*Math.PI,q(b.x)))}).endAngle(function(b){return Math.max(0,Math.min(2*Math.PI,q(b.x+b.dx)))}).innerRadius(function(b){return Math.max(0,r(b.y))}).outerRadius(function(b){return Math.max(0,r(b.y+b.dy))}),p,q,r;this.run=function(){d3.select("#chart").html("");p=Math.min(w,h)/2;q=d3.scale.linear().range([0,2*Math.PI]);r=d3.scale.sqrt().range([0,p]);color=mapColor;
vis=d3.select("#chart").append("svg:svg").attr("width",w).attr("height",h).append("svg:g").attr("transform","translate("+w/2+","+h/2+")");b=d3.layout.partition().sort(null).value(function(){return 1});var v=lattice.getTree();vis.data([v]);v=b.nodes(v);c=vis.selectAll("path.sb").data(b.nodes,function(b){return b.id});c.enter().append("svg:path").attr("class","concept sb").attr("id",function(b,c){return"path-"+c}).attr("d",g).style("fill",getNodeColor).on("mouseover",nodeMouseOver).on("mouseout",nodeMouseOut).on("click",
nodeClick).on("dblclick",sunburstVis.sbclick);c.exit().remove();e=vis.selectAll("text").data(v);e.enter().append("svg:text").style("opacity",1).style("fill","#000").attr("text-anchor",function(b){return q(b.x+b.dx/2)>Math.PI?"end":"start"}).attr("dy",".2em").attr("transform",function(b){var c=1<(get_upper_label(b)||"").split(",").length,e=180*q(b.x+b.dx/2)/Math.PI-90;return"rotate("+(e+(c?-0.5:0))+")translate("+(r(b.y)+5)+","+q(b.x)+")rotate("+(90<e?-180:0)+")"}).on("click",nodeClick).on("dblclick",
sunburstVis.sbclick).append("svg:tspan").attr("x",0).text(function(b){return 360*b.dx>MIN_ANGLE_FOR_LABELS?get_upper_label(b):""})};this.sbclick=function(b){c.transition().duration(750).attrTween("d",sunburstVis.arcTween(b));e.style("visibility",function(c){return isParentOf(b,c)?null:d3.select(this).style("visibility")}).transition().duration(750).attrTween("text-anchor",function(b){return function(){return q(b.x+b.dx/2)>Math.PI?"end":"start"}}).attrTween("transform",function(b){var c=1<(b.name||
"").split(" ").length;return function(){var e=180*q(b.x+b.dx/2)/Math.PI-90;return"rotate("+(e+(c?-0.5:0))+")translate("+(r(b.y)+5)+")rotate("+(90<e?-180:0)+")"}}).style("opacity",function(c){return isParentOf(b,c)?1:1E-6}).each("end",function(c){d3.select(this).style("visibility",isParentOf(b,c)?null:"hidden")})};this.arcTween=function(b){var c=d3.interpolate(q.domain(),[b.x,b.x+b.dx]),e=d3.interpolate(r.domain(),[b.y,1]),B=d3.interpolate(r.range(),[b.y?20:0,p]);return function(b,p){return p?function(){return g(b)}:
function(p){q.domain(c(p));r.domain(e(p)).range(B(p));return g(b)}}}};
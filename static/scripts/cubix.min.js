/**
 * LICENCE
 * THIS CODE IS UNDER CREATIVE COMMONS Attribution-NonCommercial 3.0 
 * Read the full disclaimer here: http://creativecommons.org/licenses/by-nc/3.0/
 */
var SEPARATOR="-",DEFAULT_WIDTH=570,DEFAULT_HEIGHT=500,MIN_ANGLE_FOR_LABELS=6,MAX_ENTITY_SIZE=15,DEFAULT_NODE_RADIUS=8,NODE_MAX_SIZE=16,NODE_MIN_SIZE=6,DEFAULT_EDGE_THICKNESS=4,EDGE_MAX_THICK=21,EDGE_MIN_THICK=1,SIZE_STABILITY=2,SIZE_SUPPORT=2,SIZE_DEFAULT=1,LABEL_REPETITIVE="repetitive",LABEL_MULTILABEL="multi-label",SELECTED_FILL_COLOR="#FF0000",DEFAULT_FILL_COLOR="#aaaaff",DEFAULT_OPACITY=0.3;
function getAssociationRules(){$.ajax({url:"/api/v1/",context:document.body}).done(function(){$(this).addClass("done")})}var association_rules,full_association_rules,color_set=d3.scale.category20(),premiseColor="#3B14AF",conclusionColor="#FFD500";
function get_attribute_list(){var b=[],e=[];s=0;for(a in a_rules_concerned_attributes){s++;for(i=0;i<a_rules_concerned_attributes[a].length;i++){t={};t.family=s;if("yes"==a_rules_concerned_attributes[a][i][0])t.text=a.toString(),b.push(t);else if("no"==a_rules_concerned_attributes[a][i][0])continue;else t.text=a.toString()+"-"+a_rules_concerned_attributes[a][i][0],b.push(t);e.push(t.text)}}11>s&&(color_set=d3.scale.category10());return[b,e]}
function fetchAssociationRules(b){if("undefined"==typeof lattice.id||null==lattice.id)flashAlert("The current concept lattice is not saved in the server - could not compute association rules.","error");else if("undefined"!=typeof association_rules)b();else{flashAlert("Calculating assotiation rules, this may take some minutes...");var e=$("input[name=csrfmiddlewaretoken]").val();$.getJSON("/api/v1/association_rules/",{lattice_id:lattice.id,csrfmiddlewaretoken:e},function(e){association_rules=e;for(t=
0;t<association_rules.length;t++)association_rules[t].id="id"+t,association_rules[t].highlighted=!0;hideLoading();if("undefined"!=typeof b){for(i=0;i<filter.history.length;i++){filter.history[i].removedRules=[];arrjs=[];for(j=0;j<association_rules.length;j++){flag=!0;for(k=0;k<association_rules[j].premise.length;k++)association_rules[j].premise[k]==filter.history[i].attr+"-"+filter.history[i].value&&(flag=!1);for(k=0;k<association_rules[j].conclusion.length;k++)association_rules[j].conclusion[k]==
filter.history[i].attr+"-"+filter.history[i].value&&(flag=!1);flag&&(filter.history[i].removedRules.push(association_rules[j]),arrjs.push(j))}for(t=0;t<arrjs.length;t++)association_rules.splice(arrjs[t]-t,1)}full_association_rules||(full_association_rules=association_rules);b();createScatterPlotChart();createRulesList()}})}}
function select_rule(b){if(-1!==prevIndex){updated_prev=!1;for(t=0;!updated_prev;t++)rules_list_chart.series[0].data[t].category==prevIndex&&(rules_list_chart.series[0].data[t].update({color:"#4572A7"},!0,!1),updated_prev=!0)}updated_selection=!1;for(t=0;!updated_selection;t++)rules_list_chart.series[0].data[t].category==b&&(rules_list_chart.series[0].data[t].update({color:"#f00"},!0,!1),updated_selection=!0);"radiagram"==currentVis?d3.select("#chart").select("svg").selectAll("path").style("opacity",
function(e){flag=!1;for(i=0;i<e[0].ids.length;i++)if(e[0].ids[i]==b){flag=!0;break}return flag?0.99:0.1}):"matrixview"==currentVis?d3.select("#chart").select("svg").selectAll(".matrix-row").style("opacity",function(e){return e[0].id==b?0.99:0.05}):"gg_ar_plot"==currentVis&&(d3.select("#chart").select("svg").selectAll("line").style("opacity",function(e){return e[3]==b?0.99:0.1}),d3.select("#chart").select("svg").selectAll("polygon").style("opacity",function(e){return e[3]==b?0.99:0.1}),d3.select("#chart").select("svg").selectAll("circle").style("opacity",
function(e){flag=!1;console.log(e);if(e.ids){for(i=0;i<e.ids.length;i++)if(e.ids[i]==b){flag=!0;break}return flag?0.99:0.1}return 1}));prevIndex=b}
function unselect_all(){if(-1!==prevIndex){for(t=0;t<rules_list_chart.series[0].data.length;t++)if(rules_list_chart.series[0].data[t].category==prevIndex){rules_list_chart.series[0].data[t].update({color:"#4572A7"},!0,!1);break}"radiagram"==currentVis?d3.select("#chart").select("svg").selectAll("path").style("opacity",0.99):"matrixview"==currentVis?d3.select("#chart").select("svg").selectAll(".matrix-row").style("opacity",1):"gg_ar_plot"==currentVis&&(d3.select("#chart").select("svg").selectAll("line").style("opacity",
0.99),d3.select("#chart").select("svg").selectAll("polygon").style("opacity",0.99),d3.select("#chart").select("svg").selectAll("circle").style("opacity",1));prevIndex=-1}}
function addGradient(b,e,c,g){b=b.append("linearGradient").attr("id",function(){return"gradient"+e}).attr("spreadMethod","pad").attr("x1",function(){return c?"0%":"100%"}).attr("y1",function(){return g?"0%":"100%"}).attr("x2",function(){return c?"100%":"0%"}).attr("y2",function(){return g?"100%":"0%"});b.append("svg:stop").attr("offset","0%").attr("stop-color",d3.rgb(premiseColor)).attr("stop-opacity",1);b.append("svg:stop").attr("offset","100%").attr("stop-color",d3.rgb(conclusionColor)).attr("stop-opacity",
1)}function objectJoin(b,e){res="";for(i=0;i<b.length;i++)res+=b[i].text+e;return res.substring(0,res.length-1)}
function initARView(){function b(b){d3.select(this).selectAll(".cell").data(b.filter(function(b){return b.z})).enter().append("rect").attr("class","cell").attr("x",function(b){return b.y*(w-e[1]-1)/g}).attr("width",(w-1-e[1])/g).attr("height",Math.max((h-e[0])/association_rules.length,10)).style("fill-opacity",function(b){return b.confidence}).style("fill",function(b){return 1==b.z?d3.rgb(premiseColor):d3.rgb(conclusionColor)}).on("mouseover",Matrix_View_MouseOver).on("mouseout",Matrix_View_MouseOut).on("click",
function(b){console.log(b.id);select_rule(b.id)})}"undefined"==typeof association_rules&&flashAlert("The association rules couldn't be fetched from the server","error");for(var e=[0,0,0,0],c=[],g=0,n=get_attribute_list(),q=n[1],n=n[0],g=n.length,r=0;r<association_rules.length;r++)c[r]=[],c[r]=d3.range(g).map(function(b){return{x:r,y:b,z:0}});association_rules.sort(function(b,e){for(var c=0;c<q.length;c++){var g=b.premise.indexOf(q[c]),n=e.premise.indexOf(q[c]);if(!(0<=g&&0<=n||0>g&&0>n)){if(0<=g&&
0>n)return-1;if(0>g&&0<=n)return 1}}for(c=0;c<q.length;c++)if(g=b.conclusion.indexOf(q[c]),n=e.conclusion.indexOf(q[c]),!(0<=g&&0<=n||0>g&&0>n))if(0<=g&&0>n)break;else if(0>g&&0<=n)return 1;return-1});for(r=0;r<association_rules.length;r++)for(var v=0;v<g;v++){for(var z=0;z<association_rules[r].premise.length;z++)n[v].text==association_rules[r].premise[z]&&(c[r][v].z=1,c[r][v].confidence=association_rules[r].confidence,c[r][v].premise_supp=association_rules[r].premise_supp,c[r][v].conclusion_supp=
association_rules[r].conclusion_supp,c[r][v].premise=association_rules[r].premise,c[r][v].conclusion=association_rules[r].conclusion,c[r][0].id=association_rules[r].id,c[r][v].id=association_rules[r].id);for(z=0;z<association_rules[r].conclusion.length;z++)n[v].text==association_rules[r].conclusion[z]&&(c[r][v].z=2,c[r][v].confidence=association_rules[r].confidence,c[r][v].premise_supp=association_rules[r].premise_supp,c[r][v].conclusion_supp=association_rules[r].conclusion_supp,c[r][v].premise=association_rules[r].premise,
c[r][v].conclusion=association_rules[r].conclusion,c[r][0].id=association_rules[r].id,c[r][v].id=association_rules[r].id)}for(r=0;r<g;r++)e[0]=Math.max(e[0],n[r].text.length);e[0]*=7;e[1]=20+10*Math.log(association_rules.length)/Math.LN10;v=h<10*association_rules.length+e[0]+e[2]?10*association_rules.length+e[0]+e[2]:h;vis=d3.select("#chart").append("svg:svg").attr("width",w).attr("height",v).append("svg:g").attr("transform","translate("+e[1]+","+e[0]+")");b=vis.selectAll(".matrix-row").data(c).enter().append("g").attr("class",
"matrix-row").attr("id",function(b){return b[0].id}).attr("transform",function(b){return"translate(0,"+b[0].x*Math.max(10,(h-e[0])/association_rules.length)+")"}).each(b);b.append("line").attr("x2",w).attr("y1",Math.max(10,(h-e[0])/association_rules.length)).attr("y2",Math.max(10,(h-e[0])/association_rules.length)).attr("class","matrix_view_separator").style("fill-opacity",0.99);b.append("line").attr("x2",w).attr("class","matrix_view_separator").style("fill-opacity",0.99);b.append("text").attr("x",
0).attr("dy","1em").attr("text-anchor","end").attr("class","label").text(function(b){return b[0].id});c=vis.selectAll(".column").data(n).enter().append("g").attr("class","column").attr("transform",function(b,c){return b[c]?"translate("+c*(w-e[1]-1)/g+")rotate(-90)":"translate(0)rotate(-90)"});c.append("line").attr("x1",10*-association_rules.length).attr("transform",function(b,c){return"translate(0,"+c*(w-e[1]-1)/g+")"}).attr("class","matrix_view_separator");c.append("text").attr("class","label").attr("x",
0).attr("dy","1em").attr("text-anchor","start").attr("transform",function(b,c){return"translate(12,"+c*(w-e[1]-1)/g+")rotate(+45)"}).style("stroke",function(b,c){return color_set(n[c].family-1)}).text(function(b,c){return n[c].text})}
function Matrix_View_MouseOver(b){d3.selectAll(".matrix-row text").classed("highlighted",function(e,c){return c==b.x});d3.selectAll(".column text").classed("highlighted",function(e,c){return c==b.y});d3.select(this).style("stroke","red");A_rules_box.style("opacity",0);A_rules_box.style("display","block");A_rules_box.transition().delay(800).duration(300).style("opacity",1);A_rules_box.style("left",d3.event.pageX+0+"px").style("top",d3.event.pageY-40+"px").style("width","270px").style("height",11+1.7*
Math.max(b.premise.length,b.conclusion.length)+"em");1==b.z?wrapperElementsInList($("ul.hb_role"),["Antecedent"]):wrapperElementsInList($("ul.hb_role"),["Consequent"]);wrapperElementsInList($("ul.hb_confidence"),[Math.round(100*b.confidence).toString()+"%"]);wrapperElementsInList($("ul.hb_p_support"),b.premise_supp);wrapperElementsInList($("ul.hb_c_support"),b.conclusion_supp);wrapperElementsInList($("ul.hb_premise_list"),b.premise);wrapperElementsInList($("ul.hb_consequence_list"),b.conclusion)}
function Matrix_View_MouseOut(){d3.selectAll("text").classed("highlighted",!1);mouseOverHoverBox||(d3.select(this).style("stroke","none"),A_rules_box.transition().delay(800).duration(200).style("opacity",0),A_rules_box.style("display","none"))}var rx=w/2,ry=h/2,rotate=0;
function initDiagonalARView(){if("undefined"==typeof association_rules)flashAlert("The association rules couldn't be fetched from the server","error");else{flashAlert('Select a rule by clicking on a bar in the "Generated Rules" chart ',"info",5E3);attr_list=get_attribute_list()[0];var b=0,e=0;for(a in context.attributeNames)b++;var b=b+attr_list.length,e=b-attr_list.length,c=[0,120,20,120];for(i=0;i<attr_list.length;i++)c[0]=Math.max(c[0],attr_list[i].text.length);c[0]*=0;vis=d3.select("#chart").append("svg:svg").attr("width",
w).attr("height",h).attr("viewBox","0 0 "+w+" "+h).attr("preserveAspectRatio","xMidYMid").append("svg:g").attr("transform","translate("+w/2+","+h/2+")");var c=[],g=0,n=0,q={children:[],x:0,y:0};s_parent={children:[],name:"<Nothing family>"};s_parent.parent=q;s_parent.x=w/4-50;s_parent.y=0;f={};f.family=n;f.parent=s_parent;f.x=w/2-100;f.y=0;f.name="Nothing";s_parent.children.push(f);c.push(f);g++;g++;e++;b++;for(a in context.attributeNames){var r={children:[]};r.name=a.toString();r.parent=q;r.x=(w/
4-50)*Math.cos(2*n*Math.PI/e);r.y=(w/4-50)*Math.sin(2*n*Math.PI/e);n++;for(i=0;i<context.attributeNames[a].length;i++){var v={};"yes"==context.attributeNames[a][i][0]?(v.family=n,v.parent=r,v.x=(w/2-100)*Math.cos(2*g*Math.PI/b),v.y=(w/2-100)*Math.sin(2*g*Math.PI/b),v.name=a.toString(),r.children.push(v),c.push(v),g++):"no"!=context.attributeNames[a][i][0]&&(v.family=n,v.parent=r,v.x=(w/2-100)*Math.cos(2*g*Math.PI/b),v.y=(w/2-100)*Math.sin(2*g*Math.PI/b),v.name=a.toString()+"-"+context.attributeNames[a][i][0],
g++,c.push(v),r.children.push(v))}q.children.push(r);g++}e=[];for(u=0;u<c.length;u++)for(t=0;t<c.length;t++)if(u!==t){ids=[];confidencies=[];for(l=0;l<association_rules.length;l++)if(0==association_rules[l].premise.length&&0==t)ids.push(association_rules[l].id),confidencies.push(association_rules[l].confidence);else{in_conclusion=in_premise=link_in_rule=!1;for(counter=0;counter<association_rules[l].premise.length;counter++)if(association_rules[l].premise[counter]==c[t].name){in_premise=!0;break}for(counter=
0;counter<association_rules[l].conclusion.length;counter++)if(association_rules[l].conclusion[counter]==c[u].name){in_conclusion=!0;break}if(link_in_rule=in_premise&&in_conclusion)ids.push(association_rules[l].id),confidencies.push(association_rules[l].confidence)}0<ids.length&&(source={},source.parent=c[t].parent,source.ids=ids,source.conf=confidencies,source.x=c[t].x,source.y=c[t].y,target={},target.parent=c[u].parent,target.x=c[u].x,target.y=c[u].y,g={},g.source=source,g.target=target,e.push(g))}d3.layout.cluster().size([2*
Math.PI,500]);m_splines=d3.layout.bundle()(e);e=d3.select("#chart").select("svg").append("defs");addGradient(e,"lt-rb",!0,!0);addGradient(e,"lb-rt",!0,!1);addGradient(e,"rt-lb",!1,!0);addGradient(e,"rb-lt",!1,!1);vis.selectAll("path").data(m_splines).enter().append("path").style("stroke-width",function(b){return 2*d3.max(b[0].conf)+1}).style("fill","none").attr("ids",function(b){return b[0].ids}).attr("confs",function(b){return b[0].conf}).attr("d",function(b){pathinfo=[];for(a=0;a<b.length;a++)point=
{},point.x=b[a].x,point.y=b[a].y,pathinfo.push(point);return d3.svg.line().x(function(b){return b.x}).y(function(b){return b.y}).interpolate("bundle").tension(0.1)(pathinfo)}).style("stroke",function(b){left_to_right=b[0].x>b[b.length-1].x?!1:!0;top_to_bottom=b[0].y>b[b.length-1].y?!1:!0;return left_to_right&&top_to_bottom?"url(#gradientlt-rb)":!left_to_right&&top_to_bottom?"url(#gradientrt-lb)":left_to_right&&!top_to_bottom?"url(#gradientlb-rt)":"url(#gradientrb-lt)"});circle=vis.selectAll("g.node").data(c).enter().append("svg:line").attr("x1",
function(c){return c.x-Math.max(1,(w/2-100)*(Math.PI/(2*b)))}).attr("y1",function(b){return b.y}).attr("x2",function(c){return c.x+Math.max(1,(w/2-100)*(Math.PI/(2*b)))}).attr("y2",function(b){return b.y}).attr("transform",function(b){return"rotate("+180*Math.atan(-1*b.x/b.y)/Math.PI+" "+b.x+" "+b.y+")"}).style("stroke",function(b){return color_set(b.family-1)});text=vis.selectAll("g.node").data(c).enter().append("svg:text").attr("dx",function(b){return 0<b.x?"1em":"-1em"}).attr("dy","0.31em").style("pointer-events",
"none").attr("text-anchor",function(b){return 0<b.x?"start":"end"}).text(function(b){return b.name}).style("stroke",function(b){return color_set(b.family-1)}).attr("transform",function(b){return"translate("+b.x+","+b.y+")rotate("+180*Math.atan(b.y/b.x)/Math.PI+")"})}}function cross(b,e){return b[0]*e[1]-b[1]*e[0]}function dot(b,e){return b[0]*e[0]+b[1]*e[1]}function isParentOf(b,e){return b===e?!0:b.children?b.children.some(function(b){return isParentOf(b,e)}):!1}
function init_scatter_plot(b){function e(b){var c=e.extent();association_rules=[];z.selectAll("circle").attr("class",function(e){if(c[0][0]<=e[b.x]&&e[b.x]<=c[1][0]&&c[0][1]<=e[b.y]&&e[b.y]<=c[1][1]){topush=!0;for(i=0;i<association_rules.length;i++)compare_a_rules(association_rules[i],e)&&(topush=!1);topush&&association_rules.push(e);return 1}return"spl"})}b=b||"#chart";get_attribute_list();var c=full_association_rules,g=["confidence","conclusion_supp","premise_supp","lift"],n={},q={};c.forEach(function(b){b.lift=
b.confidence/b.conclusion_supp});var r={traits:g};r.values=c;r.traits.forEach(function(b){var c=function(c){return c[b]},c=[d3.min(r.values,c),d3.max(r.values,c)],e=[8.75,81.25];n[b]=d3.scale.linear().domain(c).range(e);q[b]=d3.scale.linear().domain(c).range(e.slice().reverse())});var v=d3.svg.axis().ticks(5).tickSize(90*g.length),e=d3.svg.brush().on("brushstart",function(b){e.data!==b&&(A.call(e.clear()),e.x(n[b.x]).y(q[b.y]).data=b)}).on("brush",e).on("brushend",function(){e.empty()&&z.selectAll("circle").attr("class",
function(){association_rules=full_association_rules;return 1});document.getElementById("chart").innerHTML="";redrawCurVis();createRulesList()}),z=d3.select(b).append("svg").attr("width",90*g.length+17.5).attr("align","center").attr("height",90*g.length+17.5);z.append("svg:rect").attr("x",0).attr("y",0).attr("height","100%").attr("width","100%").attr("fill","#FFFFFF");z.selectAll("g.x.axis").data(r.traits).enter().append("g").attr("class","x axis").attr("transform",function(b,c){return"translate("+
90*c+",0)"}).each(function(b){d3.select(this).call(v.scale(n[b]).orient("bottom"))});z.selectAll("g.y.axis").data(r.traits).enter().append("g").attr("class","y axis").attr("transform",function(b,c){return"translate(0,"+90*c+")"}).each(function(b){d3.select(this).call(v.scale(q[b]).orient("right"))});var A=z.selectAll("g.cell").data(function(b,c){var e=[],g=b.length,n=c.length,q,r;for(q=-1;++q<g;)for(r=-1;++r<n;)e.push({x:b[q],i:q,y:c[r],j:r});return e}(r.traits,r.traits)).enter().append("g").attr("class",
"cell").attr("transform",function(b){return"translate("+90*b.i+","+90*b.j+")"}).each(function(b){var c=d3.select(this);c.append("rect").attr("class","frame").attr("x",8.75).attr("y",8.75).attr("width",72.5).attr("height",72.5);c.selectAll("circle").data(r.values).enter().append("circle").attr("class",function(){return 1}).attr("cx",function(c){return n[b.x](c[b.x])}).attr("cy",function(c){return q[b.y](c[b.y])}).attr("r",function(){return 3}).on("mouseover",Matrix_View_MouseOver).on("mouseout",Matrix_View_MouseOut);
c.call(e.x(n[b.x]).y(q[b.y]))});A.filter(function(b){return b.i==b.j}).append("text").attr("x",17.5).attr("y",17.5).attr("dy",".71em").text(function(b){return b.x})}
function init_gg_plot(){for(var b=0,e=get_attribute_list()[0],c=clone(association_rules),b=c.length,g=0;g<c.length;g++){for(j=0;j<c[g].premise.length;j++)for(k=0;k<e.length;k++)c[g].premise[j]==e[k].text&&(res={},res.family=e[k].family,res.text=e[k].text,c[g].premise[j]=res);for(j=0;j<c[g].conclusion.length;j++)for(k=0;k<e.length;k++)c[g].conclusion[j]==e[k].text&&(res={},res.family=e[k].family,res.text=e[k].text,c[g].conclusion[j]=res)}e=[];common_parent={children:[]};for(var g=0;g<b;g++){t_link=
[-1,-1];p_parent={occurencies:1};p_parent.parent=common_parent;p_parent.ids=[];p_parent.ids.push(c[g].id);p_parent.text=objectJoin(c[g].premise,"&");p_parent.children=c[g].premise;p_parent.children=p_parent.children.map(function(b){res={};res=b;res.occurencies=1;res.parent=p_parent;res.ids=p_parent.ids;return res});c_parent={occurencies:1};c_parent.parent=common_parent;c_parent.ids=[];c_parent.ids.push(c[g].id);c_parent.text=objectJoin(c[g].conclusion,"&");c_parent.children=c[g].conclusion;c_parent.children=
c_parent.children.map(function(b){res={};res=b;res.occurencies=1;res.parent=p_parent;res.ids=c_parent.ids;return res});for(j=0;j<common_parent.children.length;j++)objectJoin(c[g].premise,"&")==common_parent.children[j].text&&(t_link[0]=j,common_parent.children[j].occurencies++,common_parent.children[j].ids.push(c[g].id),p_parent.occurencies++,common_parent.children[j].children=common_parent.children[j].children.map(function(b){b.occurencies=common_parent.children[j].occurencies/common_parent.children[j].children.length;
b.ids=common_parent.children[j].ids;return b})),objectJoin(c[g].conclusion,"&")==common_parent.children[j].text&&(t_link[1]=j,common_parent.children[j].occurencies++,common_parent.children[j].ids.push(c[g].id),c_parent.occurencies++,common_parent.children[j].children=common_parent.children[j].children.map(function(b){b.occurencies=common_parent.children[j].occurencies/common_parent.children[j].children.length;b.ids=common_parent.children[j].ids;return b}));1==p_parent.occurencies&&(t_link[0]=common_parent.children.length,
common_parent.children.push(p_parent));1==c_parent.occurencies&&(t_link[1]=common_parent.children.length,common_parent.children.push(c_parent));t_link[2]=c[g].confidence;t_link[3]=c[g].id;e.push(t_link)}var n=d3.scale.linear().range([0,w]),q=d3.scale.linear().range([0,h]),r=d3.select("#chart").append("svg").attr("width",w).attr("height",h),b=d3.layout.pack().size([w,h]).value(function(b){return 100*b.occurencies}),v=common_parent.children,b=b.nodes(common_parent),z,A;A=z=common_parent;r.selectAll("circle").data(b).enter().append("svg:circle").attr("class",
function(b){return b.children?"parent":"child"}).attr("ids",function(b){return b.ids}).style("fill",function(b){if(b.family)return color_set(b.family-1)}).attr("cx",function(b){return b.x}).attr("cy",function(b){return b.y}).attr("r",function(b){return b.r}).on("click",function(b){var b=z==b?A:b,c=common_parent.r/b.r;w>h?(n.domain([b.x-Math.abs(h-w)/(2*c)-b.r,b.x+Math.abs(h-w)/(2*c)+b.r]),q.domain([b.y-b.r,b.y+b.r])):(n.domain([b.x-b.r,b.x+b.r]),q.domain([b.y-Math.abs(h-w)/(2*c)-b.r,b.y+Math.abs(h-
w)/(2*c)+b.r]));var e=r.transition().duration(d3.event.altKey?7500:750);e.selectAll("circle").attr("cx",function(b){return n(b.x)}).attr("cy",function(b){return q(b.y)}).attr("r",function(b){return c*b.r});e.selectAll("line").attr("x1",function(b){return n(v[b[0]].x)}).attr("y1",function(b){return q(v[b[0]].y)}).attr("x2",function(b){return n(v[b[1]].x)}).attr("y2",function(b){return q(v[b[1]].y)});e.selectAll("polygon").attr("transform",function(b){return"translate("+n(0.5*(v[b[0]].x+v[b[1]].x))+
","+q(0.5*(v[b[0]].y+v[b[1]].y))+"), rotate("+180*(1/Math.PI)*Math.atan((v[b[1]].y-v[b[0]].y)/(v[b[1]].x-v[b[0]].x))+")"});e.selectAll("text").attr("x",function(b){return n(b.x)}).attr("y",function(b){return q(b.y)}).style("opacity",function(b){return 30<c*b.r?1:0});z=b});e=unique_set(e);r.selectAll("line").data(e).enter().append("svg:line").style("stroke-width",function(b){return 2*b[2]+1}).attr("id",function(b){return b[3]}).attr("x1",function(b){return v[b[0]].x}).attr("y1",function(b){return v[b[0]].y}).attr("x2",
function(b){return v[b[1]].x}).attr("y2",function(b){return v[b[1]].y}).style("stroke",d3.interpolateRgb(premiseColor,conclusionColor)(0.5));r.selectAll("polygon").data(e).enter().append("svg:polygon").attr("id",function(b){return b[3]}).attr("points",function(b){return-5*(b[2]+1)+","+3*(b[2]+1)+" "+-5*(b[2]+1)+","+-3*(b[2]+1)+" "+3*(b[2]+1)+",0"}).style("fill",d3.interpolateRgb(premiseColor,conclusionColor)(0.5)).attr("transform",function(b){return"translate("+0.5*(v[b[0]].x+v[b[1]].x)+","+0.5*(v[b[0]].y+
v[b[1]].y)+"), rotate("+180*(1/Math.PI)*Math.atan((v[b[1]].y-v[b[0]].y)/(v[b[1]].x-v[b[0]].x))+")"});r.selectAll("text").data(b).enter().append("svg:text").style("pointer-events","none").attr("x",function(b){return b.x}).attr("y",function(b){return b.y}).attr("dy",".35em").attr("text-anchor","middle").style("opacity",function(b){return 30<b.r?1:0}).text(function(b){return 2==b.depth?b.text:""})}
function flashAlert(b,e,c){e&&"error"==e?($("div.alert-error > span").text(b),$("div.alert-error").show()):e&&"info"==e?($("div.alert-info > span").text(b),$("div.alert-info").show()):($("div.alert-block > span").text(b),$("div.alert-block").show());c&&setTimeout(function(){$("div.alert").fadeOut()},c)}function showLoading(){$("div.alert").hide();$("div.alert-block > span").text("Loading...");$("div.alert-block").show()}function hideLoading(){$("div.alert").hide()}
$(function(){$(".dismiss-alert").click(function(){$("div.alert").fadeOut("fast")});$(".dropdown-toggle").dropdown()});
function Context(b,e,c,g){this.initialAttributeNames=HashClone(g);this.initialObjects=b.slice(0);this.attributeNames=g;this.attributes=e;this.objects=b;this.rel=c;this.getEntitiesCount=function(){return this.objects.length};this.whatValueForThisAttribute=function(b,c){for(var e=0;e<rel[b].length;e++){var g=rel[b][e];if(g.split(SEPARATOR)[0]==c)return g.substring(g.indexOf(SEPARATOR)+1,g.length)}return null};this.getAttrValues=function(b){for(var c=[],b=attributes[b],e=0;e<b.length;e+=2)c.push(b[e]);
return c};this.intersection=function(b,c){var e=this.getObjectsHavingOrNot(b),g=this.getObjectsHavingOrNot(c);return ArrayIntersect(e,g)};this.booleanPositive=function(b,c){if(b==c||b+"-yes"==c)return!0;var e=c.split("-");return 0<e.length&&e[0]!=b&&"no"==e[1]?!0:!1};this.getObjectsHavingOrNot=function(b){var c=[],e=b.split("-"),g=e.length-1,z=0<=g&&"no"==e[g];if(0<e.length&&("no"==e[g]||"yes"==e[g]))for(var b="",A=0;A<g;A++)b+=e[A];b=this.attributes.indexOf(b);for(e=0;e<this.objects.length;e++)g=
this.objects[e],z?this.rel[e][b]||c.push(g):this.rel[e][b]&&c.push(g);return c};this.getObjectIndex=function(b){for(var c=0;c<this.objects.length;c++)if(this.objects[c]==b)return c;return-1};this.getSubcontextForExtent=function(b){for(var c=[],e=[],g=[],z=0;z<b.length;z++){c.push(b[z]);g[z]=[];for(var A=this.getObjectIndex(b[z]),B=0;B<this.rel[A].length;B++)if(this.rel[A][B]){var C=e.indexOf(this.attributes[B]);0>C&&e.push(this.attributes[B]);C=e.indexOf(this.attributes[B]);g[z][C]=!0}}return new Context(c,
e,g,e)}}
function eliminateEntities(){for(var b=[],e=[],c=[],g=0;g<context.objects.length;){for(var n=!1,q=0;q<lattice.concepts.length&&!n;q++)n=0<=lattice.concepts[q].extent.indexOf(context.objects[g]);n?g++:(e.push(context.objects[g]),context.objects.splice(g,1))}for(var r=getAttributeValuesPairs(),g=0;g<r.length;g++){n=!1;for(q=0;q<lattice.concepts.length&&!n;q++)n=0<=lattice.concepts[q].intent.indexOf(r[g].name);if(!n){var n=r[g].attrName,q=r[g].valueName,v={};v.name=r[g].name;v.booleanAttr=r[g].booleanAttr;v.attrName=
n;v.value=q?context.attributeNames[n][getValueIdxfromAttr(n,q)]:context.attributeNames[n];c.push(v);r[g].booleanAttr?delete context.attributeNames[n]:n in context.attributeNames&&(1==context.attributeNames[n].length?delete context.attributeNames[n]:removeValuefromAttr(n,q))}}b.push(e);b.push(c);updateEntityList();return b}function removeValuefromAttr(b,e){var c=getValueIdxfromAttr(b,e);0<=c&&context.attributeNames[b].splice(c,1)}
function getValueIdxfromAttr(b,e){for(var c=context.attributeNames[b],g=0;g<c.length;g++)if(c[g][0]==e)return g;return-1}function addEntities(b,e){ArrayAddAll(b,context.objects);for(var c=0;c<e.length;c++)e[c].attrName in context.attributeNames?0>context.attributeNames[e[c].attrName].indexOf(e[c].value)&&context.attributeNames[e[c].attrName].push(e[c].value):context.attributeNames[e[c].attrName]=e[c].booleanAttr?e[c].value:[e[c].value];updateEntityList()}Highcharts.theme={colors:["#4572A7"]};
var highchartsOptions=Highcharts.getOptions(),prevIndex=-1;function removeWatermarks(){$('text[text-anchor="end"]').remove()}function initDashboard(){createDistributionChart()}function loadDashboard(){multiSelectOptionsForAttributes("#control_1");multiSelectOptionsForAttributes("#control_2");$("#control_1, #control_2").multiSelect();updateDistributionChart(lattice.topConcept)}
function multiSelectOptionsForAttributes(b){var e=$(b);e.empty();e.append($("<option></option>"));$.each(context.attributeNames,function(b,g){var n=$("<optgroup label='"+b+"'></optgroup>");e.append(n);for(var q=0;q<g.length;q++)$("<option label='"+g[q][0]+"' value='"+b+SEPARATOR+g[q][0]+"'>"+g[q][0]+"</option>").appendTo(n)})}var chart;
function createHorizontalBarChart(b,e,c){chart=new Highcharts.Chart({chart:{renderTo:b,defaultSeriesType:"bar"},title:{text:"Attribute Co-occurrence"},subtitle:{text:""},xAxis:{categories:e,title:{text:null}},yAxis:{min:0,title:{text:"Objects",align:"high"}},tooltip:{formatter:function(){return""+this.series.name+": "+this.y+" objects"}},plotOptions:{bar:{dataLabels:{enabled:!0}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",floating:!0,borderWidth:1,backgroundColor:Highcharts.theme.legendBackgroundColor||
"#FFFFFF",shadow:!0},credits:{enabled:!1},series:getStackedBarSeries(e,c)})}function getStackedBarSeries(b,e){for(var c=[],g=0;g<e.length;g++){var n={};n.name=e[g];n.data=[];for(var q=0;q<b.length;q++){var r=context.intersection(b[q],e[g]);n.data.push(r.length)}c.push(n)}return c}var distributionChart;
function createVerticalBarChart(b,e,c,g){distributionChart=new Highcharts.Chart({chart:{renderTo:b,type:"column",margin:[50,50,100,80]},title:{text:e},xAxis:{categories:c,labels:{rotation:-45,align:"right",style:{font:"normal 13px Verdana, sans-serif"}}},yAxis:{min:0,title:{text:"Objects"}},legend:{enabled:!1},tooltip:{formatter:function(){return"<b>"+this.x+" : "+this.y+" objects</b><br/>"}},series:[{name:"Attributes",data:g,dataLabels:{enabled:!0,rotation:-90,color:"#FFFFFF",align:"right",x:-3,
y:10,formatter:function(){return this.y},style:{font:"normal 13px Verdana, sans-serif"}}}]})}function createDistributionChart(){createVerticalBarChart("distribution-chart","Distribution",[],[])}
function updateDistributionChart(b){if("undefined"!=typeof b){for(var e=[],b=context.getSubcontextForExtent(b.extent),c=0;c<b.attributes.length;c++){for(var g=0,n=0;n<b.objects.length;n++)!0==b.rel[n][c]&&g++;e.push(g)}distributionChart.series[0].setData(e);distributionChart.xAxis[0].setCategories(b.attributeNames)}}var polarChart;
function createPolarChart(){polarChart=new Highcharts.Chart({chart:{renderTo:"polar-chart",polar:!0,type:"line"},title:{text:"Budget vs spending",x:-80},pane:{size:"80%"},xAxis:{categories:["Support","Stability","Probability","Separation"],tickmarkPlacement:"on",lineWidth:0},yAxis:{gridLineInterpolation:"polygon",lineWidth:0,min:0},tooltip:{shared:!0,valuePrefix:"$"},legend:{align:"right",verticalAlign:"top",y:100,layout:"vertical"},series:[{name:"Allocated Budget",data:[43E3,19E3,6E4,35E3],pointPlacement:"on"},
{name:"Actual Spending",data:[5E4,39E3,42E3,31E3],pointPlacement:"on"}]})}function createScatterPlotChart(){distributionChart=new Highcharts.Chart({chart:{renderTo:"sc_pl_div",type:"area",margin:[50,50,100,80]},title:{text:"Association Rules Distribution"}});distributionChart.container.innerHTML="";init_scatter_plot(distributionChart.container)}
function createRulesList(){if("undefined"!=typeof association_rules){a1=[];a2=[];for(i=0;i<association_rules.length;i++)a1.push(association_rules[i].id),a2.push(association_rules[i].confidence);chart=new Highcharts.Chart({chart:{height:50+20*association_rules.length,renderTo:"rules_render_area",type:"bar",events:{click:function(){if(-1!==prevIndex){for(t=0;t<this.series[0].data.length;t++)if(this.series[0].data[t].category==prevIndex){this.series[0].data[t].update({color:"#4572A7"},!0,!1);break}d3.select("#chart").select("svg").selectAll("path").style("opacity",
0.99);prevIndex=-1}}}},title:{text:"Generated rules"},legend:{enabled:null},xAxis:{categories:a1,title:{text:null}},yAxis:{min:0,title:{text:null,align:"high"},labels:{overflow:"justify"}},tooltip:{formatter:function(){return""+this.series.name+": "+this.y}},plotOptions:{bar:{dataLabels:{enabled:!0},events:{click:function(b){if(-1!==prevIndex)for(t=0;t<this.data.length;t++)if(this.data[t].category==prevIndex){this.data[t].update({color:"#4572A7"},!0,!1);break}b.point.update({color:"#f00"},!0,!1);
vis.selectAll("path").style("opacity",function(e){return 0<=e[0].ids.indexOf(b.point.category)?0.99:0.1});prevIndex=b.point.category}}}},series:[{name:"Confidence",data:a2}]})}}function updateDashboard(){}function disableDrawingOptionsForAR(b){$("#select-color").prop("disabled",b);$("#select-edge").prop("disabled",b);$("#select-size").prop("disabled",b);$("#select-label").prop("disabled",b)}var edge_type="default";
function getEdgeThickness(b){if("default"==edge_type)return DEFAULT_EDGE_THICKNESS;b=metrics.getLinkScore(b.source.id,b.target.id,edge_type);return Math.round(b*(EDGE_MAX_THICK-EDGE_MIN_THICK))+EDGE_MIN_THICK}function changeEdgeThickness(b){edge_type=b;0<=noLinks.indexOf(b)||updateVis()}var color_type="default";function changeNodeSize(b){size_type=b;updateVis()}
function getNodeSize(b){if("default"==size_type)return DEFAULT_NODE_RADIUS;b=metrics.getScore(b.id,size_type);return Math.round(b*(NODE_MAX_SIZE-NODE_MIN_SIZE))+NODE_MIN_SIZE}function changeNodeColor(b){color_type=b;vis.selectAll(".concept").style("fill",function(b){return getNodeColor(b)})}function getNodeColor(b){return"ids"==color_type?mapColor(b.id):DEFAULT_FILL_COLOR}
function mapColor(b){for(var e=0,c=0;c<b.length;c++)e=b.charCodeAt(c)+((e<<20)-e);b="#3182bd #6baed6 #9ecae1 #c6dbef #e6550d #fd8d3c #fdae6b #fdd0a2 #31a354 #74c476 #a1d99b #c7e9c0 #756bb1 #9e9ac8 #bcbddc #dadaeb #636363 #969696 #bdbdbd #d9d9d9".split(" ");e=Math.abs(e)%b.length;return b[e]}var displayAttrLabel,displayObjLabel=!0;function get_upper_label(b){return!displayAttrLabel?"":labeling_type==LABEL_REPETITIVE?b.intent:b.upperLabel}
function get_lower_label(b){if(!displayObjLabel)return"";if(labeling_type==LABEL_REPETITIVE)return b.extent;if(labeling_type==LABEL_MULTILABEL)return b.lowerLabel;b=metrics.getScore(b.id,labeling_type);return"esupport"==labeling_type?Math.round(100*b)+"% ("+Math.round(context.objects.length*b)+")":Math.round(100*b)+"%"}function changeLabel(b){labeling_type=b;(labeling_type==LABEL_REPETITIVE||labeling_type==LABEL_MULTILABEL)&&labelizeData();updateVis()}
function labelize(){alert("active");for(var b=vis.select('circle[id="'+lattice.topConcept.id+'"]'),b=getOutgoingNodes(b),e=0;e<b.length;e++){for(var c=b[e],g=c.attr("intent").split(","),n=getIncomingNodes(c),q=0;q<n.length&&0<g.length;q++)var r=n[q].attr("intent").split(","),g=ArraySubtract(g,r);vis.select('text[id="intent_'+c.attr("id")+'"]').text(g.join(", "));ArrayAddAll(getOutgoingNodes(c),b)}b=vis.select('circle[id="'+lattice.bottomConcept.id+'"]');b=getIncomingNodes(b);for(e=0;e<b.length;e++){c=
b[e];g=c.attr("extent").split(",");n=getOutgoingNodes(c);for(q=0;q<n.length&&0<g.length;q++)r=n[q].attr("extent").split(","),g=ArraySubtract(g,r);vis.select('text[id="extent_'+c.attr("id")+'"]').text(g.join(", "));ArrayAddAll(getIncomingNodes(c),b)}}
function labelizeFirst(){for(var b=getTopMostConcepts(),e=0;e<b.length;e++){for(var c=b[e],g=getParentsData(c),n=c.intent,q=0;q<g.length&&0<n.length;q++)n=ArraySubtract(n,g[q].intent);q=n.join(", ");c.name=q;c.upperLabel=q;g=getChildrenData(c);ArrayAddAll(g,b)}b=getBottomMostConcepts();for(e=0;e<b.length;e++){c=b[e];g=getChildrenData(c);n=c.extent;for(q=0;q<g.length&&0<n.length;q++)n=ArraySubtract(n,g[q].extent);q=n.join(", ");c.lowerLabel=q;ArrayAddAll(getParentsData(c),b)}}
function labelizeData(){for(var b=getTopMostConcepts(),e=0;e<b.length;e++){for(var c=b[e],g="undefined"!=typeof lattice.original_id?getTreeParentsData(c):getParentsData(c),n=c.intent,q=0;q<g.length&&0<n.length;q++)n=ArraySubtract(n,g[q].intent);q=n.join(", ");c.name=q;c.upperLabel=q;g="undefined"!=typeof lattice.original_id?getTreeChildrenData(c):getChildrenData(c);ArrayAddAll(g,b)}b=getBottomMostConcepts();for(e=0;e<b.length;e++){c=b[e];g=getChildrenData(c);n=c.extent;for(q=0;q<g.length&&0<n.length;q++)n=
ArraySubtract(n,g[q].extent);q=n.join(", ");c.lowerLabel=q;ArrayAddAll(getParentsData(c),b)}}function createFacets(){var b=vis.select('circle[id="'+data.top_id+'"]');if(0==b.attr("intent").length)var e=getOutgoingNodes(b);$("#treepa").dynatree({title:"Sample Theming",onActivate:function(b){openFacet(b)}});for(var b=$("#treepa").dynatree("getRoot"),c=0;c<e.length;c++)b.addChild({title:e[c].attr("intent")})}
function searchFacet(b,e){removeWhiteSpaces(b);var c=[],g=[],n=[],q=b.split(",");vis.selectAll("circle").each(function(){var b=d3.select(this),c=b.attr("intent").split(",");e&&0==b.attr("extent").length?n.push(b):ArrayContainsAll(c,q)?g.push(b):n.push(b)});c.push(g);c.push(n);return c}
function openFacet(b){var e="";b.visitParents(function(b){null!=b.data.title&&(e+=b.data.title+",")},!0);for(var c=searchFacet(e,!0)[0],g=0;g<c.length;g++){var n=c[g].attr("intent").split(","),q=e.split(","),n=ArraySubtract(n,q);0<n.length&&b.addChild({title:n.join(", ")})}b.expand(!0)}
var visualFilters=[],filter=new function(){this.history=[];this.addFilter=function(b,e,c,g){var n=eliminateEntities();updateVisualFilters();var q={};q.filterType=b;q.attr=e;q.value=c;q.excludedNodes=g;q.remObjs=n[0];if(void 0!==association_rules){association_rules=full_association_rules;q.removedRules=[];arrjs=[];for(j=0;j<association_rules.length;j++){flag=!0;for(k=0;k<association_rules[j].premise.length;k++)association_rules[j].premise[k]==q.attr+"-"+q.value&&(flag=!1);for(k=0;k<association_rules[j].conclusion.length;k++)association_rules[j].conclusion[k]==
q.attr+"-"+q.value&&(flag=!1);flag&&(q.removedRules.push(association_rules[j]),arrjs.push(j))}for(t=0;t<arrjs.length;t++)association_rules.splice(arrjs[t]-t,1);full_association_rules=association_rules;createScatterPlotChart()}q.remAttrsVals=n[1];this.history.push(q)};this.removeFilter=function(b,e){var c=this.indexOfFilter(b,e);removeFilterAt(c)};this.removeFilterAt=function(b){if(this.history[b].removedRules){if(b!==this.history.length-1)for(j=0;j<this.history[b].removedRules.length;j++){console.log("going through rule",
j);attributed=!1;for(i=b+1;i<this.history.length&&!attributed;i++){console.log("going through filter",i);console.log(this.history[b].removedRules[j].premise,this.history[b].removedRules[j].conclusion);for(k=0;k<this.history[b].removedRules[j].premise.length;k++)if(this.history[b].removedRules[j].premise[k]==this.history[i].attr+"-"+this.history[i].value){association_rules.push(this.history[b].removedRules[j]);attributed=!0;break}if(!attributed)for(k=0;k<this.history[b].removedRules[j].conclusion.length;k++)if(this.history[b].removedRules[j].conclusion[k]==
this.history[i].attr+"-"+this.history[i].value){association_rules.push(this.history[b].removedRules[j]);attributed=!0;break}attributed||this.history[i].removedRules.push(this.history[b].removedRules[j])}}else association_rules=association_rules.concat(this.history[b].removedRules);full_association_rules=association_rules;createScatterPlotChart()}addEntities(this.history[b].remObjs,this.history[b].remAttrsVals);updateVisualFilters();ArrayRemove(this.history,b)};this.indexOfAttr=function(b){for(var e=
0;e<this.history.length;e++)if(this.history[e].attr==b)return e;return-1};this.indexOfFilter=function(b,e){for(var c=0;c<this.history.length;c++)if(this.history[c].attr==b&&this.history[c].value==e)return c;return-1};this.indexOfFilter=function(b){for(var e=0;e<this.history.length;e++)if(this.history[e].attr==b)return e;return-1};this.getFilter=function(b,e){var c=this.indexOfFilter(b,e);return 0>c?null:this.history[c]};this.clear=function(){this.history.length=0}};
function removeFilter(b,e){var c;c=e?filter.indexOfFilter(b,e):filter.indexOfFilter(b);var g=filter.history[c].excludedNodes;filter.removeFilterAt(c);for(c=0;c<filter.history.length&&0<g.length;c++)g=ArraySubtract(g,filter.history[c].excludedNodes);for(c=0;c<g.length;c++)0>lattice.concepts.indexOf(g[c])&&lattice.concepts.push(g[c]);keepLinks();e?$("#"+b+"-"+e).remove():$("#"+b).remove();labelize2();updateVis()}
function resetFilters(){$("#showFiltersPanel").html("<span>Filters &raquo;</span>");if(association_rules)for(b=0;b<filter.history.length;b++)association_rules=association_rules.concat(filter.history[b].removedRules);full_association_rules=association_rules;filter.clear();for(var b=0;b<visualFilters.length;b++)visualFilters[b].series[0].redraw();lattice.concepts=lattice.initialConcepts.slice(0);lattice.edges=lattice.initialEdges.slice(0);context.attributeNames=HashClone(context.initialAttributeNames);
context.objects=context.initialObjects.slice(0);updateEntityList();updateVisualFilters();updateVis();createScatterPlotChart()}function keepLinks(){lattice.edges=lattice.initialEdges.filter(function(b){return 0<=lattice.concepts.indexOf(b.source)&&0<=lattice.concepts.indexOf(b.target)})}
function clickFilterValue(){var b=this.name,e=this.series.name;if(this.sliced){for(var c=[],g=0;g<lattice.initialConcepts.length;g++){var n=lattice.initialConcepts[g];if(0==n.extent.length)c.push(n);else{var q=e;"yes"!=b&&"no"!=b&&(q+=SEPARATOR+b);0>n.intent.indexOf(q)?"no"!=b&&c.push(n):"no"==b&&c.push(n)}}lattice.concepts=ArraySubtract(lattice.concepts,c);keepLinks();filter.addFilter("attribute",e,b,c);$("#"+e+"-"+b).remove();$('<span id="'+e+"-"+b+'"> | '+e+": "+b+' <a href="#" class="remove-filter"><img src="'+
STATIC_URL+'/images/remove.gif"></a></span>').appendTo("#showFiltersPanel");labelizeData();updateVis()}else removeFilter(e,b)}function loadFilters(){for(var b=getKeys(context.attributeNames),e=0;e<b.length;e++){var c=[{animation:!0,type:"pie",name:b[e],data:context.attributeNames[b[e]]}];$('<div class="chartFilter"><span> '+b[e]+' </span><div id="chart_'+e+'" />').appendTo("#filters_container");visualFilters.push(createChart(b[e],"chart_"+e,c))}}
function createChart(b,e,c){return new Highcharts.Chart({chart:{renderTo:e,backgroundColor:"rgba(50,50,50,0)",plotBorderWidth:null,plotShadow:!1},title:{text:""},tooltip:{formatter:function(){return"<b>"+this.point.name.escapeHTML()+"</b>: "+Math.round(this.percentage)+" %"}},legend:{itemWidth:80,style:{width:"100px"},layout:"vertical",backgroundColor:"#666",align:"right",verticalAlign:"middle",itemStyle:{color:"#fff"}},plotOptions:{pie:{allowPointSelect:!0,innerSize:"40%",point:{events:{select:clickFilterValue,
unselect:clickFilterValue}},cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0}},series:c})}function updateVisualFilters(){for(var b=0;b<visualFilters.length;b++){var e=visualFilters[b].series[0];e.name in context.attributeNames?(document.getElementById("chart_"+b).style.opacity=1,e.setData(context.attributeNames[e.name],!0)):document.getElementById("chart_"+b).style.opacity=0}}var selFilterCt=0;
function filterSelected(){var b=[];vis.selectAll("circle.selected").each(function(c){b.push(c)});var e=ArraySubtract(lattice.concepts,b);lattice.concepts=b;keepLinks();var c="selection_"+selFilterCt;filter.addFilter("selection",c,"filter",e);$('<span id="'+c+'"> | selection <a href="#" class="remove-filter"><img src="'+STATIC_URL+'/images/remove.gif"></a></span>').appendTo("#showFiltersPanel");selFilterCt++;labelizeData();updateVis()}var attrFilterCt=0;
function filterAttributes(){var b=[];$("input[name='attr']:checked").each(function(){b.push($(this).val())});for(var e=[],c=0;c<lattice.concepts.length;c++)0==lattice.concepts[c].extent.length?e.push(lattice.concepts[c]):ArrayContainsAll(lattice.concepts[c].intent,b)||e.push(lattice.concepts[c]);lattice.concepts=ArraySubtract(lattice.concepts,e);keepLinks();c="attribute_"+attrFilterCt;filter.addFilter("attribute_sel",c,"filter",e);$('<span id="'+c+'" rel="tooltip" data-trigger="hover" data-placement="top" data-title="'+
b.join(", ")+'"> | attributes sel. <a href="#" class="remove-filter"><img src="'+STATIC_URL+'/images/remove.gif"></a></span>').appendTo("#showFiltersPanel");attrFilterCt++;labelize2();updateVis()}var objFilterCt=0;
function filterObjects(){var b=[];$("input[name='obj']:checked").each(function(){b.push($(this).val())});for(var e=[],c=0;c<lattice.concepts.length;c++)0==lattice.concepts[c].intent.length?e.push(lattice.concepts[c]):ArrayContainsAll(lattice.concepts[c].extent,b)||e.push(lattice.concepts[c]);lattice.concepts=ArraySubtract(lattice.concepts,e);keepLinks();c="object_"+objFilterCt;filter.addFilter("object_sel",c,"filter",e);$('<span id="'+c+'" rel="tooltip" data-trigger="hover" data-placement="top" data-title="'+
b.join(", ")+'"> | objects sel. <a href="#" class="remove-filter"><img src="'+STATIC_URL+'/images/remove.gif"></a></span>').appendTo("#showFiltersPanel");objFilterCt++;labelize2();updateVis()}function loadAttributeLattices(b){var e=0,c;for(c in context.attributeNames){var g="minilattice_"+e++;$('<div class="chartFilter"><span> '+c+' </span><div id="'+g+'" />').appendTo("#graph_container");createMiniLattice(b[c].nodes,b[c].links,g)}}
var numberSelected=0,context,lattice,a_rules_concerned_attributes,_data_a_rules_concerned_attributes;
function loadData(b){context=new Context(b.context.objects,b.context.attributes,b.context.rel,b.attributes);lattice=new Lattice(b);a_rules_concerned_attributes=clone(b.attributes);_data_a_rules_concerned_attributes=clone(b.attributes);if("undefined"!=typeof n_concepts){var e=1-lattice.edges.length/n_links;$("#tree-opts").popover({title:"Tree stats",placement:"bottom",html:!0,trigger:"hover",content:"Concepts (source): "+n_concepts+" <br/> Links (source): "+n_links+" <br/><br/> Concepts (tree): "+
lattice.concepts.length+" <br/> Links (tree): "+lattice.edges.length+"<br/><br/> Reduction: "+Math.round(100*e)/100+"%"})}$("input.search").tokenInput(getAttributeValuesPairs(),{propertyToSearch:"name",preventDuplicates:!1,hintText:"Type an attribute name",theme:"facebook",onAdd:selectionAdded,onDelete:selectionAdded});$("#slider-clustering").slider({min:1,max:lattice.concepts.length,value:[lattice.concepts.length],slide:function(b,e){$("#n_clusters").val(e.value)}});$("#n_clusters").val(lattice.concepts.length);
"undefined"!=typeof lattice.original_id&&($("#tree-opts").show(),$("a.undo-link").show());hoverbox=d3.select("#hoverbox");A_rules_box=d3.select("#A_rules_box");labelizeFirst();checkLatticeConstraints();displayAttrLabel=$("input[name='label-for-attr']").is(":checked");displayObjLabel=$("input[name='label-for-attr']").is(":checked");labelizeData();updateEntityList();loadFilters();loadDashboard();$('text[text-anchor="end"]').remove();b.attribute_lattices&&loadAttributeLattices(JSON.parse(b.attribute_lattices));
b.attribute_graph&&loadAttributeGraph(JSON.parse(b.attribute_graph))}
function Lattice(b){this.initialConcepts=b.nodes.slice(0);this.initialEdges=b.links.slice(0);this.concepts=b.nodes;this.edges=b.links;this.id=b.id;this.original_id=b.original_id;this.getConcept=function(b){for(var c=0;c<this.concepts.length;c++)if(this.concepts[c].id==b)return this.concepts[c]};this.getConceptById=function(b){for(var c=0;c<this.concepts.length;c++)if(this.concepts[c].id==b)return this.concepts[c]};this.getEdge=function(b,c){for(var g=0;g<this.edges.length;g++)if(this.edges[g].source.id==
b.id&&this.edges[g].target.id==c.id||this.edges[g].target.id==b.id&&this.edges[g].source.id==c.id)return this.edges[g]};this.topConcept=this.getConcept(b.top_id);this.bottomConcept=this.getConcept(b.bottom_id);this.isEmpty=function(){return!1};this.conceptsCount=function(){return concepts.length};this.resetLattice=function(){concepts=initialConcepts.slice(0);edges=initialEdges.slice(0)};this.getPredecessors=function(b){for(var c=[],g=0;g<b.children_ids.length;g++)c.push(this.concepts[b.children_ids[g]]);
return c};this.getSucessors=function(b){for(var c=[],g=0;g<b.parents_ids.length;g++)c.push(this.concepts[b.parents_ids[g]]);return c};this.getSuccessorsEdges=function(b){for(var c=[],g=0;g<this.edges.length;g++)this.edges[g].source.id==b.id&&c.push(this.edges[g]);return c};this.getPredecessorsEdges=function(b){for(var c=[],g=0;g<this.edges.length;g++)this.edges[g].target.id==b.id&&c.push(this.edges[g]);return c};this.removeConcept=function(b){for(var c=0;c<lattice.concepts.length;c++)if(lattice.concepts[c].id==
b.id){lattice.concepts.splice(c,1);for(c=0;c<lattice.edges.length;c++){var g=lattice.edges[c];if(g.target.id==b.id||g.source.id==b.id)lattice.edges.splice(c,1),c-=1}break}};this.existsEdge=function(b,c){for(var g=0;g<lattice.edges.length;g++)if(lattice.edges[g].source.id==b&&lattice.edges[g].target.id==c)return!0;return!1};this.readdConcept=function(b){if("undefined"==typeof lattice.getConceptById(b.id)){lattice.concepts.push(b);for(var c=0;c<lattice.initialEdges.length;c++){var g=lattice.initialEdges[c];
g.target.id==b.id&&!lattice.existsEdge(g.source.id,g.target.id)?lattice.edges.push(g):g.source.id==b.id&&!lattice.existsEdge(g.source.id,g.target.id)&&lattice.edges.push(g)}}};this.treeCache=[];this.getTree=function(){function b(c){var e={};e.id=c.id;e.name=c.intent.join(", ");e.lowerLabel=c.lowerLabel;e.upperLabel=c.upperLabel;e.support=c.support;e.intent=c.intent;e.extent=c.extent;e.depth=0;e.children=[];0>lattice.treeCache.indexOf(e)&&lattice.treeCache.push(e);return e}function c(g){if(0==g.children_ids.length)return null;
for(var q=b(g),g=getChildrenData(g),r=0;r<g.length;r++){var v=0<g[r].children_ids.length?c(g[r]):b(g[r]);v.depth=q.depth+1;q.children.push(v)}return q}var g=getTopMostConcepts()[0];return c(g)};this.getHeight=function(){return this.bottomConcept.depth+1};this.getEdgeLength=function(b){return lattice.getHeight()-b.target.depth-(lattice.getHeight()-b.source.depth)};this.doTopSort=function(b){for(var c=[this.conceptsCount()],g=c.length;0<=--g;)c[g]=this.getPredecessors(this.nodes[g]).length;for(var n=
this.topConcept,q=this.concepts.indexOf(n);n!=this.bottomConcept;){succ=this.getSuccessorsEdges(n);b[this.concepts.indexOf(n)]=n.depth;for(g=0;g<succ.length;g++)tmp2=this.concepts(succ[g].target),0==--c[this.concepts.indexOf(tmp2)]&&(c[q]=this.concepts.indexOf(tmp2),q=this.concepts.indexOf(tmp2));n=this.concepts[c[this.concepts.indexOf(n)]]}b[this.concepts.indexOf(this.bottomConcept)]=this.bottomConcept.depth}}
function filterNodes(){link.filter(function(b){for(b=b.source;b;b=b.parent)if(b===p)return!0}).remove();node.filter(function(b){for(;b=b.parent;)if(b===p)return!0}).remove()}function showNodes(){vis.selectAll(".opaque").classed("opaque",!1)}
function hideNodes(b){for(var e=0;e<b.length;e++){var c=b[e];c.classed("selected",!1);c.classed("opaque",!0);getIncomingEdges(c,function(){var b=d3.select(this);b.classed("selected",!1);b.classed("opaque",!0)});getOutgoingEdges(c,function(){var b=d3.select(this);b.classed("opaque",!1);b.classed("selected",!0)})}}
function highlightNodes(b){for(var e=0;e<b.length;e++){var c=b[e];c.classed("selected",!0);c.classed("opaque",!1);getIncomingEdges(c,function(){var b=d3.select(this);b.classed("opaque",!1);b.classed("selected",!0)});getOutgoingEdges(c,function(){var b=d3.select(this);b.classed("opaque",!1);b.classed("selected",!0)})}}function clearSearch(){$("#search").val("");showNodes()}function clearSelection(){clearSearch();vis.selectAll(".selected").classed("selected",!1);$("#selection_list").empty()}
function checkLatticeConstraints(){if("undefined"!=typeof lattice.original_id)changeVis("sunburst");else{if(OVERWHELMING&&(context.attributes.length>MAX_ENTITY_SIZE||context.objects.length>MAX_ENTITY_SIZE)){if(confirm("Labeling concepts in this lattice may be overwhelming, do you want to switch to a suitable tree visualisation?")){$("#modal-tree-transform").modal({keyboard:!0,show:!0});return}setOverwhelmingOff()}$("#select-vis").val(PREF_VIS);changeVis(PREF_VIS)}}
function getTopMostConcepts(b){b||(b=lattice.concepts);for(var e=[],c=Number.MAX_VALUE,g=0;g<b.length;g++){var n=b[g];if(0==n.depth){e.push(n);break}n.depth<c?(e.length=0,e.push(n),c=n.depth):n.depth==c&&e.push(n)}return e}function getBottomMostConcepts(){for(var b=[],e=Number.MIN_VALUE,c=0;c<lattice.concepts.length;c++){var g=lattice.concepts[c];g.depth>e?(b.length=0,b.push(g),e=g.depth):g.depth==e&&b.push(g)}return b}function visitEdges(){for(var b=0;b<get.length;b++)get[b]}
function visitEdgesUp(b,e){for(var c=getIncomingEdgesData(b),g=0;g<c.length;g++)e(c[g]),visitEdgesUp(c[g].source,e)}function visitEdgesDown(b,e){for(var c=getOutgoingEdgesData(b),g=0;g<c.length;g++)e(c[g]),visitEdgesDown(c[g].target,e)}function getIncomingEdgesData(b,e){for(var c=[],g=0;g<lattice.edges.length;g++){var n=lattice.edges[g];n.target.id==b.id&&(c.push(n),"undefined"!=typeof e&&e(n))}return c}
function getOutgoingEdgesData(b,e){for(var c=[],g=0;g<lattice.edges.length;g++){var n=lattice.edges[g];n.source.id==b.id&&(c.push(n),"undefined"!=typeof e&&e(n))}return c}function getIncomingEdges(b,e){alert("avoid it. cubix.lattice.js line 668");var c=[],c=vis.selectAll('line[target_id="'+b.attr("id")+'"]');"undefined"!=typeof e&&c.each(e);return c}
function getOutgoingEdges(b,e){alert("avoid it. cubix.lattice.js line 678");var c=[],c=vis.selectAll('line[source_id="'+b.attr("id")+'"]');"undefined"!=typeof e&&c.each(e);return c}function getIncomingNodes(b){var e=[];vis.selectAll('line[target_id="'+b.attr("id")+'"]').each(function(){var b=vis.select('circle[id="'+d3.select(this).attr("source_id")+'"]');0>e.indexOf(b)&&e.push(b)});return e}
function getOutgoingNodes(b){var e=[];vis.selectAll('line[source_id="'+b.attr("id")+'"]').each(function(){var b=vis.select('circle[id="'+d3.select(this).attr("target_id")+'"]');0>e.indexOf(b)&&e.push(b)});return e}function getTreeParentsData(b){for(var e=0;e<lattice.treeCache.length;e++){var c=lattice.treeCache[e].children;if(null!=c)for(var g=0;g<c.length;g++)if(c[g].id==b.id)return[lattice.treeCache[e]]}return[]}
function getParentsData(b){for(var e=[],c=0;c<lattice.concepts.length;c++)0<=b.parents_ids.indexOf(lattice.concepts[c].id)&&e.push(lattice.concepts[c]);return e}function getTreeChildrenData(b){for(var e=0;e<lattice.treeCache.length;e++)if(lattice.treeCache[e].id==b.id)return lattice.treeCache[e].children;return[]}function getChildrenData(b){for(var e=[],c=0;c<lattice.concepts.length;c++)0<=b.children_ids.indexOf(lattice.concepts[c].id)&&e.push(lattice.concepts[c]);return e}
function areNeighbor(b,e){return(0<=b.parents_ids.indexOf(e.id)||0<=b.children_ids.indexOf(e.id))&&0<=lattice.concepts.indexOf(b)&&0<=lattice.concepts.indexOf(e)?!0:!1}function hasChild(b,e){return 0<=b.children_ids.indexOf(e.id)&&0<=lattice.concepts.indexOf(b)&&0<=lattice.concepts.indexOf(e)?!0:!1}
var isParentOf=function(b,e){return b===e?!0:b.children?b.children.some(function(b){return isParentOf(b,e)}):!1},followScroll=!0,latticeVisOpts=[{name:"Hasse diagram",val:"dagre",tooltip:"A layered graph diagram"},{name:"Force Directed graph",val:"lattice",tooltip:"A Hasse diagram with dynamic arrangement"},{name:"Sankey",val:"sankey",tooltip:"Snakey"},{name:"Tree",val:"tree",tooltip:"A concept in a tree has only one parent and no edges crossings"},{name:"Treemap",val:"treemap",tooltip:"A treemap subdivides area into rectangles each of them is sized according to some metric"},
{name:"Sunburst",val:"sunburst",tooltip:"A radial tree-like layout where the root node is at the center, with leaves on the circumference"},{name:"iCicle",val:"icicle",tooltip:"Similar to sunburst but not radial"}],ARVisOpts=[{name:"Matrix",val:"matrixview",tooltip:"Association rules interdependence"},{name:"Radial diagram",val:"radiagram",tooltip:"Association rules interdependence"}],sizeOpts=[{name:"Default",val:"default",tooltip:"Default option"}],colorOpts=[{name:"Default",val:"default",tooltip:"Default option"},
{name:"IDs",val:"ids",tooltip:"Assign colors according to node id, making easier to identify the same concept across the visualisations"}],LabelOpts=[{name:"Multi-label",val:"multi-label",tooltip:"Labels are not repeated down in the hierarchy"},{name:"Repetitive",val:"repetitive",tooltip:"Labels are repeated for each node"}],edgeOpts=[{name:"Default",val:"default",tooltip:"Default edge"}],selectedConcepts=[];$(document).mouseup(function(b){$(b.target).closest(".toolbarPanel").length||$(".toolbarPanel").hide()});
$(function(){var b=$("#chart");$(window).scroll(function(){followScroll&&("matrixview"==currentVis?b.css({position:"absolute",top:"128px"}):102<=document.documentElement.scrollTop||102<=window.pageYOffset?$.browser.msie&&"6.0"==$.browser.version?b.css("top",document.documentElement.scrollTop+55+"px"):b.css({position:"fixed",top:"55px"}):(102>document.documentElement.scrollTop||102>window.pageYOffset)&&b.css({position:"absolute",top:"128px"}))});$("body").tooltip({selector:"[rel=tooltip]",delay:{show:300,
hide:100}});$("#hideVisPanel").click(function(){$(".toolbarPanel").hide()});$(".visButton").click(function(){$(".toolbarPanel").hide();$("#visPanel").show()});$(".highlightButton").click(function(){$(".toolbarPanel").hide();$("#highlightPanel").show()});$(".metricButton").click(function(){$(".toolbarPanel").hide();$("#metricPanel").show()});$("input:radio[name='toggle']").change(function(){"rules"==$(this).val()?($("#dashboard_lattice").hide(),$("#dashboard_ar").show(),d3.select("#chart").html(""),
fetchAssociationRules(initARView),currentVis="matrixview",buildOptionsForSelect(ARVisOpts,"select-vis","matrixview"),disableDrawingOptionsForAR(!0)):($("#dashboard_ar").hide(),$("#toolbar").show(),$("#dashboard_lattice").show(),changeVis("dagre"),buildOptionsForSelect(latticeVisOpts,"select-vis","matrix"),disableDrawingOptionsForAR(!1))});buildOptionsForSelect(latticeVisOpts,"select-vis","dagre");buildOptionsForSelect(edgeOpts,"select-edge","default");buildOptionsForSelect(sizeOpts,"select-size",
"default");buildOptionsForSelect(colorOpts,"select-color","default");buildOptionsForSelect(LabelOpts,"select-label","multi-label");metrics.addLinkListener(addLinkMetricComponentsCallback);metrics.addListener(addMetricComponentsCallback);metrics.addListener(appendMetricFilterCallback);$("input[name='label-for-attr']").change(function(){displayAttrLabel=$(this).is(":checked");updateVis()});$("input[name='label-for-obj']").change(function(){displayObjLabel=$(this).is(":checked");updateVis()});$("#select-label").change(function(){changeLabel($(this).attr("value"))});
$("#select-edge").change(function(){changeEdgeThickness($(this).attr("value"))});$("#select-size").change(function(){changeNodeSize($(this).attr("value"))});$("#select-color").change(function(){changeNodeColor($(this).attr("value"))});$("#select-vis").change(function(){changeVis($(this).attr("value"))});$("input[name='highlight_path']").change(function(){highlightPath=$(this).is(":checked")});$(".distribution-view").click(function(){$(".graph-view").removeClass("active");$(".distribution-view").addClass("active");
$("#filters_container").show();$("#graph_container").hide()});$(".graph-view").click(function(){$(".graph-view").addClass("active");$(".distribution-view").removeClass("active");$("#graph_container").show();$("#filters_container").hide()});$(".filter-search").click(function(){filterSelected();$("input.search").tokenInput("clear")});$("a.remove-filter").live("click",function(b){var c=this.parentNode.id.split("-");1<c.length?removeFilter(c[0],c[1]):removeFilter(c[0]);b.stopPropagation();return!1});
$("#selAllAttr").click(function(){var b=this.checked;$("input[name='attr']").each(function(){this.checked=b})});$("#selAllObj").click(function(){var b=this.checked;$("input[name='obj']").each(function(){this.checked=b})});$(".filter-objs").click(function(){filterObjects()});$(".filter-attrs").click(function(){filterAttributes()});$("#zoom_level").click(function(){resetZoom()});$("#slider-layout").slider({value:2,min:1,max:2,step:1,slide:function(b,c){var g="";1==c.value?g="Viewer":2==c.value?g="Dashboard":
3==c.value&&(g="Dashboard");$("#layout_type").val(g);inflateDiv(c.value)}});$("#layout_type").val("Dashboard");$("#hoverbox").hover(function(){mouseOverHoverBox=!0},function(){mouseOverHoverBox=!1;setTimeout(function(){mouseOverHoverBox||hoverbox.transition().duration(200).style("opacity",0).style("display","none")},1800)});$("#hidePanel").click(function(){$("#showEntitiesPanel").show("normal").animate({width:"40px",opacity:1},200);$("#panel").animate({marginLeft:"-175px"},500);$("#colleft").animate({width:"0px",
opacity:0},400);$("#showPanel").show("normal").animate({width:"40px",opacity:1},200)});$("#showPanel").click(function(){$("#showEntitiesPanel").hide();$("#panel").animate({marginLeft:"0px"},400);$("#colleft").animate({width:"175px",opacity:1},400);$("#showPanel").animate({width:"0px",opacity:0},600).hide("slow")});$("#hideEntPanel").click(function(){$("#showPanel").show("normal").animate({width:"40px",opacity:1},200);$("#entityPanel").animate({marginLeft:"-175px"},500);$("#entityContainer").animate({width:"0px",
opacity:0},400);$("#showEntitiesPanel").show("normal").animate({width:"40px",opacity:1},200)});$("#showEntitiesPanel").click(function(){$("#showPanel").hide();$("#entityPanel").animate({marginLeft:"0px"},400);$("#entityContainer").animate({width:"175px",opacity:1},400);$("#showEntitiesPanel").animate({width:"0px",opacity:0},600).hide("slow")});$(".tabs").bind("change",function(b){b.target;b.relatedTarget});$("#hideFiltersPanel").click(function(){$("#thepanel").animate({marginLeft:"-210px"},500);$("#filtersPanel").animate({height:"1px",
opacity:0},400);$("#showFiltersPanel").show("normal").animate({height:"20px",opacity:1},200)});$("#showFiltersPanel").live("click",function(){$("#thepanel").animate({marginLeft:"0px"},400);$("#filtersPanel").animate({height:"210px",opacity:1},400);$("#showFiltersPanel").animate({height:"0px",opacity:0},600).hide("slow")});$("a.clear-sel").click(function(){clearSelection()});$("a.reset-filters").click(function(){resetFilters()});$(".draw-chart-1a").click(function(){createHorizontalBarChart("box1a-chart",
$("#control_1").selectedPairsArray(),$("#control_2").selectedPairsArray())});initDashboard();$("a.cancel-upload").live("click",function(){$("#cxt-file").popover("hide")});$("#cxt-file").click(function(){$("#cxt-file").popover("show")});$("#cxt-file").popover({placement:"bottom",html:"true",trigger:"manual",title:function(){return"Open cxt file"},content:function(){return $("#open-file").html()}});$("a.compare").click(function(){plotCompare()})});
function inflateDiv(b){1==b?($("#columns").animate({width:"1px",opacity:0},400),$("#columns").hide(),$("#chart").animate({width:"1040px"},400),followScroll=!1,h=w=1040,redrawCurVis()):(followScroll=!0,w=DEFAULT_WIDTH,h=$("#chart").height(),redrawCurVis(),$("#chart").animate({width:"570px"},400),$("#columns").show(),$("#columns").animate({width:"570px",opacity:1},400))}
function getAttributeValuesPairs(){var b=[],e;for(e in context.attributeNames)for(var c=context.attributeNames[e],g=0;g<c.length;g++){var n={};n.valueIdx=g;if("yes"==c[g][0]||"no"==c[g][0]){n.name=e;n.attrName=e;n.booleanAttr=!0;b.push(n);break}else n.booleanAttr=!1,n.attrName=e,n.valueName=c[g][0],n.name=e+SEPARATOR+c[g][0],b.push(n)}return b}
function selectionAdded(){for(var b=$("#search").tokenInput("get"),e="",c=0;c<b.length;c++)e+=b[c].name+",";isBlank(e)?(showNodes(),vis.selectAll(".selected").classed("selected",!1)):(b=searchFacet(e,!0),addOrReplaceToSelectionList(b[0],!0),highlightNodes(b[0]),hideNodes(b[1]))}
function buildOptionsForSelect(b,e,c){e=$("#"+e);e.empty();for(var g,n=0;n<b.length;n++)g=$('<option value="'+b[n].val+'" rel="tooltip"  data-trigger="hover" data-placement="right" data-title="'+b[n].tooltip+'">'+b[n].name+"</option>"),b[n].val==c&&g.attr("selected","selected"),e.append(g)}function appendOptionForSelect(b,e,c,g){b=$('<option value="'+e+'" rel="tooltip"  data-trigger="hover" data-placement="right" data-title="'+c+'">'+b+"</option>");$("#"+g).append(b)}
function addOrReplaceToSelectionList(b,e){e&&$("#selection_list").empty();for(var c=0;c<b.length;c++){var g=b[c];$("<li>").appendTo("#selection_list").html("Attributes: <span>"+g.attr("intent")+"</span><BR/> Objects: <span>"+g.attr("extent")+"</span>")}}
function updateSelectionList(){$("#selection_list").empty();vis.selectAll("circle.selected").each(function(b){$("<li>").appendTo("#selection_list").html("Attributes: <span>"+b.intent.join(", ")+"</span><BR/> Objects: <span>"+b.extent.join(", ")+"</span>")})}
function updateEntityList(){$("#attr_list").empty();$("#obj_list").empty();for(var b=getAttributeValuesPairs(),e=0;e<b.length;e++){var c=$("<li>").appendTo("#attr_list");c.html("<span><input type='checkbox' name='attr' value='"+b[e].name+"'> "+b[e].name+"</span>")}for(var g=context.objects,e=0;e<g.length;e++)c=$("<li>").appendTo("#obj_list"),c.html("<span><input type='checkbox' name='obj' value='"+g[e]+"'> "+g[e]+"</span>");$("#attr-count").html(b.length);$("#obj-count").html(g.length)}
function addMetricComponentsCallback(b,e){appendOptionForSelect(e,b,"Nodes are drawn according to this metric value","select-label");appendOptionForSelect(e,b,"Nodes are drawn according to this metric value","select-size")}function addLinkMetricComponentsCallback(b,e){appendOptionForSelect(e,b,"Edge thickness are drawn according to this metric value","select-edge")}
function appendMetricFilterCallback(b,e){var c=$('<label for="'+b+'" style="text-align: left; ">'+e+":</label>"),g=$('<input type="text" id="'+b+'-value" class="metric-value" name="'+e+'"  />'),n=$('<div id="slider-'+b+'" class="slider"></div>'),q=$("<div></div>");$(q).append(c);$(q).append(g);$(q).append(n);$("#metric-filter-content").append(q);"esupport"==b?$("#slider-"+b).slider({range:!0,min:0,max:100,values:[0,100],slide:function(c,e){$("#"+b+"-value").val(e.values[0]+"% - "+e.values[1]+"%");
filterConceptsByMetric(b,e.values[0],e.values[1])}}):$("#slider-"+b).slider({min:0,max:100,value:[0],slide:function(c,e){$("#"+b+"-value").val(e.value+"%");filterConceptsByMetric(b,e.value,null)}})}function wrapperElementsInList(b,e){b.empty();$(e).each(function(c,e){b.append($(document.createElement("li")).text(e))})}
function wrapperMetricsinTable(b,e){$("#"+b).html("");$("<table></table>");$("<table></table>");$("<table></table>");var c="<table><tr><th>Metric</th><th>Value</th></tr>",g;for(g in e)c+="<tr><td>"+metrics.getHumanName(g)+"</td><td>"+Math.round(100*e[g])+"%</td></tr>";$("#"+b).append(c+"</table>")}
function showHoverbox(b){mouseOverHoverBox=!0;hoverbox.style("display","block");hoverbox.transition().delay(800).duration(300).style("opacity",1);hoverbox.style("left",d3.event.pageX+20+"px").style("top",d3.event.pageY-20+"px");$(".attr-count-concept").text(b.intent.length);$(".obj-count-concept").text(b.extent.length);wrapperElementsInList($("ul.hb_attr_list"),b.intent);wrapperElementsInList($("ul.hb_obj_list"),b.extent);wrapperMetricsinTable("metrics-table",metrics.getScores(b.id))}
function hideHoverbox(){mouseOverHoverBox=!1;setTimeout(function(){mouseOverHoverBox||hoverbox.transition().duration(200).style("opacity",0).style("display","none")},1800)}function nodeMouseOver(b){showHoverbox(b);updateDistributionChart(b)}function nodeMouseOut(){hideHoverbox()}function nodeClick(){clearSearch();updateSelectionList();$("#sel-count").text("("+numberSelected+")")}$(function(){$("input[name='metric']").change(function(){calculate($(this).val())})});
function calculate(b){if("undefined"==typeof lattice.id||null==lattice.id)flashAlert("The current concept lattice is not saved in the server - could not compute metric.","error");else if("undefined"==typeof metric_stability){$("input[name='metric'][value='"+b+"']").parent().append("<img name='"+b+"' src='"+STATIC_URL+"/images/loading-trans.gif'/>");var e=$("input[name=csrfmiddlewaretoken]").val();$.getJSON("/api/v1/metrics/",{lattice_id:lattice.id,metric:b,csrfmiddlewaretoken:e},function(c){$("img[name='"+
b+"']").remove();$("input[name='metric'][value='"+b+"']").prop("disabled",!0);c.link_score?metrics.appendLinkMetric(c.name,c.human_name,c.scores):metrics.appendMetricValues(c.name,c.human_name,c.scores)})}}
var metrics=new function(){var b={},e={},c=[],g={},n=[];this.addListener=function(b){c.push(b)};this.addLinkListener=function(b){n.push(b)};this.appendLinkMetric=function(b,c,e){var z={},A;for(A in e){var B=A.split("-"),C=B[1];"undefined"==typeof z[B[0]]&&(z[B[0]]={});z[B[0]][C]=e[A]}g[b]={humanName:c,scores:z};for(z=0;z<n.length;z++)n[z](b,c,e)};this.appendMetricValues=function(g,n,v){e[g]=n;for(var z in v)z in b||(b[z]={}),b[z][g]=v[z];for(z=0;z<c.length;z++)c[z](g,n,v)};this.getCalculatedMetrics=
function(){var c=[],e=Object.keys(b)[0];for(metric in b[e])c.push(metric);return c};this.getScore=function(c,e){return b[c][e]};this.getScores=function(b){for(var c={},e=this.getCalculatedMetrics(),g=0;g<e.length;g++){var n=e[g];c[n]=this.getScore(b,n)}return c};this.getLinkScore=function(b,c,e){return g[e].scores[b][c]};this.getHumanName=function(b){return e[b]}};
function filterConceptsByMetric(b,e,c){$("input.metric-value");for(var g=0;g<lattice.initialConcepts.length;g++){var n=lattice.initialConcepts[g];null!=c?metrics.getScore(n.id,b)<e/100||metrics.getScore(n.id,b)>c/100?lattice.removeConcept(n):lattice.readdConcept(n):metrics.getScore(n.id,b)<e/100?lattice.removeConcept(n):lattice.readdConcept(n)}updateVis()}var queryResults,colTypes={};
$(function(){$("input.load-context").prop("disabled",!0);$("ul.nav > li.active").removeClass("active");$("li#semantics").addClass("active");$(".sel-col-type").live("click",function(b){var e=b.target.name.split("_col-");colTypes[e[0]]=e[1];$('i[name="'+e[0]+'-selected"]').remove();$(b.target).append('<i name="'+e[0]+'-selected" class="icon-ok"></i>')});$("a.sparql-search").click(function(){var b=$("textarea#search_prefix").val(),e=$("textarea#search_query").val(),c=$("input[name=csrfmiddlewaretoken]").val();
$("div#sparql_result").empty();showLoading();$.get("/"+WORKSPACE_SLUG+"/semantics/search",{format:"json",search_prefix:b,search_query:e,csrfmiddlewaretoken:c},function(b){queryResults=b;hideLoading();$("input.load-context").prop("disabled",!1);$("input.load-context").removeClass("disabled");if("undefined"==typeof b.error){for(var c=$('<table class="table table-striped"></table>'),e=$("<tr></tr>"),r=0;r<b.head.vars.length;r++)e.append("<th>"+getOptionsHeader(b.head.vars[r])+"</th>");c.append(e.appendTo("<thead></thead>"));
for(r=0;r<b.results.bindings.length;r++){for(var e=$("<tr></tr>"),v=b.results.bindings[r],z=0;z<b.head.vars.length;z++){var A=v[b.head.vars[z]].value;-1!=A.indexOf("#")&&(A=A.split("#")[1]);e.append("<td>"+A+"</td>")}c.append(e)}c.appendTo("div#sparql_result")}else $("div#sparql_result").html(b.error)})})});
function getOptionsHeader(b){return' <ul class="nav nav-tabs">  <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#">  '+b+' <b class="caret"></b> </a><ul class="dropdown-menu"> <a href="#" name="'+b+'_col-obj" class="sel-col-type ">Object</a> <a href="#" name="'+b+'_col-attr" class="sel-col-type "> Attribute name</a> <a href="#" name="'+b+'_col-attrval" class="sel-col-type "> Attribute value</a></ul></li></ul>'}
function prepareForSubmission(){var b=JSON.stringify(queryResults,null,2),e=JSON.stringify(colTypes,null,2);$("input[name=col_types]").val(e);$("input[name=results_table]").val(b);return!0}function flatten(b){function e(b){b.children&&b.children.forEach(e);b.id||(b.id=++g);c.push(b)}var c=[],g=0;e(b);return c}
function unique_set(b,e){e||(e=!1);arr=[];if(e)for(i=0;i<b.length;i++){flag=!0;for(j=0;j<arr.length;j++){var c;c=arr[j];var g=b[i];result=!0;if(c.length!==g.length)c=!1;else{for(k=0;k<c.length;k++)compare_objects(c[k],g[k])||(result=!1);c=result}c&&(flag=!1)}flag&&arr.push(b[i])}else for(i=0;i<b.length;i++){flag=!0;for(j=0;j<arr.length;j++)compare_objects(arr[j],b[i])&&(flag=!1);flag&&arr.push(b[i])}return arr}
var compare_objects=function(b,e){if(b===e)return!0;if(!(b instanceof Object)||!(e instanceof Object)||b.constructor!==e.constructor)return!1;for(var c in b)if(b.hasOwnProperty(c)&&(!e.hasOwnProperty(c)||b[c]!==e[c]&&("object"!==typeof b[c]||!Object.equals(b[c],e[c]))))return!1;for(c in e)if(e.hasOwnProperty(c)&&!b.hasOwnProperty(c))return!1;return!0};
function compare_a_rules(b,e){tmp1={};tmp2={};tmp1.prem=clone(b.premise);tmp1.conc=clone(b.conclusion);tmp2.prem=clone(e.premise);tmp2.conc=clone(e.conclusion);sub_sets_equal=compare_objects(tmp1.prem,tmp2.prem)&&compare_objects(tmp1.conc,tmp2.conc);tmp1=clone(b);tmp2=clone(e);tmp1.premise=1;tmp1.conclusion=1;tmp2.premise=1;tmp2.conclusion=1;return compare_objects(tmp1,tmp2)&&sub_sets_equal}
Array.prototype.transpose=function(){var b=this.length?this.length:0,e=this[0]instanceof Array?this[0].length:0;if(0===e||0===b)return[];var c,g,n=[];for(c=0;c<e;c++){n[c]=[];for(g=0;g<b;g++)n[c][g]=this[g][c]}return n};function clone(b){if(!b||"object"!==typeof b)return b;var e="function"===typeof b.pop?[]:{},c,g;for(c in b)b.hasOwnProperty(c)&&(g=b[c],e[c]=g&&"object"===typeof g?clone(g):g);return e}function ArrayAddAll(b,e){for(var c=0;c<b.length;c++)0>e.indexOf(b[c])&&e.push(b[c])}
function ArraySubtract(b,e){for(var c=[],g=0;g<b.length;g++)0<=e.indexOf(b[g])||c.push(b[g]);return c}function ArraySubtractId(b,e){for(var c=[],g=0;g<b.length;g++){for(var n=!1,q=0;q<e.length&&!n;q++)b[g].id==e[q].id&&(n=!0);n||c.push(b[g])}return c}function ArrayIntersect(b,e){for(var c=[],g=0;g<b.length;g++)!isBlank(b[g])&&0<=e.indexOf($.trim(b[g]))&&c.push(b[g]);return c}
function ArrayContainsAll(b,e){if(0==b.length)return!1;for(var c=0;c<e.length;c++)if(!isBlank(e[c])&&0>b.indexOf($.trim(e[c])))return!1;return!0}function ArrayIntersectId(b,e){for(var c=[],g=0;g<b.length;g++)for(var n=0;n<e.length;n++)b[g].id==e[n].id&&c.push(b[g]);return c}function ArrayRemove(b,e,c){c=b.slice((c||e)+1||b.length);b.length=0>e?b.length+e:e;return b.push.apply(b,c)}function HashClone(b){return jQuery.extend(!0,{},b)}function getKeys(b){var e=[],c;for(c in b)e.push(c);return e}
String.prototype.escapeHTML=function(){return this.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")};function isBlank(b){return!b||/^\s*$/.test(b)}function removeWhiteSpaces(b){return b=b.replace(/\s/g,"")}
var dagreVis=new function(){this.config={displayLabels:!0,nodePadding:10,widthLabelBox:60,paddingToNode:12};this.run=function(){d3.select("#chart").html("");vis=d3.select("#chart").append("svg:svg").attr("width",w).attr("height",h).attr("viewBox","0 0 "+w+" "+h).attr("preserveAspectRatio","xMidYMid").attr("pointer-events","all").append("svg:g").call(d3.behavior.zoom().on("zoom",redraw));vis.append("svg:g");lattice.concepts.forEach(function(b){b.edges=[]});lattice.edges.forEach(function(b){"number"===
typeof b.source&&(b.source=lattice.concepts[b.source],b.target=lattice.concepts[b.target]);b.source.edges.push(b);b.target.edges.push(b)});var b=vis.selectAll("path .dedge").data(lattice.edges).enter().append("path").attr("class","dedge").style("stroke-width",getEdgeThickness).attr("source_id",function(b){return b.source.id}).attr("target_id",function(b){return b.target.id}),e=vis.selectAll("circle .concept").data(lattice.concepts).enter().append("circle").attr("class","concept node").style("fill",
getNodeColor).attr("x",function(){return-10}).attr("y",function(){return-10}).attr("r",getNodeSize).attr("id",function(b){return"node-"+b.id}).on("click",this.nodeClick).on("mouseover",this.nodeMouseOver).on("mouseout",this.nodeMouseOut),c=vis.selectAll("text .intent").data(lattice.concepts).enter().append("text").attr("id",function(b){return"intent-"+b.id}).attr("class","intent").attr("x",4).attr("y",-dagreVis.config.paddingToNode).text(get_upper_label),g=vis.selectAll("text .extent").data(lattice.concepts).enter().append("text").attr("id",
function(b){return"extent-"+b.id}).attr("class","extent").attr("x",4).attr("y",dagreVis.config.paddingToNode).text(get_lower_label);e.each(function(b){var c=this.getBBox();b.bbox=c;b.width=getNodeSize(b);b.height=getNodeSize(b)});dagre.layout().nodeSep(50).edgeSep(10).rankSep(80).invert(!0).nodes(lattice.concepts).edges(lattice.edges).debugLevel(1).run();e.attr("transform",function(b){return"translate("+b.dagre.x+","+b.dagre.y+")"});b.attr("id",function(b){return"edge-"+b.dagre.id}).attr("d",function(b){return dagreVis.spline(b)});
c.attr("transform",function(b){return"translate("+(b.dagre.x-dagreVis.config.widthLabelBox/2)+","+(b.dagre.y-dagreVis.config.paddingToNode)+")"});g.attr("transform",function(b){return"translate("+(b.dagre.x-dagreVis.config.widthLabelBox/2)+","+(b.dagre.y+dagreVis.config.paddingToNode)+")"});var b=d3.select("#chart").select("svg"),n=b.node().getBBox();b.attr("viewBox","0 0 "+n.width+" "+h);b=d3.behavior.drag().origin(function(b){return b.pos?{x:b.pos.x,y:b.pos.y}:{x:b.dagre.x,y:b.dagre.y}}).on("dragstart",
function(){vis.on("mousedown.zoom",null);vis.on("mousemove.zoom",null)}).on("dragend",function(){console.log("drag ended");dragging=!1}).on("drag",function(b){var c=b.dagre.x,e=b.dagre.y;b.dagre.x=Math.max(b.width/2,Math.min(n.width-b.width/2,d3.event.x));b.dagre.y=Math.max(b.height/2,Math.min(n.height-b.height/2,d3.event.y));d3.select(this).attr("transform","translate("+b.dagre.x+","+b.dagre.y+")");var g=b.dagre.x-c,A=b.dagre.y-e;b.edges.forEach(function(b){dagreVis.translateEdge(b,g,A);d3.select("#edge-"+
b.dagre.id).attr("d",dagreVis.spline(b))});d3.select("#intent-"+b.id).attr("transform","translate("+(b.dagre.x-dagreVis.config.widthLabelBox/2)+","+(b.dagre.y-dagreVis.config.paddingToNode)+")");d3.select("#extent-"+b.id).attr("transform","translate("+(b.dagre.x-dagreVis.config.widthLabelBox/2)+","+(b.dagre.y+dagreVis.config.paddingToNode)+")")});g=d3.behavior.drag().on("dragstart",function(b){this.__originx__=b.lpos?b.lpos.x:b.dagre.x-dagreVis.config.widthLabelBox/2;this.__originy__=b.lpos?b.lpos.y:
b.dagre.y-dagreVis.config.paddingToNode}).on("drag",function(b){b.lpos={x:Math.max(0,Math.min(this.__originx__+=d3.event.dx,w)),y:Math.max(0,Math.min(this.__originy__+=d3.event.dy,h))};d3.select(this).attr("transform","translate("+b.lpos.x+","+b.lpos.y+")")});e.call(b);c.call(g)};this.move=function(){this.parentNode.appendChild(this);var b=d3.select(this);b.attr("cx",function(){return d3.event.dx+parseInt(b.attr("cx"))}).attr("cy",function(){return d3.event.dy+parseInt(b.attr("cy"))})};this.spline=
function(b){var e=b.dagre.points.slice(0),c=dagre.util.intersectRect(b.source.dagre,0<e.length?e[0]:b.source.dagre),b=dagre.util.intersectRect(b.target.dagre,0<e.length?e[e.length-1]:b.source.dagre);e.unshift(c);e.push(b);pts=[c,b];return d3.svg.line().x(function(b){return b.x}).y(function(b){return b.y}).interpolate("linear")(pts)};this.translateEdge=function(b,e,c){b.dagre.points.forEach(function(b){b.x=Math.max(0,Math.min(800,b.x+e));b.y=Math.max(0,Math.min(600,b.y+c))})};this.nodeMouseOver=function(b){nodeMouseOver(b);
d3.select(this).classed("hover",!0);highlightPath&&visitEdgesDown(b,function(b){d3.select('path.dedge[source_id="'+b.source.id+'"][target_id="'+b.target.id+'"]').classed("highlighted",!0)})};this.nodeMouseOut=function(b){nodeMouseOut(b);d3.select(this).classed("hover",!1);d3.selectAll("path.dedge.highlighted").classed("highlighted",!1)};this.nodeClick=function(b){nodeClick(b);d3.select(this).classed("selected",function(){if(this.classList.contains("selected"))return numberSelected--,!1;numberSelected++;
return!0})}},labeling_type=LABEL_MULTILABEL,size_type="default",color_type="default",highlightPath=!0,color=mapColor,currentVis="dagre",previousVis="dagre",w=DEFAULT_WIDTH,h=DEFAULT_HEIGHT,trans=[0,0],scale=1,force,vis,dragging=!1,noLinks=["sunburst","icicle","sankey"];function resetZoom(){scale=1;d3.behavior.zoom().scale(1);vis.attr("transform","scale("+scale+")");$("#zoom_level").val("100%")}
function redraw(){trans=d3.event.translate;scale=d3.event.scale;$("#zoom_level").val(Math.round(100*scale)+"%");vis.attr("transform","translate("+trans+") scale("+scale+")")}
function redrawCurVis(){d3.select("#chart").html("");"lattice"==currentVis?initFDLattice():"sankey"==currentVis?sankeyVis.run():"dagre"==currentVis?dagreVis.run():"sunburst"==currentVis?sunburstVis.run():"icicle"==currentVis?initIcicle():"treemap"==currentVis?treemap():"tree"==currentVis?initTree():"matrixview"==currentVis?(initARView(),createRulesList()):"radiagram"==currentVis?(initDiagonalARView(),createRulesList()):"gg_ar_plot"==currentVis&&(init_gg_plot(),createRulesList())}
function changeVis(b){prevIndex=-1;currentVis=b;redrawCurVis();setPreferredVis(b)}function updateVis(){redrawCurVis()}function setPreferredVis(b){var e=$("input[name=csrfmiddlewaretoken]").val();$.post("/"+WORKSPACE_SLUG+"/fca/set_preferred_vis",{pref_vis:b,csrfmiddlewaretoken:e},function(){})}function setOverwhelmingOff(){var b=$("input[name=csrfmiddlewaretoken]").val();$.post("/"+WORKSPACE_SLUG+"/fca/set_overwhelming_off",{csrfmiddlewaretoken:b},function(){})}
function exportCurVis(){var b=d3.select("svg").attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;d3.select("#export-link").attr("title","file.svg").attr("target","_blank").attr("href-lang","image/svg+xml").attr("href","data:image/svg+xml;base64,\n"+btoa(b)).text("Download")}var rect;
function initIcicle(){x=d3.scale.linear().range([0,w]);y=d3.scale.linear().range([0,h]);vis=d3.select("#chart").append("svg:svg").attr("width",w).attr("height",h);partition=d3.layout.partition().value(function(){return 1});updateIcicle()}
function updateIcicle(){var b=lattice.getTree();vis.data([b]);partition.nodes(b);rect=vis.selectAll("rect").data(partition.nodes);rect.enter().append("svg:rect").attr("x",function(b){return x(b.x)}).attr("y",function(b){return y(b.y)}).attr("width",function(b){return x(b.dx)}).attr("height",function(b){return y(b.dy)}).attr("fill",function(b){return color((b.children?b:b.parent).name)}).on("mouseover",nodeMouseOver).on("mouseout",nodeMouseOut).on("click",nodeClick).on("dblclick",icclick);vis.selectAll("rect").data(partition.nodes).enter().append("svg:text").attr("class",
"intent").attr("x",-22).attr("y","-1em").attr("id",function(b){return"intent_"+b.id}).text(d.intent.join(", "));rect.exit().remove()}function icclick(b){x.domain([b.x,b.x+b.dx]);y.domain([b.y,1]).range([b.y?20:0,h]);rect.transition().duration(750).attr("x",function(b){return x(b.x)}).attr("y",function(b){return y(b.y)}).attr("width",function(b){return x(b.x+b.dx)-x(b.x)}).attr("height",function(b){return y(b.y+b.dy)-y(b.y)})}var tree,root,diagonal,m,duration,treei=0;
function initTree(){function b(e){e.children&&(e._children=e.children,e._children.forEach(b),e.children=null)}m=[20,120,20,120];duration=500;tree=d3.layout.tree().size([h,w]);diagonal=d3.svg.diagonal().projection(function(b){return[b.y,b.x]});vis=d3.select("#chart").append("svg:svg").attr("width",w+m[1]+m[3]).attr("height",h+m[0]+m[2]).append("svg:g").attr("transform","translate("+m[3]+","+m[0]+")");root=lattice.getTree();root.x0=h/2;root.y0=0;root.children.forEach(b);updateTree(root)}
function updateTree(b){var e=tree.nodes(root).reverse();e.forEach(function(b){b.y=180*b.depth});var c=vis.selectAll("g.node").data(e,function(b){return b.id}),g=c.enter().append("svg:g").attr("class","node").attr("transform",function(){return"translate("+b.y0+","+b.x0+")"}).on("dblclick",clickCollapse);g.append("svg:circle").attr("r",getNodeSize).on("click",nodeClick).on("mouseover",nodeMouseOver).on("mouseout",nodeMouseOut);g.append("svg:text").attr("class","intent").attr("x",function(b){return b.children||
b._children?-10:10}).attr("dy","-1.5em").attr("text-anchor",function(b){return b.children||b._children?"end":"start"}).text(get_upper_label).style("fill-opacity",1E-6);g.append("svg:text").attr("class","extent").attr("x",function(b){return b.children||b._children?-10:10}).attr("dy","1.5em").attr("text-anchor",function(b){return b.children||b._children?"end":"start"}).text(get_lower_label).style("fill-opacity",1E-6);c.transition().duration(duration).attr("transform",function(b){return"translate("+
b.y+","+b.x+")"}).selectAll("text").style("fill-opacity",1);c.exit().transition().duration(duration).attr("transform",function(){return"translate("+b.y+","+b.x+")"}).remove().selectAll("text").style("fill-opacity",1E-6);c=vis.selectAll("path.treelink").data(tree.links(e),function(b){return b.target.id});c.enter().insert("svg:path","g").attr("class","treelink").attr("d",function(){var c={x:b.x0,y:b.y0};return diagonal({source:c,target:c})}).transition().duration(duration).attr("d",diagonal);c.transition().duration(duration).attr("d",
diagonal);c.exit().transition().duration(duration).attr("d",function(){var c={x:b.x,y:b.y};return diagonal({source:c,target:c})}).remove();e.forEach(function(b){b.x0=b.x;b.y0=b.y})}function clickCollapse(b){b.children?(b._children=b.children,b.children=null):(b.children=b._children,b._children=null);updateTree(b)}var tm_root;
function treemap(){console.log("initilizing treemap");m=[20,120,20,120];duration=500;treemap=d3.layout.treemap().size([h,w]).sticky(!0).value(function(b){return size_type==SIZE_SUPPORT?b.support:size_type==SIZE_STABILITY?b.stability:1});vis=d3.select("#chart").append("svg:svg").attr("width",w+m[1]+m[3]).attr("height",h+m[0]+m[2]).append("svg:g");tm_root=getTree0();tm_root.x0=0;tm_root.y0=0;tm_updateTree(tm_root)}
function tm_updateTree(b){console.log("updating");color=d3.scale.category20c();var e=treemap.nodes(tm_root),e=vis.selectAll("g.node").data(e,function(){return size_type==SIZE_SUPPORT?d.support:size_type==SIZE_STABILITY?d.stability:1}),c=e.enter().append("svg:g").attr("class","node").attr("transform",function(){return"translate("+tm_root.y0+","+tm_root.x0+")"}).on("dblclick",clickCollapse);c.append("svg:rect").attr("x",function(b){return b.x}).attr("y",function(b){return b.y}).attr("width",function(b){return Math.max(0,
b.dx)}).attr("height",function(b){return Math.max(0,b.dy)}).style("fill",function(b){return color(b.depth)}).style("stroke","white").style("opacity",1).on("mouseover",nodeMouseOver).on("mouseout",nodeMouseOut);c.append("svg:text").attr("class","intent").attr("x",function(b){return b.x}).attr("y",function(b){return b.y+30}).text(get_upper_label).style("fill-opacity",1E-6);c.append("svg:text").attr("class","extent").attr("x",function(b){return b.x}).attr("y",function(b){return b.y+15}).text(get_lower_label).style("fill-opacity",
1E-6);e.transition().duration(duration).attr("transform",function(b){return"translate("+b.y0+","+b.x0+")"}).selectAll("text").style("fill-opacity",1);e.exit().transition().duration(duration).style("fill-opacity",1).attr("transform",function(){return"translate("+b.y0+","+b.x0+")"}).remove().selectAll("text").style("fill-opacity",1E-6)}
function init_matrix_view(){function b(b){d3.select(this).selectAll(".cell").data(b.filter(function(b){return b.z})).enter().append("rect").attr("class","cell").attr("x",function(b){return b.y*w/g}).attr("width",w/g).attr("height",h/myobject.length).style("fill-opacity",function(b){return b.confidence}).style("fill",function(b){return z(b.z)})}var e=[20,120,20,120],c=[],g=0,n=[];for(a in context.attributeNames)for(q=0;q<context.attributeNames[a].length;q++)"yes"==context.attributeNames[a][q][0]?n.push(a.toString()):
"no"!=context.attributeNames[a][q][0]&&n.push(a.toString()+"-"+context.attributeNames[a][q][0]);for(var g=n.length,q=0;q<myobject.length;q++)c[q]=[],c[q]=d3.range(g).map(function(b){return{x:q,y:b,z:0}});for(q=0;q<myobject.length;q++)for(var r=0;r<g;r++){for(var v=0;v<myobject[q].premise.length;v++)n[r]==myobject[q].premise[v]&&(c[q][r].z=1,c[q][r].confidence=myobject[q].confidence,c[q][r].premise_supp=myobject[q].premise_supp,c[q][r].conclusion_supp=myobject[q].conclusion_supp,c[q][r].premise=myobject[q].premise,
c[q][r].conclusion=myobject[q].conclusion);for(v=0;v<myobject[q].conclusion.length;v++)n[r]==myobject[q].conclusion[v]&&(c[q][r].z=2,c[q][r].confidence=myobject[q].confidence,c[q][r].premise_supp=myobject[q].premise_supp,c[q][r].conclusion_supp=myobject[q].conclusion_supp,c[q][r].premise=myobject[q].premise,c[q][r].conclusion=myobject[q].conclusion)}d3.scale.ordinal().rangeBand([0,w]);d3.scale.linear().domain([0,4]).clamp(!0);var z=d3.scale.category10().domain(d3.range(10)),r=0;for(q in context.attributeNames)r=
Math.max(r,q.length);e[0]=12*r;for(q=r=0;q<myobject.length;q++)r=Math.max(r,myobject[q].premise.toString().length);e[1]=10+10*Math.log(myobject.length)/Math.LN10;vis=d3.select("#chart").append("svg:svg").attr("width",w+e[1]+e[3]).attr("height",h+e[0]+e[2]).append("svg:g").attr("transform","translate("+e[1]+","+e[0]+")");vis.append("rect").attr("class","background").attr("width",width).attr("height",height);b=vis.selectAll(".row").data(c).enter().append("g").attr("class","row").attr("transform",function(b){return"translate(0,"+
b[0].x*h/myobject.length+")"}).each(b);b.append("line").attr("x2",w).attr("class","matrix_view_separator");b.append("text").attr("x",0).attr("dy","1em").attr("text-anchor","end").attr("class","label").text(function(b,c){return"R"+c.toString()});e=vis.selectAll(".column").data(c.transpose()).enter().append("g").attr("class","column").attr("transform",function(b,c){return"translate("+b[c].y*w/g+")rotate(-90)"});e.append("line").attr("x1",-w).attr("class","matrix_view_separator");e.append("text").attr("class",
"label").attr("x",0).attr("dy","1em").attr("text-anchor","start").text(function(b,c){return n[c]})}function initFDLattice(){force=d3.layout.force().gravity(0.1).distance(100).charge(-320).on("tick",tick).size([w,h]);vis=d3.select("#chart").append("svg:svg").attr("width",w).attr("height",h).attr("pointer-events","all").append("svg:g").call(d3.behavior.zoom().on("zoom",redraw)).append("svg:g");vis.append("svg:rect").attr("width",w).attr("height",h).attr("fill","white");updateFDLattice()}
function updateFDLattice(){var b=lattice.concepts,e=lattice.edges;force.nodes(b).links(e).start();clink=vis.selectAll("line.link").data(e);clink.enter().insert("svg:line",".node").attr("class","link").attr("x1",function(b){return b.source.x}).attr("y1",function(b){return b.source.y}).attr("x2",function(b){return b.target.x}).attr("y2",function(b){return b.target.y}).attr("source_id",function(b){return b.source.id}).attr("target_id",function(b){return b.target.id});clink.exit().remove();cnode=vis.selectAll("circle.node").data(b,
function(b){return b.id});cnode.enter().append("svg:circle").attr("class","node").attr("cx",function(b){return b.x}).attr("cy",function(b){return b.y}).attr("r",getNodeSize).attr("intent",function(b){return b.intent}).attr("extent",function(b){return b.extent}).attr("id",function(b){return b.id}).attr("children",function(b){return b.children}).on("click",nodeClick).on("mouseover",nodeMouseOver).on("mouseout",nodeMouseOut).call(force.drag);cnode.exit().remove();ulabel=vis.selectAll("text.intent").data(b,
function(b){return b.id});ulabel.enter().append("svg:text").attr("class","intent").attr("x",-22).attr("y","-1em").attr("id",function(b){return"intent_"+b.id}).text(get_upper_label);ulabel.exit().remove();llabel=vis.selectAll("text.extent").data(b,function(b){return b.id});llabel.enter().append("svg:text").attr("x",-22).attr("y","2em").attr("class","extent").attr("id",function(b){return"extent_"+b.id}).text(get_lower_label);llabel.exit().remove()}
function tick(b){clink.attr("x1",function(b){return b.source.x}).attr("y1",function(b){return b.source.y}).attr("x2",function(b){return b.target.x}).attr("y2",function(b){return b.target.y});cnode.attr("cx",function(b){return b.x}).attr("cy",function(b){return b.y});ulabel.attr("transform",function(b){return"translate("+b.x+","+b.y+")"});llabel.attr("transform",function(b){return"translate("+b.x+","+b.y+")"});var e=0.2*b.alpha;cnode.each(function(b){b.y+=(100*b.depth-b.y)*e})}
function labelizeLattice(b,e){function c(c){for(var c=b.indexOf(c),g=[],n=0;n<e.length;n++)e[n].source==c&&g.push(b[e[n].target]);return g}var g;a:{for(g=0;g<b.length;g++){for(var n=b.indexOf(b[g]),q=[],r=0;r<e.length;r++)e[r].target==n&&q.push(b[e[r].source]);if(0==q.length){g=b[g];break a}}g=void 0}a:{for(n=0;n<b.length;n++)if(0==c(b[n]).length){n=b[n];break a}n=void 0}var v=n.intent,n=g;g=function(b){b.upperLabel=ArrayIntersect(v,b.intent).join(", ");v=ArraySubtract(v,b.intent)};g(n);n=c(n);for(q=
0;q<n.length;q++)g(n[q]),r=c(n[q]),0<r.length&&ArrayAddAll(r,n)}
function createMiniLattice(b,e,c){labelizeLattice(b,e);var g=d3.select("#"+c).append("svg:svg").attr("width",200).attr("height",150).attr("viewBox","0 0 200 150").attr("preserveAspectRatio","xMidYMid").append("svg:g").attr("transform","translate(100,20)");b.forEach(function(b,e){b.id=c+"-"+e;b.edges=[]});e.forEach(function(c){"number"===typeof c.source&&(c.source=b[c.source],c.target=b[c.target]);c.id=c.source.id+"-"+c.target.id;c.source.edges.push(c);c.target.edges.push(c)});var n=g.selectAll("path .dedge").data(e).enter().append("path").attr("id",
function(b){return"mini-edge-"+b.id}).attr("class","dedge"),q=g.selectAll("circle .node").data(b).enter().append("circle").attr("class","node").attr("x",function(){return-10}).attr("y",function(){return-10}).attr("r",5).attr("id",function(b){return"mini-node-"+b.id}),g=g.selectAll("text .mini-intent").data(b).enter().append("text").attr("id",function(b){return"mini-intent-"+b.id}).attr("class","mini-intent").text(function(b){return b.upperLabel});q.each(function(b){var c=this.getBBox();b.bbox=c;b.width=
10;b.height=10});g.attr("x",function(){return-10}).attr("y",function(){return-5});dagre.layout().nodeSep(15).edgeSep(15).rankSep(25).invert(!1).nodes(b).edges(e).debugLevel(1).run();q.attr("transform",function(b){return"translate("+b.dagre.x+","+b.dagre.y+")"});g.attr("transform",function(b){return"translate("+(b.dagre.x-5)+","+(b.dagre.y-5)+")"});n.attr("d",function(b){return spline(b)});var e=d3.select("#"+c).select("svg"),r=e.node().getBBox();e.attr("viewBox","0 0 "+r.width+" 150");d3.behavior.drag().origin(function(b){return b.pos?
{x:b.pos.x,y:b.pos.y}:{x:b.dagre.x,y:b.dagre.y}}).on("drag",function(b){var c=b.dagre.x,e=b.dagre.y;b.dagre.x=Math.max(b.width/2,Math.min(r.width-b.width/2,d3.event.x));b.dagre.y=Math.max(b.height/2,Math.min(r.height-b.height/2,d3.event.y));d3.select(this).attr("transform","translate("+b.dagre.x+","+b.dagre.y+")");var g=b.dagre.x-c,n=b.dagre.y-e;b.edges.forEach(function(b){translateEdge(b,g,n);d3.select("#mini-edge-"+b.id).attr("d",spline(b))});d3.select("#mini-intent-"+b.id).attr("transform","translate("+
(b.dagre.x-5)+","+(b.dagre.y-5)+")")})}function spline(b){var e=b.dagre.points.slice(0),c=dagre.util.intersectRect(b.source.dagre,0<e.length?e[0]:b.source.dagre),b=dagre.util.intersectRect(b.target.dagre,0<e.length?e[e.length-1]:b.source.dagre);e.unshift(c);e.push(b);pts=[c,b];return d3.svg.line().x(function(b){return b.x}).y(function(b){return b.y}).interpolate("linear")(pts)}
function translateEdge(b,e,c){b.dagre.points.forEach(function(b){b.x=Math.max(0,Math.min(800,b.x+e));b.y=Math.max(0,Math.min(600,b.y+c))})}
function loadAttributeGraph(b){var e=b.links,c=b.nodes;e.forEach(function(b){b.source=c[b.source]||(c[b.source]={name:b.source});b.target=c[b.target]||(c[b.target]={name:b.target})});b=d3.layout.force().nodes(d3.values(c)).links(e).size([500,600]).linkDistance(150).charge(-300).on("tick",function(){g.attr("d",function(b){var c=b.target.x-b.source.x,e=b.target.y-b.source.y,c=Math.sqrt(c*c+e*e);return"M"+b.source.x+","+b.source.y+"A"+c+","+c+" 0 0,1 "+b.target.x+","+b.target.y});n.attr("transform",
function(b){return"translate("+b.x+","+b.y+")"});q.attr("transform",function(b){return"translate("+b.x+","+b.y+")"})}).start();e=d3.select("#attr-graph").append("svg:svg").attr("width",500).attr("height",600);e.append("svg:defs").selectAll("marker").data(["suit","licensing","resolved"]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 -5 10 10").attr("refX",15).attr("refY",-1.5).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5");
var g=e.append("svg:g").selectAll("path").data(b.links()).enter().append("svg:path").attr("class",function(){return"aglink suit"}).attr("marker-end",function(){return"url(#suit)"}).style("stroke-width",function(b){if(0!=b.total)return Math.round(10*(b.count/b.total))}),n=e.append("svg:g").selectAll("circle").data(b.nodes()).enter().append("svg:circle").attr("class","agcircle").attr("r",6).call(b.drag),q=e.append("svg:g").selectAll("g").data(b.nodes()).enter().append("svg:g");q.append("svg:text").attr("x",
8).attr("y",".31em").attr("class","shadow").text(function(b){return b.name});q.append("svg:text").attr("x",8).attr("y",".31em").text(function(b){return b.name})}
var sankeyVis=new function(){var b,e,c;this.config={nodeWidth:15,nodePadding:10};this.run=function(){svg=d3.select("#chart").append("svg").attr("width",w).attr("height",h).append("g");b=d3.sankey().nodeWidth(this.config.nodeWidth).nodePadding(this.config.nodePadding).size([w,h]);e=b.link();b.nodes(lattice.concepts).links(lattice.edges).layout(32);c=svg.append("g").selectAll(".sklink").data(lattice.edges).enter().append("path").attr("class","sklink").attr("d",e).style("stroke-width",function(b){return Math.max(1,
b.dy)}).sort(function(b,c){return c.dy-b.dy});c.append("title").text(function(b){return b.source.name+" \u2192 "+b.target.name+"\n"});var g=svg.append("g").selectAll(".sknode").data(lattice.concepts).enter().append("g").attr("class","sknode").attr("transform",function(b){return"translate("+b.x+","+b.y+")"}).on("click",this.nodeClick).on("mouseover",this.nodeMouseOver).on("mouseout",this.nodeMouseOut).call(d3.behavior.drag().origin(function(b){return b}).on("dragstart",function(){this.parentNode.appendChild(this)}).on("drag",
this.dragmove));g.append("rect").attr("height",function(b){return b.dy}).attr("width",b.nodeWidth()).style("fill",function(b){return b.color=color(b.name.replace(/ .*/,""))}).style("stroke",function(b){return d3.rgb(b.color).darker(2)}).append("title").text(function(b){return b.name+"\n"});g.append("text").attr("x",-6).attr("y",function(b){return b.dy/2}).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text(function(b){return b.name}).filter(function(b){return b.x<w/2}).attr("x",
6+b.nodeWidth()).attr("text-anchor","start")};this.dragmove=function(g){d3.select(this).attr("transform","translate("+g.x+","+(g.y=Math.max(0,Math.min(h-g.dy,d3.event.y)))+")");b.relayout();c.attr("d",e)};this.nodeMouseOver=function(b){nodeMouseOver(b);d3.select(this).classed("hover",!0);highlightPath&&visitEdgesDown(b,function(b){d3.select('path.dedge[source_id="'+b.source.id+'"][target_id="'+b.target.id+'"]').classed("highlighted",!0)})};this.nodeMouseOut=function(b){nodeMouseOut(b);d3.select(this).classed("hover",
!1);d3.selectAll("path.dedge.highlighted").classed("highlighted",!1)};this.nodeClick=function(b){nodeClick(b);d3.select(this).classed("selected",function(){if(this.classList.contains("selected"))return numberSelected--,!1;numberSelected++;return!0})}},sunburstVis=new function(){this.config={};var b,e,c,g=d3.svg.arc().startAngle(function(b){return Math.max(0,Math.min(2*Math.PI,q(b.x)))}).endAngle(function(b){return Math.max(0,Math.min(2*Math.PI,q(b.x+b.dx)))}).innerRadius(function(b){return Math.max(0,
r(b.y))}).outerRadius(function(b){return Math.max(0,r(b.y+b.dy))}),n,q,r;this.run=function(){d3.select("#chart").html("");n=Math.min(w,h)/2;q=d3.scale.linear().range([0,2*Math.PI]);r=d3.scale.sqrt().range([0,n]);color=mapColor;vis=d3.select("#chart").append("svg:svg").attr("width",w).attr("height",h).append("svg:g").attr("transform","translate("+w/2+","+h/2+")");b=d3.layout.partition().sort(null).value(function(){return 1});var v=lattice.getTree();vis.data([v]);v=b.nodes(v);e=vis.selectAll("path.sb").data(b.nodes,
function(b){return b.id});e.enter().append("svg:path").attr("class","concept sb").attr("id",function(b,c){return"path-"+c}).attr("d",g).style("fill",getNodeColor).on("mouseover",nodeMouseOver).on("mouseout",nodeMouseOut).on("click",nodeClick).on("dblclick",sunburstVis.sbclick);e.exit().remove();c=vis.selectAll("text").data(v);c.enter().append("svg:text").style("opacity",1).style("fill","#000").attr("text-anchor",function(b){return q(b.x+b.dx/2)>Math.PI?"end":"start"}).attr("dy",".2em").attr("transform",
function(b){var c=1<(get_upper_label(b)||"").split(",").length,e=180*q(b.x+b.dx/2)/Math.PI-90;return"rotate("+(e+(c?-0.5:0))+")translate("+(r(b.y)+5)+","+q(b.x)+")rotate("+(90<e?-180:0)+")"}).on("click",nodeClick).on("dblclick",sunburstVis.sbclick).append("svg:tspan").attr("x",0).text(function(b){return 360*b.dx>MIN_ANGLE_FOR_LABELS?get_upper_label(b):""})};this.sbclick=function(b){e.transition().duration(750).attrTween("d",sunburstVis.arcTween(b));c.style("visibility",function(c){return isParentOf(b,
c)?null:d3.select(this).style("visibility")}).transition().duration(750).attrTween("text-anchor",function(b){return function(){return q(b.x+b.dx/2)>Math.PI?"end":"start"}}).attrTween("transform",function(b){var c=1<(b.name||"").split(" ").length;return function(){var e=180*q(b.x+b.dx/2)/Math.PI-90;return"rotate("+(e+(c?-0.5:0))+")translate("+(r(b.y)+5)+")rotate("+(90<e?-180:0)+")"}}).style("opacity",function(c){return isParentOf(b,c)?1:1E-6}).each("end",function(c){d3.select(this).style("visibility",
isParentOf(b,c)?null:"hidden")})};this.arcTween=function(b){var c=d3.interpolate(q.domain(),[b.x,b.x+b.dx]),e=d3.interpolate(r.domain(),[b.y,1]),B=d3.interpolate(r.range(),[b.y?20:0,n]);return function(b,n){return n?function(){return g(b)}:function(n){q.domain(c(n));r.domain(e(n)).range(B(n));return g(b)}}}};
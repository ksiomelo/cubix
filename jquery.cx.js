var SEPARATOR="-",DEFAULT_WIDTH=570,DEFAULT_HEIGHT=500,MAX_ENTITY_SIZE=2,DEFAULT_NODE_RADIUS=8,NODE_MAX_SIZE=16,NODE_MIN_SIZE=6,SIZE_STABILITY=2,SIZE_SUPPORT=2,SIZE_DEFAULT=1,LABEL_REPETITIVE=1,LABEL_MULTILABEL=2,LABEL_SUPPORT=3,SELECTED_FILL_COLOR="#FF0000",DEFAULT_FILL_COLOR="#aaaaff",DEFAULT_OPACITY=0.3;function getAssociationRules(){$.ajax({url:"/api/v1/",context:document.body}).done(function(){$(this).addClass("done")})}
var association_rules,full_association_rules,color_set=d3.scale.category20(),premiseColor="#3B14AF",conclusionColor="#FFD500";
function get_attribute_list(){var b=[];s=0;for(a in a_rules_concerned_attributes){s++;for(i=0;i<a_rules_concerned_attributes[a].length;i++)t={},t.family=s,"yes"==a_rules_concerned_attributes[a][i][0]?(t.text=a.toString(),b.push(t)):"no"!=a_rules_concerned_attributes[a][i][0]&&(t.text=a.toString()+"-"+a_rules_concerned_attributes[a][i][0],b.push(t))}11>s&&(color_set=d3.scale.category10());return b}
function fetchAssociationRules(b){if("undefined"==typeof lattice.id||null==lattice.id)flashAlert("error","The current concept lattice is not saved in the server - could not compute association rules.");else if("undefined"!=typeof association_rules)b();else{showLoading();var e=$("input[name=csrfmiddlewaretoken]").val();$.getJSON("/api/v1/association_rules/",{lattice_id:lattice.id,csrfmiddlewaretoken:e},function(c){association_rules=c;for(t=0;t<association_rules.length;t++)association_rules[t].id="id"+
t,association_rules[t].highlighted=!0;hideLoading();if("undefined"!=typeof b){for(i=0;i<filter.history.length;i++){filter.history[i].removedRules=[];arrjs=[];for(j=0;j<association_rules.length;j++){flag=!0;for(k=0;k<association_rules[j].premise.length;k++)association_rules[j].premise[k]==filter.history[i].attr+"-"+filter.history[i].value&&(flag=!1);for(k=0;k<association_rules[j].conclusion.length;k++)association_rules[j].conclusion[k]==filter.history[i].attr+"-"+filter.history[i].value&&(flag=!1);
flag&&(filter.history[i].removedRules.push(association_rules[j]),arrjs.push(j))}for(t=0;t<arrjs.length;t++)association_rules.splice(arrjs[t]-t,1)}full_association_rules||(full_association_rules=association_rules);b();createScatterPlotChart();createRulesList()}})}}
function select_rule(b){if(-1!==prevIndex){updated_prev=!1;for(t=0;!updated_prev;t++)rules_list_chart.series[0].data[t].category==prevIndex&&(rules_list_chart.series[0].data[t].update({color:"#4572A7"},!0,!1),updated_prev=!0)}updated_selection=!1;for(t=0;!updated_selection;t++)rules_list_chart.series[0].data[t].category==b&&(rules_list_chart.series[0].data[t].update({color:"#f00"},!0,!1),updated_selection=!0);"radiagram"==currentVis?d3.select("#chart").select("svg").selectAll("path").style("opacity",
function(e){flag=!1;for(i=0;i<e[0].ids.length;i++)if(e[0].ids[i]==b){flag=!0;break}return flag?0.99:0.1}):"matrixview"==currentVis?d3.select("#chart").select("svg").selectAll(".matrix-row").style("opacity",function(e){return e[0].id==b?0.99:0.05}):"gg_ar_plot"==currentVis&&(d3.select("#chart").select("svg").selectAll("line").style("opacity",function(e){return e[3]==b?0.99:0.1}),d3.select("#chart").select("svg").selectAll("polygon").style("opacity",function(e){return e[3]==b?0.99:0.1}),d3.select("#chart").select("svg").selectAll("circle").style("opacity",
function(e){flag=!1;console.log(e);if(e.ids){for(i=0;i<e.ids.length;i++)if(e.ids[i]==b){flag=!0;break}return flag?0.99:0.1}return 1}));prevIndex=b}
function unselect_all(){if(-1!==prevIndex){for(t=0;t<rules_list_chart.series[0].data.length;t++)if(rules_list_chart.series[0].data[t].category==prevIndex){rules_list_chart.series[0].data[t].update({color:"#4572A7"},!0,!1);break}"radiagram"==currentVis?d3.select("#chart").select("svg").selectAll("path").style("opacity",0.99):"matrixview"==currentVis?d3.select("#chart").select("svg").selectAll(".matrix-row").style("opacity",1):"gg_ar_plot"==currentVis&&(d3.select("#chart").select("svg").selectAll("line").style("opacity",
0.99),d3.select("#chart").select("svg").selectAll("polygon").style("opacity",0.99),d3.select("#chart").select("svg").selectAll("circle").style("opacity",1));prevIndex=-1}}
function addGradient(b,e,c,g){b=b.append("linearGradient").attr("id",function(){return"gradient"+e}).attr("spreadMethod","pad").attr("x1",function(){return c?"0%":"100%"}).attr("y1",function(){return g?"0%":"100%"}).attr("x2",function(){return c?"100%":"0%"}).attr("y2",function(){return g?"100%":"0%"});b.append("svg:stop").attr("offset","0%").attr("stop-color",d3.rgb(premiseColor)).attr("stop-opacity",1);b.append("svg:stop").attr("offset","100%").attr("stop-color",d3.rgb(conclusionColor)).attr("stop-opacity",
1)}function objectJoin(b,e){res="";for(i=0;i<b.length;i++)res+=b[i].text+e;return res.substring(0,res.length-1)}
function initARView(){function b(b){d3.select(this).selectAll(".cell").data(b.filter(function(b){return b.z})).enter().append("rect").attr("class","cell").attr("x",function(b){return b.y*(w-e[1]-1)/g}).attr("width",(w-1-e[1])/g).attr("height",Math.max((h-e[0])/association_rules.length,10)).style("fill-opacity",function(b){return b.confidence}).style("fill",function(b){return 1==b.z?d3.rgb(premiseColor):d3.rgb(conclusionColor)}).on("mouseover",Matrix_View_MouseOver).on("mouseout",Matrix_View_MouseOut).on("click",
function(b){console.log(b.id);select_rule(b.id)})}"undefined"==typeof association_rules&&flashAlert("error","The association rules couldn't be fetched from the server");for(var e=[0,20,10,20],c=[],g=0,o=get_attribute_list(),g=o.length,n=0;n<association_rules.length;n++)c[n]=[],c[n]=d3.range(g).map(function(b){return{x:n,y:b,z:0}});for(n=0;n<association_rules.length;n++)for(var q=0;q<g;q++){for(var v=0;v<association_rules[n].premise.length;v++)o[q].text==association_rules[n].premise[v]&&(c[n][q].z=
1,c[n][q].confidence=association_rules[n].confidence,c[n][q].premise_supp=association_rules[n].premise_supp,c[n][q].conclusion_supp=association_rules[n].conclusion_supp,c[n][q].premise=association_rules[n].premise,c[n][q].conclusion=association_rules[n].conclusion,c[n][0].id=association_rules[n].id,c[n][q].id=association_rules[n].id);for(v=0;v<association_rules[n].conclusion.length;v++)o[q].text==association_rules[n].conclusion[v]&&(c[n][q].z=2,c[n][q].confidence=association_rules[n].confidence,c[n][q].premise_supp=
association_rules[n].premise_supp,c[n][q].conclusion_supp=association_rules[n].conclusion_supp,c[n][q].premise=association_rules[n].premise,c[n][q].conclusion=association_rules[n].conclusion,c[n][0].id=association_rules[n].id,c[n][q].id=association_rules[n].id)}for(n=0;n<g;n++)e[0]=Math.max(e[0],o[n].text.length);e[0]*=7;e[1]=20+10*Math.log(association_rules.length)/Math.LN10;vis=d3.select("#chart").append("svg:svg").attr("width",w).attr("height",Math.max(h,10*association_rules.length)).append("svg:g").attr("transform",
"translate("+e[1]+","+e[0]+")");b=vis.selectAll(".matrix-row").data(c).enter().append("g").attr("class","matrix-row").attr("id",function(b){return b[0].id}).attr("transform",function(b){return"translate(0,"+b[0].x*Math.max(10,(h-e[0])/association_rules.length)+")"}).each(b);b.append("line").attr("x2",w).attr("y1",Math.max(10,(h-e[0])/association_rules.length)).attr("y2",Math.max(10,(h-e[0])/association_rules.length)).attr("class","matrix_view_separator").style("fill-opacity",0.99);b.append("line").attr("x2",
w).attr("class","matrix_view_separator").style("fill-opacity",0.99);b.append("text").attr("x",0).attr("dy","1em").attr("text-anchor","end").attr("class","label").text(function(b){return b[0].id});c=vis.selectAll(".column").data(o).enter().append("g").attr("class","column").attr("transform",function(b,c){return b[c]?"translate("+c*(w-e[1]-1)/g+")rotate(-90)":"translate(0)rotate(-90)"});c.append("line").attr("x1",-w).attr("transform",function(b,c){return"translate(0,"+c*(w-e[1]-1)/g+")"}).attr("class",
"matrix_view_separator");c.append("text").attr("class","label").attr("x",0).attr("dy","1em").attr("text-anchor","start").attr("transform",function(b,c){return"translate(0,"+c*(w-e[1]-1)/g+")"}).style("stroke",function(b,c){return color_set(o[c].family-1)}).text(function(b,c){return o[c].text})}
function Matrix_View_MouseOver(b){d3.selectAll(".matrix-row text").classed("highlighted",function(e,c){return c==b.x});d3.selectAll(".column text").classed("highlighted",function(e,c){return c==b.y});d3.select(this).style("stroke","red");A_rules_box.style("opacity",0);A_rules_box.style("display","block");A_rules_box.transition().delay(800).duration(300).style("opacity",1);A_rules_box.style("left",d3.event.pageX+0+"px").style("top",d3.event.pageY-40+"px").style("width","270px").style("height",11+1.7*
Math.max(b.premise.length,b.conclusion.length)+"em");1==b.z?wrapperElementsInList($("ul.hb_role"),["Antecedent"]):wrapperElementsInList($("ul.hb_role"),["Consequent"]);wrapperElementsInList($("ul.hb_confidence"),b.confidence);wrapperElementsInList($("ul.hb_p_support"),b.premise_supp);wrapperElementsInList($("ul.hb_c_support"),b.conclusion_supp);wrapperElementsInList($("ul.hb_premise_list"),b.premise);wrapperElementsInList($("ul.hb_consequence_list"),b.conclusion)}
function Matrix_View_MouseOut(){d3.selectAll("text").classed("highlighted",!1);mouseOverHoverBox||(d3.select(this).style("stroke","none"),A_rules_box.transition().delay(800).duration(200).style("opacity",0),A_rules_box.style("display","none"))}var rx=w/2,ry=h/2,rotate=0;
function initDiagonalARView(){"undefined"==typeof association_rules&&flashAlert("error","The association rules couldn't be fetched from the server");attr_list=get_attribute_list();var b=0,e=0;for(a in context.attributeNames)b++;var b=b+attr_list.length,e=b-attr_list.length,c=[0,120,20,120];for(i=0;i<attr_list.length;i++)c[0]=Math.max(c[0],attr_list[i].text.length);c[0]*=0;vis=d3.select("#chart").append("svg:svg").attr("width",w).attr("height",h).attr("viewBox",-1*(c[0]+0*rx)+" "+-1*(c[0]+0*ry)+" "+
(2*rx+0*c[0])+" "+(2*ry+0*c[0])).append("svg:g").attr("transform","translate("+rx+","+ry+"), scale(1.5)");var c=[],g=0,o=0,n={children:[],x:0,y:0};s_parent={children:[],name:"<Nothing family>"};s_parent.parent=n;s_parent.x=w/4-50;s_parent.y=0;f={};f.family=o;f.parent=s_parent;f.x=w/2-100;f.y=0;f.name="Nothing";s_parent.children.push(f);c.push(f);g++;g++;e++;b++;for(a in context.attributeNames){var q={children:[]};q.name=a.toString();q.parent=n;q.x=(w/4-50)*Math.cos(2*o*Math.PI/e);q.y=(w/4-50)*Math.sin(2*
o*Math.PI/e);o++;for(i=0;i<context.attributeNames[a].length;i++){var v={};"yes"==context.attributeNames[a][i][0]?(v.family=o,v.parent=q,v.x=(w/2-100)*Math.cos(2*g*Math.PI/b),v.y=(w/2-100)*Math.sin(2*g*Math.PI/b),v.name=a.toString(),q.children.push(v),c.push(v),g++):"no"!=context.attributeNames[a][i][0]&&(v.family=o,v.parent=q,v.x=(w/2-100)*Math.cos(2*g*Math.PI/b),v.y=(w/2-100)*Math.sin(2*g*Math.PI/b),v.name=a.toString()+"-"+context.attributeNames[a][i][0],g++,c.push(v),q.children.push(v))}n.children.push(q);
g++}e=[];for(u=0;u<c.length;u++)for(t=0;t<c.length;t++)if(u!==t){ids=[];confidencies=[];for(l=0;l<association_rules.length;l++)if(0==association_rules[l].premise.length&&0==t)ids.push(association_rules[l].id),confidencies.push(association_rules[l].confidence);else{in_conclusion=in_premise=link_in_rule=!1;for(counter=0;counter<association_rules[l].premise.length;counter++)if(association_rules[l].premise[counter]==c[t].name){in_premise=!0;break}for(counter=0;counter<association_rules[l].conclusion.length;counter++)if(association_rules[l].conclusion[counter]==
c[u].name){in_conclusion=!0;break}if(link_in_rule=in_premise&&in_conclusion)ids.push(association_rules[l].id),confidencies.push(association_rules[l].confidence)}0<ids.length&&(source={},source.parent=c[t].parent,source.ids=ids,source.conf=confidencies,source.x=c[t].x,source.y=c[t].y,target={},target.parent=c[u].parent,target.x=c[u].x,target.y=c[u].y,g={},g.source=source,g.target=target,e.push(g))}d3.layout.cluster().size([2*Math.PI,500]);m_splines=d3.layout.bundle()(e);e=d3.select("#chart").select("svg").append("defs");
addGradient(e,"lt-rb",!0,!0);addGradient(e,"lb-rt",!0,!1);addGradient(e,"rt-lb",!1,!0);addGradient(e,"rb-lt",!1,!1);vis.selectAll("path").data(m_splines).enter().append("path").style("stroke-width",function(b){return 2*d3.max(b[0].conf)+1}).style("fill","none").attr("ids",function(b){return b[0].ids}).attr("confs",function(b){return b[0].conf}).attr("d",function(b){pathinfo=[];for(a=0;a<b.length;a++)point={},point.x=b[a].x,point.y=b[a].y,pathinfo.push(point);return d3.svg.line().x(function(b){return b.x}).y(function(b){return b.y}).interpolate("bundle").tension(0.1)(pathinfo)}).style("stroke",
function(b){left_to_right=b[0].x>b[b.length-1].x?!1:!0;top_to_bottom=b[0].y>b[b.length-1].y?!1:!0;return left_to_right&&top_to_bottom?"url(#gradientlt-rb)":!left_to_right&&top_to_bottom?"url(#gradientrt-lb)":left_to_right&&!top_to_bottom?"url(#gradientlb-rt)":"url(#gradientrb-lt)"});circle=vis.selectAll("g.node").data(c).enter().append("svg:line").attr("x1",function(c){return c.x-Math.max(1,(w/2-100)*(Math.PI/(2*b)))}).attr("y1",function(b){return b.y}).attr("x2",function(c){return c.x+Math.max(1,
(w/2-100)*(Math.PI/(2*b)))}).attr("y2",function(b){return b.y}).attr("transform",function(b){return"rotate("+180*Math.atan(-1*b.x/b.y)/Math.PI+" "+b.x+" "+b.y+")"}).style("stroke",function(b){return color_set(b.family-1)});text=vis.selectAll("g.node").data(c).enter().append("svg:text").attr("dx",function(b){return 0<b.x?"1em":"-1em"}).attr("dy","0.31em").style("pointer-events","none").attr("text-anchor",function(b){return 0<b.x?"start":"end"}).text(function(b){return b.name}).style("stroke",function(b){return color_set(b.family-
1)}).attr("transform",function(b){return"translate("+b.x+","+b.y+")rotate("+180*Math.atan(b.y/b.x)/Math.PI+")"})}function cross(b,e){return b[0]*e[1]-b[1]*e[0]}function dot(b,e){return b[0]*e[0]+b[1]*e[1]}function isParentOf(b,e){return b===e?!0:b.children?b.children.some(function(b){return isParentOf(b,e)}):!1}
function init_scatter_plot(b){function e(b){var c=e.extent();association_rules=[];z.selectAll("circle").attr("class",function(e){if(c[0][0]<=e[b.x]&&e[b.x]<=c[1][0]&&c[0][1]<=e[b.y]&&e[b.y]<=c[1][1]){topush=!0;for(i=0;i<association_rules.length;i++)compare_a_rules(association_rules[i],e)&&(topush=!1);topush&&association_rules.push(e);return 1}return"spl"})}b=b||"#chart";get_attribute_list();var c=full_association_rules,g=["confidence","conclusion_supp","premise_supp","lift"],o={},n={};c.forEach(function(b){b.lift=
b.confidence/b.conclusion_supp});var q={traits:g};q.values=c;q.traits.forEach(function(b){var c=function(c){return c[b]},c=[d3.min(q.values,c),d3.max(q.values,c)],e=[8.75,81.25];o[b]=d3.scale.linear().domain(c).range(e);n[b]=d3.scale.linear().domain(c).range(e.slice().reverse())});var v=d3.svg.axis().ticks(5).tickSize(90*g.length),e=d3.svg.brush().on("brushstart",function(b){e.data!==b&&(A.call(e.clear()),e.x(o[b.x]).y(n[b.y]).data=b)}).on("brush",e).on("brushend",function(){e.empty()&&z.selectAll("circle").attr("class",
function(){association_rules=full_association_rules;return 1});document.getElementById("chart").innerHTML="";redrawVis();createRulesList()}),z=d3.select(b).append("svg").attr("width",90*g.length+17.5).attr("align","center").attr("height",90*g.length+17.5);z.append("svg:rect").attr("x",0).attr("y",0).attr("height","100%").attr("width","100%").attr("fill","#FFFFFF");z.selectAll("g.x.axis").data(q.traits).enter().append("g").attr("class","x axis").attr("transform",function(b,c){return"translate("+90*
c+",0)"}).each(function(b){d3.select(this).call(v.scale(o[b]).orient("bottom"))});z.selectAll("g.y.axis").data(q.traits).enter().append("g").attr("class","y axis").attr("transform",function(b,c){return"translate(0,"+90*c+")"}).each(function(b){d3.select(this).call(v.scale(n[b]).orient("right"))});var A=z.selectAll("g.cell").data(function(b,c){var e=[],g=b.length,n=c.length,o,q;for(o=-1;++o<g;)for(q=-1;++q<n;)e.push({x:b[o],i:o,y:c[q],j:q});return e}(q.traits,q.traits)).enter().append("g").attr("class",
"cell").attr("transform",function(b){return"translate("+90*b.i+","+90*b.j+")"}).each(function(b){var c=d3.select(this);c.append("rect").attr("class","frame").attr("x",8.75).attr("y",8.75).attr("width",72.5).attr("height",72.5);c.selectAll("circle").data(q.values).enter().append("circle").attr("class",function(){return 1}).attr("cx",function(c){return o[b.x](c[b.x])}).attr("cy",function(c){return n[b.y](c[b.y])}).attr("r",function(){return 3}).on("mouseover",Matrix_View_MouseOver).on("mouseout",Matrix_View_MouseOut);
c.call(e.x(o[b.x]).y(n[b.y]))});A.filter(function(b){return b.i==b.j}).append("text").attr("x",17.5).attr("y",17.5).attr("dy",".71em").text(function(b){return b.x})}
function init_gg_plot(){for(var b=0,e=get_attribute_list(),c=clone(association_rules),b=c.length,g=0;g<c.length;g++){for(j=0;j<c[g].premise.length;j++)for(k=0;k<e.length;k++)c[g].premise[j]==e[k].text&&(res={},res.family=e[k].family,res.text=e[k].text,c[g].premise[j]=res);for(j=0;j<c[g].conclusion.length;j++)for(k=0;k<e.length;k++)c[g].conclusion[j]==e[k].text&&(res={},res.family=e[k].family,res.text=e[k].text,c[g].conclusion[j]=res)}e=[];common_parent={children:[]};for(var g=0;g<b;g++){t_link=[-1,
-1];p_parent={occurencies:1};p_parent.parent=common_parent;p_parent.ids=[];p_parent.ids.push(c[g].id);p_parent.text=objectJoin(c[g].premise,"&");p_parent.children=c[g].premise;p_parent.children=p_parent.children.map(function(b){res={};res=b;res.occurencies=1;res.parent=p_parent;res.ids=p_parent.ids;return res});c_parent={occurencies:1};c_parent.parent=common_parent;c_parent.ids=[];c_parent.ids.push(c[g].id);c_parent.text=objectJoin(c[g].conclusion,"&");c_parent.children=c[g].conclusion;c_parent.children=
c_parent.children.map(function(b){res={};res=b;res.occurencies=1;res.parent=p_parent;res.ids=c_parent.ids;return res});for(j=0;j<common_parent.children.length;j++)if(objectJoin(c[g].premise,"&")==common_parent.children[j].text&&(t_link[0]=j,common_parent.children[j].occurencies++,common_parent.children[j].ids.push(c[g].id),p_parent.occurencies++,common_parent.children[j].children=common_parent.children[j].children.map(function(b){b.occurencies=common_parent.children[j].occurencies/common_parent.children[j].children.length;
b.ids=common_parent.children[j].ids;return b})),objectJoin(c[g].conclusion,"&")==common_parent.children[j].text)t_link[1]=j,common_parent.children[j].occurencies++,common_parent.children[j].ids.push(c[g].id),c_parent.occurencies++,common_parent.children[j].children=common_parent.children[j].children.map(function(b){b.occurencies=common_parent.children[j].occurencies/common_parent.children[j].children.length;b.ids=common_parent.children[j].ids;return b});1==p_parent.occurencies&&(t_link[0]=common_parent.children.length,
common_parent.children.push(p_parent));1==c_parent.occurencies&&(t_link[1]=common_parent.children.length,common_parent.children.push(c_parent));t_link[2]=c[g].confidence;t_link[3]=c[g].id;e.push(t_link)}console.log(common_parent);var o=d3.scale.linear().range([0,w]),n=d3.scale.linear().range([0,h]),q=d3.select("#chart").append("svg").attr("width",w).attr("height",h),b=d3.layout.pack().size([w,h]).value(function(b){return 100*b.occurencies}),v=common_parent.children,b=b.nodes(common_parent),z,A;A=
z=common_parent;q.selectAll("circle").data(b).enter().append("svg:circle").attr("class",function(b){return b.children?"parent":"child"}).attr("ids",function(b){return b.ids}).style("fill",function(b){if(b.family)return color_set(b.family-1)}).attr("cx",function(b){return b.x}).attr("cy",function(b){return b.y}).attr("r",function(b){return b.r}).on("click",function(b){var b=z==b?A:b,c=common_parent.r/b.r;w>h?(o.domain([b.x-Math.abs(h-w)/(2*c)-b.r,b.x+Math.abs(h-w)/(2*c)+b.r]),n.domain([b.y-b.r,b.y+
b.r])):(o.domain([b.x-b.r,b.x+b.r]),n.domain([b.y-Math.abs(h-w)/(2*c)-b.r,b.y+Math.abs(h-w)/(2*c)+b.r]));var e=q.transition().duration(d3.event.altKey?7500:750);e.selectAll("circle").attr("cx",function(b){return o(b.x)}).attr("cy",function(b){return n(b.y)}).attr("r",function(b){return c*b.r});e.selectAll("line").attr("x1",function(b){return o(v[b[0]].x)}).attr("y1",function(b){return n(v[b[0]].y)}).attr("x2",function(b){return o(v[b[1]].x)}).attr("y2",function(b){return n(v[b[1]].y)});e.selectAll("polygon").attr("transform",
function(b){return"translate("+o(0.5*(v[b[0]].x+v[b[1]].x))+","+n(0.5*(v[b[0]].y+v[b[1]].y))+"), rotate("+180*(1/Math.PI)*Math.atan((v[b[1]].y-v[b[0]].y)/(v[b[1]].x-v[b[0]].x))+")"});e.selectAll("text").attr("x",function(b){return o(b.x)}).attr("y",function(b){return n(b.y)}).style("opacity",function(b){return c*b.r>30?1:0});z=b});e=unique_set(e);q.selectAll("line").data(e).enter().append("svg:line").style("stroke-width",function(b){return 2*b[2]+1}).attr("id",function(b){return b[3]}).attr("x1",
function(b){return v[b[0]].x}).attr("y1",function(b){return v[b[0]].y}).attr("x2",function(b){return v[b[1]].x}).attr("y2",function(b){return v[b[1]].y}).style("stroke",d3.interpolateRgb(premiseColor,conclusionColor)(0.5));q.selectAll("polygon").data(e).enter().append("svg:polygon").attr("id",function(b){return b[3]}).attr("points",function(b){return-5*(b[2]+1)+","+3*(b[2]+1)+" "+-5*(b[2]+1)+","+-3*(b[2]+1)+" "+3*(b[2]+1)+",0"}).style("fill",d3.interpolateRgb(premiseColor,conclusionColor)(0.5)).attr("transform",
function(b){return"translate("+0.5*(v[b[0]].x+v[b[1]].x)+","+0.5*(v[b[0]].y+v[b[1]].y)+"), rotate("+180*(1/Math.PI)*Math.atan((v[b[1]].y-v[b[0]].y)/(v[b[1]].x-v[b[0]].x))+")"});q.selectAll("text").data(b).enter().append("svg:text").style("pointer-events","none").attr("x",function(b){return b.x}).attr("y",function(b){return b.y}).attr("dy",".35em").attr("text-anchor","middle").style("opacity",function(b){return 30<b.r?1:0}).text(function(b){return 2==b.depth?b.text:""})}
function flashAlert(b,e){"error"==b?($("div.alert-error > span").text(e),$("div.alert-error").show()):($("div.alert-block > span").text(e),$("div.alert-block").show())}function showLoading(){$("div.alert").hide();$("div.alert-block > span").text("Loading...");$("div.alert-block").show()}function hideLoading(){$("div.alert").hide()}$(function(){$(".dismiss-alert").click(function(){$("div.alert").fadeOut("fast")});$(".dropdown-toggle").dropdown()});
var colorAttr="colorAttr",selAttrs=["attr1","attr2","attr3","attr4"],dattrvalues=["val1","val2","val3"],cxt=["age-<30",""];function prepareData(){for(var b={},e=0;e<context.length;e++)for(var c=0;c<selAttrs.length;c++)context.whatValueForThisAttribute(e,selAttrs[c]);b[colorAttr]=context.getAttrValues(colorAttr);return b}function getImmediateAndRemainingNodes(b){for(var e=[],c=[],g=[],o=getChildrenData(b),n=0;n<o.length;n++)o[n].depth==b.depth+1?c.push(o[n]):g.push(o[n]);e.push(c,g);return e}
function getMatrixData(b,e){for(var c=[],g=0;g<b.length+1;g++){for(var o=[],n=0;n<e.length+1;n++){if(0==g){var q={};q.label=n<e.length?e[n]:null}else q={},q.label=n==e.length?b[g-1]:null;q.i=g;q.j=n;q.id=g+","+n;o.push(q)}c.push(o)}return c}function getMatrixDataFlat(b,e){for(var c=[],g=0;g<b.length+1;g++)for(var o=0;o<e.length+1;o++){if(0==g){var n={};n.label=o<e.length?e[o]:null}else n={},n.label=o==e.length?b[g-1]:null;n.i=g;n.j=o;n.id=g+","+o;c.push(n)}return c}
function layeredMatrix(){for(var b=getTopMostConcepts(data.nodes),e=[],c=0;c<b.length;c++){var g=getImmediateAndRemainingNodes(b[c]);ArrayAddAll(g[0],e)}b=getMatrixDataFlat(e,b);matrixNode=d3.select("#compare-chart").append("svg:svg").attr("class","quilts").attr("width",60).attr("height",120).selectAll("rect.porra").data(b);matrixNode.enter().append("svg:rect").attr("class","porra").attr("transform",translateXY2).attr("width",30).attr("height",30);matrixNode.exit()}
function translateY(b,e){return"translate(0,"+e*sz+")"}function translateX(b,e){return"translate("+e*sz+",0)"}function translateXY2(b){return"translate("+b.i*sz+","+b.j*sz+")"}function plotCompare(){layeredMatrix()}
function drawSplom(){function b(c){var e=b.extent();n.selectAll("circle").attr("class",function(b){return e[0][0]<=b[c.x]&&b[c.x]<=e[1][0]&&e[0][1]<=b[c.y]&&b[c.y]<=e[1][1]?b.employment:null})}flower=eg;var e=flower.traits.length,c={},g={};flower.traits.forEach(function(b){var e=flower[b],o=[9.75,140.25];c[b]=d3.scale.ordinal().domain(e).range(o);g[b]=d3.scale.ordinal().domain(e).range(o.reverse())});var o=d3.svg.axis().ticks(5).tickSize(150*e),b=d3.svg.brush().on("brushstart",function(e){b.data!==
e&&(q.call(b.clear()),b.x(c[e.x]).y(g[e.y]).data=e)}).on("brush",b).on("brushend",function(){b.empty()&&n.selectAll("circle").attr("class",function(b){return b.employment})}),n=d3.select("#compare-chart").append("svg:svg").attr("width",150*e+19.5).attr("height",150*e+19.5);n.selectAll("g.x.axis").data(flower.traits).enter().append("svg:g").attr("class","x axis").attr("transform",function(b,c){return"translate("+150*c+",0)"}).each(function(b){d3.select(this).call(o.scale(c[b]).orient("bottom"))});
n.selectAll("g.y.axis").data(flower.traits).enter().append("svg:g").attr("class","y axis").attr("transform",function(b,c){return"translate(0,"+150*c+")"}).each(function(b){d3.select(this).call(o.scale(g[b]).orient("right"))});var q=n.selectAll("g.splcell").data(function(b,c){var e=[],g=b.length,o=c.length,n,q;for(n=-1;++n<g;)for(q=-1;++q<o;)e.push({x:b[n],i:n,y:c[q],j:q});return e}(flower.traits,flower.traits)).enter().append("svg:g").attr("class","splcell").attr("transform",function(b){return"translate("+
150*b.i+","+150*b.j+")"}).each(function(e){var o=d3.select(this);o.append("svg:rect").attr("class","frame").attr("x",9.75).attr("y",9.75).attr("width",130.5).attr("height",130.5);o.selectAll("circle.spl").data(flower.values).enter().append("svg:circle").attr("class",function(b){return"spl "+b.employment}).attr("cx",function(b){return c[e.x](b[e.x])}).attr("cy",function(b){return g[e.y](b[e.y])}).attr("r",3);o.call(b.x(c[e.x]).y(g[e.y]))});q.filter(function(b){return b.i==b.j}).append("svg:text").attr("x",
19.5).attr("y",19.5).attr("dy",".71em").text(function(b){return b.x})}
function Context(b,e,c,g){this.initialAttributeNames=HashClone(g);this.initialObjects=b.slice(0);this.attributeNames=g;this.attributes=e;this.objects=b;this.rel=c;this.getEntitiesCount=function(){return this.objects.length};this.whatValueForThisAttribute=function(b,c){for(var e=0;e<rel[b].length;e++){var g=rel[b][e];if(g.split(SEPARATOR)[0]==c)return g.substring(g.indexOf(SEPARATOR)+1,g.length)}return null};this.getAttrValues=function(b){for(var c=[],b=attributes[b],e=0;e<b.length;e+=2)c.push(b[e]);
return c};this.intersection=function(b,c){var e=this.getObjectsHavingOrNot(b),g=this.getObjectsHavingOrNot(c);return ArrayIntersect(e,g)};this.booleanPositive=function(b,c){if(b==c||b+"-yes"==c)return!0;var e=c.split("-");return 0<e.length&&e[0]!=b&&"no"==e[1]?!0:!1};this.getObjectsHavingOrNot=function(b){var c=[],e=b.split("-"),g=e.length-1,z=0<=g&&"no"==e[g];if(0<e.length&&("no"==e[g]||"yes"==e[g]))for(var b="",A=0;A<g;A++)b+=e[A];b=this.attributes.indexOf(b);for(e=0;e<this.objects.length;e++)g=
this.objects[e],z?this.rel[e][b]||c.push(g):this.rel[e][b]&&c.push(g);return c};this.getObjectIndex=function(b){for(var c=0;c<this.objects.length;c++)if(this.objects[c]==b)return c;return-1};this.getSubcontextForExtent=function(b){for(var c=[],e=[],g=[],z=0;z<b.length;z++){c.push(b[z]);g[z]=[];for(var A=this.getObjectIndex(b[z]),B=0;B<this.rel[A].length;B++)if(this.rel[A][B]){var C=e.indexOf(this.attributes[B]);0>C&&e.push(this.attributes[B]);C=e.indexOf(this.attributes[B]);g[z][C]=!0}}return new Context(c,
e,g,e)}}
function eliminateEntities(){for(var b=[],e=[],c=[],g=0;g<context.objects.length;){for(var o=!1,n=0;n<lattice.concepts.length&&!o;n++)o=0<=lattice.concepts[n].extent.indexOf(context.objects[g]);o?g++:(e.push(context.objects[g]),context.objects.splice(g,1))}for(var q=getAttributeValuesPairs(),g=0;g<q.length;g++){o=!1;for(n=0;n<lattice.concepts.length&&!o;n++)o=0<=lattice.concepts[n].intent.indexOf(q[g].name);if(!o){var o=q[g].attrName,n=q[g].valueName,v={};v.name=q[g].name;v.booleanAttr=q[g].booleanAttr;v.attrName=
o;v.value=n?context.attributeNames[o][getValueIdxfromAttr(o,n)]:context.attributeNames[o];c.push(v);q[g].booleanAttr?delete context.attributeNames[o]:o in context.attributeNames&&(1==context.attributeNames[o].length?delete context.attributeNames[o]:removeValuefromAttr(o,n))}}b.push(e);b.push(c);updateEntityList();return b}function removeValuefromAttr(b,e){var c=getValueIdxfromAttr(b,e);0<=c&&context.attributeNames[b].splice(c,1)}
function getValueIdxfromAttr(b,e){for(var c=context.attributeNames[b],g=0;g<c.length;g++)if(c[g][0]==e)return g;return-1}function addEntities(b,e){ArrayAddAll(b,context.objects);for(var c=0;c<e.length;c++)e[c].attrName in context.attributeNames?0>context.attributeNames[e[c].attrName].indexOf(e[c].value)&&context.attributeNames[e[c].attrName].push(e[c].value):context.attributeNames[e[c].attrName]=e[c].booleanAttr?e[c].value:[e[c].value];updateEntityList()}Highcharts.theme={colors:["#4572A7"]};
var highchartsOptions=Highcharts.getOptions(),prevIndex=-1;function removeWatermarks(){$('text[text-anchor="end"]').remove()}function loadDashboard(){multiSelectOptionsForAttributes("#control_1");multiSelectOptionsForAttributes("#control_2");$("#control_1, #control_2").multiSelect();updateDistributionChart(lattice.topConcept)}
function multiSelectOptionsForAttributes(b){var e=$(b);e.empty();e.append($("<option></option>"));$.each(context.attributeNames,function(b,g){var o=$("<optgroup label='"+b+"'></optgroup>");e.append(o);for(var n=0;n<g.length;n++)$("<option label='"+g[n][0]+"' value='"+b+SEPARATOR+g[n][0]+"'>"+g[n][0]+"</option>").appendTo(o)})}var chart;
function createHorizontalBarChart(b,e,c){chart=new Highcharts.Chart({chart:{renderTo:b,defaultSeriesType:"bar"},title:{text:"Attribute Co-occurrence"},subtitle:{text:""},xAxis:{categories:e,title:{text:null}},yAxis:{min:0,title:{text:"Objects",align:"high"}},tooltip:{formatter:function(){return""+this.series.name+": "+this.y+" objects"}},plotOptions:{bar:{dataLabels:{enabled:!0}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",floating:!0,borderWidth:1,backgroundColor:Highcharts.theme.legendBackgroundColor||
"#FFFFFF",shadow:!0},credits:{enabled:!1},series:getStackedBarSeries(e,c)})}function getStackedBarSeries(b,e){for(var c=[],g=0;g<e.length;g++){var o={};o.name=e[g];o.data=[];for(var n=0;n<b.length;n++){var q=context.intersection(b[n],e[g]);o.data.push(q.length)}c.push(o)}return c}var distributionChart;
function createVerticalBarChart(b,e,c,g){distributionChart=new Highcharts.Chart({chart:{renderTo:b,type:"column",margin:[50,50,100,80]},title:{text:e},xAxis:{categories:c,labels:{rotation:-45,align:"right",style:{font:"normal 13px Verdana, sans-serif"}}},yAxis:{min:0,title:{text:"Objects"}},legend:{enabled:!1},tooltip:{formatter:function(){return"<b>"+this.x+" : "+this.y+" objects</b><br/>"}},series:[{name:"Attributes",data:g,dataLabels:{enabled:!0,rotation:-90,color:"#FFFFFF",align:"right",x:-3,
y:10,formatter:function(){return this.y},style:{font:"normal 13px Verdana, sans-serif"}}}]})}function createDistributionChart(){createVerticalBarChart("distribution-chart","Distribution",[],[])}function updateDistributionChart(b){for(var e=[],b=context.getSubcontextForExtent(b.extent),c=0;c<b.attributes.length;c++){for(var g=0,o=0;o<b.objects.length;o++)!0==b.rel[o][c]&&g++;e.push(g)}distributionChart.series[0].setData(e);distributionChart.xAxis[0].setCategories(b.attributeNames)}
function createScatterPlotChart(){distributionChart=new Highcharts.Chart({chart:{renderTo:"sc_pl_div",type:"area",margin:[50,50,100,80]},title:{text:"Association Rules Distribution"}});distributionChart.container.innerHTML="";init_scatter_plot(distributionChart.container)}
function createRulesList(){a1=[];a2=[];for(i=0;i<association_rules.length;i++)a1.push(association_rules[i].id),a2.push(association_rules[i].confidence);chart=new Highcharts.Chart({chart:{renderTo:"rules_render_area",type:"bar",events:{click:function(){if(-1!==prevIndex){for(t=0;t<this.series[0].data.length;t++)if(this.series[0].data[t].category==prevIndex){this.series[0].data[t].update({color:"#4572A7"},!0,!1);break}d3.select("#chart").select("svg").selectAll("path").style("opacity",0.99);prevIndex=
-1}}}},title:{text:"Generated rules"},legend:{enabled:null},xAxis:{categories:a1,title:{text:null}},yAxis:{min:0,title:{text:null,align:"high"},labels:{overflow:"justify"}},tooltip:{formatter:function(){return""+this.series.name+": "+this.y}},plotOptions:{bar:{dataLabels:{enabled:!0},events:{click:function(b){if(-1!==prevIndex)for(t=0;t<this.data.length;t++)if(this.data[t].category==prevIndex){this.data[t].update({color:"#4572A7"},!0,!1);break}b.point.update({color:"#f00"},!0,!1);d3.select("#chart").select("svg").selectAll("path").style("opacity",
function(e){return e[4].id==b.point.category?0.99:0.1});prevIndex=b.point.category}}}},series:[{name:"Confidence",data:a2}]})}function updateDashboard(){}function createFacets(){var b=vis.select('circle[id="'+data.top_id+'"]');if(0==b.attr("intent").length)var e=getOutgoingNodes(b);$("#treepa").dynatree({title:"Sample Theming",onActivate:function(b){openFacet(b)}});for(var b=$("#treepa").dynatree("getRoot"),c=0;c<e.length;c++)b.addChild({title:e[c].attr("intent")})}
function searchFacet(b,e){removeWhiteSpaces(b);var c=[],g=[],o=[],n=b.split(",");vis.selectAll("circle").each(function(){var b=d3.select(this),c=b.attr("intent").split(",");e&&0==b.attr("extent").length?o.push(b):ArrayContainsAll(c,n)?g.push(b):o.push(b)});c.push(g);c.push(o);return c}
function openFacet(b){var e="";b.visitParents(function(b){null!=b.data.title&&(e+=b.data.title+",")},!0);for(var c=searchFacet(e,!0)[0],g=0;g<c.length;g++){var o=c[g].attr("intent").split(","),n=e.split(","),o=ArraySubtract(o,n);0<o.length&&b.addChild({title:o.join(", ")})}b.expand(!0)}
var visualFilters=[],filter=new function(){this.history=[];this.addFilter=function(b,e,c,g){var o=eliminateEntities();updateVisualFilters();var n={};n.filterType=b;n.attr=e;n.value=c;n.excludedNodes=g;n.remObjs=o[0];if(void 0!==association_rules){association_rules=full_association_rules;n.removedRules=[];arrjs=[];for(j=0;j<association_rules.length;j++){flag=!0;for(k=0;k<association_rules[j].premise.length;k++)association_rules[j].premise[k]==n.attr+"-"+n.value&&(flag=!1);for(k=0;k<association_rules[j].conclusion.length;k++)association_rules[j].conclusion[k]==
n.attr+"-"+n.value&&(flag=!1);flag&&(n.removedRules.push(association_rules[j]),arrjs.push(j))}for(t=0;t<arrjs.length;t++)association_rules.splice(arrjs[t]-t,1);full_association_rules=association_rules;createScatterPlotChart()}n.remAttrsVals=o[1];this.history.push(n)};this.removeFilter=function(b,e){var c=this.indexOfFilter(b,e);removeFilterAt(c)};this.removeFilterAt=function(b){if(this.history[b].removedRules){if(b!==this.history.length-1)for(j=0;j<this.history[b].removedRules.length;j++){console.log("going through rule",
j);attributed=!1;for(i=b+1;i<this.history.length&&!attributed;i++){console.log("going through filter",i);console.log(this.history[b].removedRules[j].premise,this.history[b].removedRules[j].conclusion);for(k=0;k<this.history[b].removedRules[j].premise.length;k++)if(this.history[b].removedRules[j].premise[k]==this.history[i].attr+"-"+this.history[i].value){association_rules.push(this.history[b].removedRules[j]);attributed=!0;break}if(!attributed)for(k=0;k<this.history[b].removedRules[j].conclusion.length;k++)if(this.history[b].removedRules[j].conclusion[k]==
this.history[i].attr+"-"+this.history[i].value){association_rules.push(this.history[b].removedRules[j]);attributed=!0;break}attributed||this.history[i].removedRules.push(this.history[b].removedRules[j])}}else association_rules=association_rules.concat(this.history[b].removedRules);full_association_rules=association_rules;createScatterPlotChart()}addEntities(this.history[b].remObjs,this.history[b].remAttrsVals);updateVisualFilters();ArrayRemove(this.history,b)};this.indexOfAttr=function(b){for(var e=
0;e<this.history.length;e++)if(this.history[e].attr==b)return e;return-1};this.indexOfFilter=function(b,e){for(var c=0;c<this.history.length;c++)if(this.history[c].attr==b&&this.history[c].value==e)return c;return-1};this.indexOfFilter=function(b){for(var e=0;e<this.history.length;e++)if(this.history[e].attr==b)return e;return-1};this.getFilter=function(b,e){var c=this.indexOfFilter(b,e);return 0>c?null:this.history[c]};this.clear=function(){this.history.length=0}};
function removeFilter(b,e){var c;c=e?filter.indexOfFilter(b,e):filter.indexOfFilter(b);var g=filter.history[c].excludedNodes;filter.removeFilterAt(c);for(c=0;c<filter.history.length&&0<g.length;c++)g=ArraySubtract(g,filter.history[c].excludedNodes);for(c=0;c<g.length;c++)0>lattice.concepts.indexOf(g[c])&&lattice.concepts.push(g[c]);keepLinks();e?$("#"+b+"-"+e).remove():$("#"+b).remove();labelize2();updateVis()}
function resetFilters(){$("#showFiltersPanel").html("<span>Filters &raquo;</span>");if(association_rules)for(b=0;b<filter.history.length;b++)association_rules=association_rules.concat(filter.history[b].removedRules);full_association_rules=association_rules;filter.clear();for(var b=0;b<visualFilters.length;b++)visualFilters[b].series[0].redraw();lattice.concepts=lattice.initialConcepts.slice(0);lattice.edges=lattice.initialEdges.slice(0);context.attributeNames=HashClone(context.initialAttributeNames);
context.objects=context.initialObjects.slice(0);updateEntityList();updateVisualFilters();updateVis();createScatterPlotChart()}function keepLinks(){lattice.edges=lattice.initialEdges.filter(function(b){return 0<=lattice.concepts.indexOf(b.source)&&0<=lattice.concepts.indexOf(b.target)})}
function clickFilterValue(){var b=this.name,e=this.series.name;if(this.sliced){for(var c=[],g=0;g<lattice.initialConcepts.length;g++){var o=lattice.initialConcepts[g];if(0==o.extent.length)c.push(o);else{var n=e;"yes"!=b&&"no"!=b&&(n+=SEPARATOR+b);0>o.intent.indexOf(n)?"no"!=b&&c.push(o):"no"==b&&c.push(o)}}lattice.concepts=ArraySubtract(lattice.concepts,c);keepLinks();filter.addFilter("attribute",e,b,c);$("#"+e+"-"+b).remove();$('<span id="'+e+"-"+b+'"> | '+e+": "+b+' <a href="#" class="remove-filter"><img src="'+
STATIC_URL+'/images/remove.gif"></a></span>').appendTo("#showFiltersPanel");labelize2();updateVis()}else removeFilter(e,b)}function loadFilters(){for(var b=getKeys(context.attributeNames),e=0;e<b.length;e++){var c=[{animation:!0,type:"pie",name:b[e],data:context.attributeNames[b[e]]}];$('<div class="chartFilter"><span> '+b[e]+' </span><div id="chart_'+e+'" >').appendTo("#filters_container");visualFilters.push(createChart(b[e],"chart_"+e,c))}}
function createChart(b,e,c){return new Highcharts.Chart({chart:{renderTo:e,backgroundColor:"rgba(50,50,50,0)",plotBorderWidth:null,plotShadow:!1},title:{text:""},tooltip:{formatter:function(){return"<b>"+this.point.name.escapeHTML()+"</b>: "+Math.round(this.percentage)+" %"}},legend:{itemWidth:80,style:{width:"100px"},layout:"vertical",backgroundColor:"#666",align:"right",verticalAlign:"middle",itemStyle:{color:"#fff"}},plotOptions:{pie:{allowPointSelect:!0,innerSize:"40%",point:{events:{select:clickFilterValue,
unselect:clickFilterValue}},cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0}},series:c})}function updateVisualFilters(){for(var b=0;b<visualFilters.length;b++){var e=visualFilters[b].series[0];e.name in context.attributeNames?(document.getElementById("chart_"+b).style.opacity=1,e.setData(context.attributeNames[e.name],!0)):document.getElementById("chart_"+b).style.opacity=0}}var selFilterCt=0;
function filterSelected(){var b=[];vis.selectAll("circle.selected").each(function(c){b.push(c)});var e=ArraySubtract(lattice.concepts,b);lattice.concepts=b;keepLinks();var c="selection_"+selFilterCt;filter.addFilter("selection",c,"filter",e);$('<span id="'+c+'"> | selection <a href="#" class="remove-filter"><img src="'+STATIC_URL+'/images/remove.gif"></a></span>').appendTo("#showFiltersPanel");selFilterCt++;labelizeData();updateVis()}var attrFilterCt=0;
function filterAttributes(){var b=[];$("input[name='attr']:checked").each(function(){b.push($(this).val())});for(var e=[],c=0;c<lattice.concepts.length;c++)0==lattice.concepts[c].extent.length?e.push(lattice.concepts[c]):ArrayContainsAll(lattice.concepts[c].intent,b)||e.push(lattice.concepts[c]);lattice.concepts=ArraySubtract(lattice.concepts,e);keepLinks();c="attribute_"+attrFilterCt;filter.addFilter("attribute_sel",c,"filter",e);$('<span id="'+c+'" class="explain" data-tooltip="'+b.join(", ")+'"> | attributes sel. <a href="#" class="remove-filter"><img src="'+
STATIC_URL+'/images/remove.gif"></a></span>').appendTo("#showFiltersPanel");attrFilterCt++;labelize2();updateVis()}var objFilterCt=0;
function filterObjects(){var b=[];$("input[name='obj']:checked").each(function(){b.push($(this).val())});for(var e=[],c=0;c<lattice.concepts.length;c++)0==lattice.concepts[c].intent.length?e.push(lattice.concepts[c]):ArrayContainsAll(lattice.concepts[c].extent,b)||e.push(lattice.concepts[c]);lattice.concepts=ArraySubtract(lattice.concepts,e);keepLinks();c="object_"+objFilterCt;filter.addFilter("object_sel",c,"filter",e);$('<span id="'+c+'" class="explain" data-tooltip="'+b.join(", ")+'"> | objects sel. <a href="#" class="remove-filter"><img src="'+
STATIC_URL+'/images/remove.gif"></a></span>').appendTo("#showFiltersPanel");objFilterCt++;labelize2();updateVis()}var numberSelected=0,context,lattice,a_rules_concerned_attributes,_data_a_rules_concerned_attributes;
function loadData(b){context=new Context(b.context.objects,b.context.attributes,b.context.rel,b.attributes);lattice=new Lattice(b);a_rules_concerned_attributes=clone(b.attributes);_data_a_rules_concerned_attributes=clone(b.attributes);$("input.search").tokenInput(getAttributeValuesPairs(),{propertyToSearch:"name",preventDuplicates:!1,hintText:"Type an attribute name",theme:"facebook",onAdd:selectionAdded,onDelete:selectionAdded});hoverbox=d3.select("#hoverbox");A_rules_box=d3.select("#A_rules_box");
checkLatticeConstraints();labelizeData();initLattice();updateEntityList();loadFilters();loadDashboard();$("a.lattice-json-link").attr("href","/api/v1/lattice/?id="+lattice_id);$("a.ar-json-link").attr("href","/api/v1/association_rules/?lattice_id="+lattice_id);$('text[text-anchor="end"]').remove()}
function Lattice(b){this.initialConcepts=b.nodes.slice(0);this.initialEdges=b.links.slice(0);this.concepts=b.nodes;this.edges=b.links;this.id=b.id;this.getConcept=function(b){for(var c=0;c<this.concepts.length;c++)if(this.concepts[c].id==b)return this.concepts[c]};this.topConcept=this.getConcept(b.top_id);this.bottomConcept=this.getConcept(b.bottom_id);this.isEmpty=function(){return!1};this.conceptsCount=function(){return concepts.length};this.getPredecessors=function(b){for(var c=[],g=0;g<b.children_ids.length;g++)c.push(this.concepts[b.children_ids[g]]);
return c};this.getSucessors=function(b){for(var c=[],g=0;g<b.parents_ids.length;g++)c.push(this.concepts[b.parents_ids[g]]);return c};this.getSuccessorsEdges=function(b){for(var c=[],g=0;g<this.edges.length;g++)this.edges[g].source.id==b.id&&c.push(this.edges[g]);return c};this.getPredecessorsEdges=function(b){for(var c=[],g=0;g<this.edges.length;g++)this.edges[g].target.id==b.id&&c.push(this.edges[g]);return c};this.getHeight=function(){return this.bottomConcept.depth+1};this.getEdgeLength=function(b){return lattice.getHeight()-
b.target.depth-(lattice.getHeight()-b.source.depth)};this.doTopSort=function(b){for(var c=[this.conceptsCount()],g=c.length;0<=--g;)c[g]=this.getPredecessors(this.nodes[g]).length;for(var o=this.topConcept,n=this.concepts.indexOf(o);o!=this.bottomConcept;){succ=this.getSuccessorsEdges(o);b[this.concepts.indexOf(o)]=o.depth;for(g=0;g<succ.length;g++)tmp2=this.concepts(succ[g].target),0==--c[this.concepts.indexOf(tmp2)]&&(c[n]=this.concepts.indexOf(tmp2),n=this.concepts.indexOf(tmp2));o=this.concepts[c[this.concepts.indexOf(o)]]}b[this.concepts.indexOf(this.bottomConcept)]=
this.bottomConcept.depth}}function initLattice(){w=DEFAULT_WIDTH;h=DEFAULT_HEIGHT;force=d3.layout.force().gravity(0.1).distance(100).charge(-320).on("tick",tick).size([w,h]);vis=d3.select("#chart").append("svg:svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+w+" "+h).attr("preserveAspectRatio","xMidYMid");updateLattice()}
function updateLattice(){var b=lattice.concepts,e=lattice.edges;force.nodes(b).links(e).start();clink=vis.selectAll("line.link").data(e);clink.enter().insert("svg:line",".node").attr("class","link").attr("x1",function(b){return b.source.x}).attr("y1",function(b){return b.source.y}).attr("x2",function(b){return b.target.x}).attr("y2",function(b){return b.target.y}).attr("source_id",function(b){return b.source.id}).attr("target_id",function(b){return b.target.id});clink.exit().remove();cnode=vis.selectAll("circle.node").data(b,
function(b){return b.id});cnode.enter().append("svg:circle").attr("class","node").attr("cx",function(b){return b.x}).attr("cy",function(b){return b.y}).attr("r",getNodeSize).attr("intent",function(b){return b.intent}).attr("extent",function(b){return b.extent}).attr("id",function(b){return b.id}).attr("children",function(b){return b.children}).on("click",nodeClick).on("mouseover",nodeMouseOver).on("mouseout",nodeMouseOut).call(force.drag);cnode.exit().remove();ulabel=vis.selectAll("text.intent").data(b,
function(b){return b.id});ulabel.enter().append("svg:text").attr("class","intent").attr("x",-22).attr("y","-1em").attr("id",function(b){return"intent_"+b.id}).text(get_upper_label);ulabel.exit().remove();llabel=vis.selectAll("text.extent").data(b,function(b){return b.id});llabel.enter().append("svg:text").attr("x",-22).attr("y","2em").attr("class","extent").attr("id",function(b){return"extent_"+b.id}).text(get_lower_label);llabel.exit().remove()}
function tick(b){clink.attr("x1",function(b){return b.source.x}).attr("y1",function(b){return b.source.y}).attr("x2",function(b){return b.target.x}).attr("y2",function(b){return b.target.y});cnode.attr("cx",function(b){return b.x}).attr("cy",function(b){return b.y});ulabel.attr("transform",function(b){return"translate("+b.x+","+b.y+")"});llabel.attr("transform",function(b){return"translate("+b.x+","+b.y+")"});var e=0.5*b.alpha;cnode.each(function(b){b.y+=(100*b.depth-b.y)*e})}
function filterNodes(){link.filter(function(b){for(b=b.source;b;b=b.parent)if(b===p)return!0}).remove();node.filter(function(b){for(;b=b.parent;)if(b===p)return!0}).remove()}function showNodes(){vis.selectAll(".opaque").classed("opaque",!1)}
function hideNodes(b){for(var e=0;e<b.length;e++){var c=b[e];c.classed("selected",!1);c.classed("opaque",!0);getIncomingEdges(c,function(){var b=d3.select(this);b.classed("selected",!1);b.classed("opaque",!0)});getOutgoingEdges(c,function(){var b=d3.select(this);b.classed("opaque",!1);b.classed("selected",!0)})}}
function highlightNodes(b){for(var e=0;e<b.length;e++){var c=b[e];c.classed("selected",!0);c.classed("opaque",!1);getIncomingEdges(c,function(){var b=d3.select(this);b.classed("opaque",!1);b.classed("selected",!0)});getOutgoingEdges(c,function(){var b=d3.select(this);b.classed("opaque",!1);b.classed("selected",!0)})}}function visitEdges(){for(var b=0;b<get.length;b++)get[b]}
function nodeMouseOver(b){d3.select(this).style("stroke","red");highlightPath&&visitEdgesUp(b,function(b){d3.select('line.link[source_id="'+b.source.id+'"][target_id="'+b.target.id+'"]').classed("highlighted",!0)});hoverbox.style("display","block");hoverbox.transition().delay(800).duration(300).style("opacity",1);hoverbox.style("left",d3.event.pageX+20+"px").style("top",d3.event.pageY-20+"px");wrapperElementsInList($("ul.hb_attr_list"),b.intent);wrapperElementsInList($("ul.hb_obj_list"),b.extent);
updateDistributionChart(b)}function nodeMouseOut(){mouseOverHoverBox||(d3.selectAll("line.highlighted").classed("highlighted",!1),d3.select(this).style("stroke","white"),setTimeout(function(){mouseOverHoverBox||hoverbox.transition().duration(200).style("opacity",0)},1800))}
function nodeClick(){d3.select(this).classed("selected",function(){if(this.classList.contains("selected"))return numberSelected--,!1;numberSelected++;return!0});clearSearch();updateSelectionList();$("#sel-count").text("("+numberSelected+")")}function clearSearch(){$("#search").val("");showNodes()}function clearSelection(){clearSearch();vis.selectAll(".selected").classed("selected",!1);$("#selection_list").empty()}
function get_upper_label(b){return labeling_type==LABEL_REPETITIVE?b.intent:labeling_type==LABEL_MULTILABEL?b.upperLabel:labeling_type==LABEL_SUPPORT?"":"upper"}function get_lower_label(b){return labeling_type==LABEL_REPETITIVE?b.extent:labeling_type==LABEL_MULTILABEL?b.lowerLabel:labeling_type==LABEL_SUPPORT?Math.round(100*b.support)+"% ("+Math.round(context.objects.length*b.support)+")":"lower"}
function changeLabel(b){labeling_type=b;labelizeData();vis.selectAll("text.intent").text(get_upper_label);vis.selectAll("text.extent").text(get_lower_label)}
function labelize(){for(var b=vis.select('circle[id="'+lattice.topConcept.id+'"]'),b=getOutgoingNodes(b),e=0;e<b.length;e++){for(var c=b[e],g=c.attr("intent").split(","),o=getIncomingNodes(c),n=0;n<o.length&&0<g.length;n++)var q=o[n].attr("intent").split(","),g=ArraySubtract(g,q);vis.select('text[id="intent_'+c.attr("id")+'"]').text(g.join(", "));ArrayAddAll(getOutgoingNodes(c),b)}b=vis.select('circle[id="'+lattice.bottomConcept.id+'"]');b=getIncomingNodes(b);for(e=0;e<b.length;e++){c=b[e];g=c.attr("extent").split(",");
o=getOutgoingNodes(c);for(n=0;n<o.length&&0<g.length;n++)q=o[n].attr("extent").split(","),g=ArraySubtract(g,q);vis.select('text[id="extent_'+c.attr("id")+'"]').text(g.join(", "));ArrayAddAll(getIncomingNodes(c),b)}}function checkLatticeConstraints(){if(context.attributes>MAX_ENTITY_SIZE||context.objects>MAX_ENTITY_SIZE)confirm("Labeling concepts in this lattice may be overwhelming, do you want to label them by percentage?")&&(labeling_type=LABEL_SUPPORT)}
function labelizeData(){if(labeling_type==LABEL_MULTILABEL){for(var b=getTopMostConcepts(),e=0;e<b.length;e++){for(var c=b[e],g=getParentsData(c),o=c.intent,n=0;n<g.length&&0<o.length;n++)o=ArraySubtract(o,g[n].intent);n=o.join(", ");c.name=n;c.upperLabel=n;ArrayAddAll(getChildrenData(c),b)}b=getBottomMostConcepts();for(e=0;e<b.length;e++){c=b[e];g=getChildrenData(c);o=c.extent;for(n=0;n<g.length&&0<o.length;n++)o=ArraySubtract(o,g[n].extent);n=o.join(", ");c.lowerLabel=n;ArrayAddAll(getParentsData(c),
b)}}}function getTopMostConcepts(b){b||(b=lattice.concepts);for(var e=[],c=Number.MAX_VALUE,g=0;g<b.length;g++){var o=b[g];if(0==o.depth){e.push(o);break}o.depth<c?(e.length=0,e.push(o),c=o.depth):o.depth==c&&e.push(o)}return e}function getBottomMostConcepts(){for(var b=[],e=Number.MIN_VALUE,c=0;c<lattice.concepts.length;c++){var g=lattice.concepts[c];g.depth>e?(b.length=0,b.push(g),e=g.depth):g.depth==e&&b.push(g)}return b}
function labelize2(){for(var b=getTopMostConcepts(),e=0;e<b.length;e++){for(var c=b[e],g=getParentsData(c),o=c.intent,n=0;n<g.length&&0<o.length;n++)o=ArraySubtract(o,g[n].intent);n=o.join(", ");vis.select('text[id="intent_'+c.id+'"]').text(n);c.name=n;ArrayAddAll(getChildrenData(c),b)}b=getBottomMostConcepts();for(e=0;e<b.length;e++){c=b[e];g=getChildrenData(c);o=c.extent;for(n=0;n<g.length&&0<o.length;n++)o=ArraySubtract(o,g[n].extent);n=o.join(", ");vis.select('text[id="extent_'+c.id+'"]').text(n);
ArrayAddAll(getParentsData(c),b)}}function labelizeThis(b,e){var c;c=e?flatten(b):getTopMostConcepts(b);for(var g=0;g<c.length;g++){for(var o=c[g],n=getParentsData(o),q=o.intent,v=0;v<n.length&&0<q.length;v++)q=ArraySubtract(q,n[v].intent);v=q.join(", ");o.name=v;ArrayAddAll(getChildrenData(o),c)}c=getBottomMostConcepts();for(g=0;g<c.length;g++){o=c[g];n=getChildrenData(o);q=o.extent;for(v=0;v<n.length&&0<q.length;v++)q=ArraySubtract(q,n[v].extent);q.join(", ");ArrayAddAll(getParentsData(o),c)}}
function wrapperElementsInList(b,e){b.empty();$(e).each(function(c,e){b.append($(document.createElement("li")).text(e))})}function visitEdgesUp(b,e){for(var c=getIncomingEdgesData(b),g=0;g<c.length;g++)e(c[g]),visitEdgesUp(c[g].source,e)}function getIncomingEdgesData(b,e){for(var c=[],g=0;g<lattice.edges.length;g++){var o=lattice.edges[g];o.target.id==b.id&&(c.push(o),"undefined"!=typeof e&&e(o))}return c}
function getIncomingEdges(b,e){var c=[],c=vis.selectAll('line[target_id="'+b.attr("id")+'"]');"undefined"!=typeof e&&c.each(e);return c}function getOutgoingEdges(b,e){var c=[],c=vis.selectAll('line[source_id="'+b.attr("id")+'"]');"undefined"!=typeof e&&c.each(e);return c}function getIncomingNodes(b){var e=[];vis.selectAll('line[target_id="'+b.attr("id")+'"]').each(function(){var b=vis.select('circle[id="'+d3.select(this).attr("source_id")+'"]');0>e.indexOf(b)&&e.push(b)});return e}
function getOutgoingNodes(b){var e=[];vis.selectAll('line[source_id="'+b.attr("id")+'"]').each(function(){var b=vis.select('circle[id="'+d3.select(this).attr("target_id")+'"]');0>e.indexOf(b)&&e.push(b)});return e}function getParentsData(b){for(var e=[],c=0;c<lattice.concepts.length;c++)0<=b.parents_ids.indexOf(lattice.concepts[c].id)&&e.push(lattice.concepts[c]);return e}
function getChildrenData(b){for(var e=[],c=0;c<lattice.concepts.length;c++)0<=b.children_ids.indexOf(lattice.concepts[c].id)&&e.push(lattice.concepts[c]);return e}function areNeighbor(b,e){return(0<=b.parents_ids.indexOf(e.id)||0<=b.children_ids.indexOf(e.id))&&0<=lattice.concepts.indexOf(b)&&0<=lattice.concepts.indexOf(e)?!0:!1}function hasChild(b,e){return 0<=b.children_ids.indexOf(e.id)&&0<=lattice.concepts.indexOf(b)&&0<=lattice.concepts.indexOf(e)?!0:!1}
var latticeVisOpts=[{name:"Hasse diagram",val:"lattice",tooltip:"A Hasse diagram with dynamic arrangement"},{name:"Tree",val:"tree",tooltip:"A concept in a tree has only one parent and no edges crossings"},{name:"Treemap",val:"treemap",tooltip:"A treemap subdivides area into rectangles each of them is sized according to some metric"},{name:"Sunburst",val:"sunburst",tooltip:"A radial tree-like layout where the root node is at the center, with leaves on the circumference"},{name:"iCicle",val:"icicle",
tooltip:"Similar to sunburst but not radial"}],ARVisOpts=[{name:"Matrix",val:"matrixview",tooltip:"Association rules interdependence"},{name:"Radial diagram",val:"radiagram",tooltip:"Association rules interdependence"},{name:"Grouped circles",val:"gg_ar_plot",tooltip:"Grouped graph of association rules"}],colorAndSizeOpts=[{name:"Default",val:"default",tooltip:"Default option"},{name:"Support",val:"support",tooltip:"Support"}],selectedConcepts=[];
$(document).mouseup(function(b){$(b.target).closest(".toolbarPanel").length||$(".toolbarPanel").hide()});
$(function(){var b=$("#chart");$(window).scroll(function(){"matrixview"==currentVis||"radiagram"==currentVis||"gg_ar_plot"==currentVis?b.css({position:"absolute",top:"128px"}):102<=document.documentElement.scrollTop||102<=window.pageYOffset?$.browser.msie&&"6.0"==$.browser.version?b.css("top",document.documentElement.scrollTop+55+"px"):b.css({position:"fixed",top:"55px"}):(102>document.documentElement.scrollTop||102>window.pageYOffset)&&b.css({position:"absolute",top:"128px"})});$("#hideVisPanel").click(function(){$(".toolbarPanel").hide()});
$(".visButton").click(function(){$(".toolbarPanel").hide();$("#visPanel").show()});$(".highlightButton").click(function(){$(".toolbarPanel").hide();$("#highlightPanel").show()});$(".metricButton").click(function(){$(".toolbarPanel").hide();$("#metricPanel").show()});$("li.explain").tooltip({title:"data-tooltip",placement:"right",delay:800});$("input:radio[name='toggle']").change(function(){"rules"==$(this).val()?($("#dashboard_lattice").hide(),$("#dashboard_ar").show(),d3.select("#chart").html(""),
fetchAssociationRules(initARView),currentVis="matrixview",buildOptionsForSelect(ARVisOpts,"select-vis","matrixview")):($("#dashboard_ar").hide(),$("#toolbar").show(),$("#dashboard_lattice").show(),changeVis("lattice"),buildOptionsForSelect(latticeVisOpts,"select-vis","matrix"))});buildOptionsForSelect(latticeVisOpts,"select-vis","lattice");buildOptionsForSelect(colorAndSizeOpts,"select-size","default");buildOptionsForSelect(colorAndSizeOpts,"select-color","default");$("#slider-supp").slider({range:!0,
min:0,max:100,values:[30,90],slide:function(b,c){$("#support").val(c.values[0]+"% - "+c.values[1]+"%");changeNodeVisibility("support",c.values[0],c.values[1],!1)}});$("#slider-stab").slider({min:0,max:100,value:[50],slide:function(b,c){$("#stability").val(c.value+"%");changeNodeVisibility("stability",c.value,null,!1)}});$("#slider-conf").slider({min:0,max:100,value:[50],slide:function(b,c){$("#confidence").val(c.value+"%");changeNodeVisibility("stability",c.value,null,!1)}});$("#select-label").change(function(){changeLabel(parseInt($(this).attr("value")))});
$("#select-size").change(function(){changeNodeSize($(this).attr("value"))});$("#select-color").change(function(){changeNodeColor($(this).attr("value"))});$("#select-vis").change(function(){changeVis($(this).attr("value"))});$("option.explain").tooltip({title:"data-tooltip",placement:"right",delay:600});$("span.explain").tooltip({live:!0,title:"data-tooltip",placement:"top",offset:10,delay:600});$("input[name='highlight_path']").change(function(){highlightPath=$(this).is(":checked")});$(".distribution-view").click(function(){$(".graph-view").removeClass("active");
$(".distribution-view").addClass("active");$("#filters_container").show();$("#graph_container").hide()});$(".graph-view").click(function(){$(".graph-view").addClass("active");$(".distribution-view").removeClass("active");$("#graph_container").show();$("#filters_container").hide()});$(".filter-search").click(function(){filterSelected();$("input.search").tokenInput("clear")});$("a.remove-filter").live("click",function(b){var c=this.parentNode.id.split("-");1<c.length?removeFilter(c[0],c[1]):removeFilter(c[0]);
b.stopPropagation();return!1});$("#selAllAttr").click(function(){var b=this.checked;$("input[name='attr']").each(function(){this.checked=b})});$("#selAllObj").click(function(){var b=this.checked;$("input[name='obj']").each(function(){this.checked=b})});$(".filter-objs").click(function(){filterObjects()});$(".filter-attrs").click(function(){filterAttributes()});$("#slider-layout").slider({value:2,min:1,max:2,step:1,slide:function(b,c){var g="";1==c.value?g="Viewer":2==c.value?g="Dashboard":3==c.value&&
(g="Dashboard");$("#layout_type").val(g);inflateDiv(c.value)}});$("#layout_type").val("Dashboard");$("#hoverbox").hover(function(){mouseOverHoverBox=!0},function(){mouseOverHoverBox=!1;hoverbox.transition().duration(200).delay(800).style("opacity",0)});$("#hidePanel").click(function(){$("#showEntitiesPanel").show("normal").animate({width:"40px",opacity:1},200);$("#panel").animate({marginLeft:"-175px"},500);$("#colleft").animate({width:"0px",opacity:0},400);$("#showPanel").show("normal").animate({width:"40px",
opacity:1},200)});$("#showPanel").click(function(){$("#showEntitiesPanel").hide();$("#panel").animate({marginLeft:"0px"},400);$("#colleft").animate({width:"175px",opacity:1},400);$("#showPanel").animate({width:"0px",opacity:0},600).hide("slow")});$("#hideEntPanel").click(function(){$("#showPanel").show("normal").animate({width:"40px",opacity:1},200);$("#entityPanel").animate({marginLeft:"-175px"},500);$("#entityContainer").animate({width:"0px",opacity:0},400);$("#showEntitiesPanel").show("normal").animate({width:"40px",
opacity:1},200)});$("#showEntitiesPanel").click(function(){$("#showPanel").hide();$("#entityPanel").animate({marginLeft:"0px"},400);$("#entityContainer").animate({width:"175px",opacity:1},400);$("#showEntitiesPanel").animate({width:"0px",opacity:0},600).hide("slow")});$(".tabs").bind("change",function(b){b.target;b.relatedTarget});$("#hideFiltersPanel").click(function(){$("#thepanel").animate({marginLeft:"-210px"},500);$("#filtersPanel").animate({height:"1px",opacity:0},400);$("#showFiltersPanel").show("normal").animate({height:"20px",
opacity:1},200)});$("#showFiltersPanel").live("click",function(){$("#thepanel").animate({marginLeft:"0px"},400);$("#filtersPanel").animate({height:"210px",opacity:1},400);$("#showFiltersPanel").animate({height:"0px",opacity:0},600).hide("slow")});$("#calc-stab").change(function(){calculate("stability")});$("a.clear-sel").click(function(){clearSelection()});$("a.reset-filters").click(function(){resetFilters()});$("a.transf-tree").click(function(){treeize()});$(".draw-chart-1a").click(function(){createHorizontalBarChart("box1a-chart",
$("#control_1").selectedPairsArray(),$("#control_2").selectedPairsArray())});createDistributionChart();$("a.cancel-upload").live("click",function(){$("#cxt-file").popover("hide")});$("#cxt-file").click(function(){$("#cxt-file").popover("show")});$("#cxt-file").popover({placement:"bottom",html:"true",trigger:"manual",title:function(){return"Open cxt file"},content:function(){return $("#open-file").html()}});$("a.compare").click(function(){plotCompare()})});
function inflateDiv(b){1==b?($("#columns").animate({width:"1px",opacity:0},400),$("#columns").hide(),$("#chart").animate({width:"1040px"},400)):($("#chart").animate({width:"570px"},400),$("#columns").show(),$("#columns").animate({width:"570px",opacity:1},400))}
function getAttributeValuesPairs(){var b=[],e;for(e in context.attributeNames)for(var c=context.attributeNames[e],g=0;g<c.length;g++){var o={};o.valueIdx=g;if("yes"==c[g][0]||"no"==c[g][0]){o.name=e;o.attrName=e;o.booleanAttr=!0;b.push(o);break}else o.booleanAttr=!1,o.attrName=e,o.valueName=c[g][0],o.name=e+SEPARATOR+c[g][0],b.push(o)}return b}
function selectionAdded(){for(var b=$("#search").tokenInput("get"),e="",c=0;c<b.length;c++)e+=b[c].name+",";isBlank(e)?(showNodes(),vis.selectAll(".selected").classed("selected",!1)):(b=searchFacet(e,!0),addOrReplaceToSelectionList(b[0],!0),highlightNodes(b[0]),hideNodes(b[1]))}
function buildOptionsForSelect(b,e,c){e=$("#"+e);e.empty();for(var g,o=0;o<b.length;o++)g=$('<option value="'+b[o].val+'" class="explain"  data-tooltip="'+b[o].tooltip+'">'+b[o].name+"</option>"),b[o].val==c&&g.attr("selected","selected"),e.append(g)}
function addOrReplaceToSelectionList(b,e){e&&$("#selection_list").empty();for(var c=0;c<b.length;c++){var g=b[c];$("<li>").appendTo("#selection_list").html("Attributes: <span>"+g.attr("intent")+"</span><BR/> Objects: <span>"+g.attr("extent")+"</span>")}}
function updateSelectionList(){$("#selection_list").empty();vis.selectAll("circle.selected").each(function(b){$("<li>").appendTo("#selection_list").html("Attributes: <span>"+b.intent.join(", ")+"</span><BR/> Objects: <span>"+b.extent.join(", ")+"</span>")})}
function updateEntityList(){$("#attr_list").empty();$("#obj_list").empty();for(var b=getAttributeValuesPairs(),e=0;e<b.length;e++){var c=$("<li>").appendTo("#attr_list");c.html("<span><input type='checkbox' name='attr' value='"+b[e].name+"'> "+b[e].name+"</span>")}for(var g=context.objects,e=0;e<g.length;e++)c=$("<li>").appendTo("#obj_list"),c.html("<span><input type='checkbox' name='obj' value='"+g[e]+"'> "+g[e]+"</span>");$("#attr-count").html(b.length);$("#obj-count").html(g.length)}
function updateLayout(){}function calculate(b){"stability"==b&&calcStability()}
function calcStability(){if("undefined"==typeof lattice_id||null==lattice_id)flashAlert("error","The current concept lattice is not saved in the server - could not compute metric.");else if("undefined"==typeof metric_stability){showLoading();var b=$("input[name=csrfmiddlewaretoken]").val();$.getJSON("/api/v1/metrics/",{lattice_id:lattice_id,metric:"stability",csrfmiddlewaretoken:b},function(){hideLoading();$("#calc-stab").attr("disabled",!0)})}}
function calcSupport(b,e){e?(attrs=data.attributes.length,objs=data.objects.length):attrs=_data_attributes.length;for(var c=0;c<data.nodes.length;c++)data.nodes[c]}
$(function(){$("ul.nav > li.active").removeClass("active");$("li#semantics").addClass("active");$("a.sparql-search").click(function(){var b=$("textarea#search_prefix").val(),e=$("textarea#search_query").val(),c=$("input[name=csrfmiddlewaretoken]").val();$.get("search",{format:"json",search_prefix:b,search_query:e,csrfmiddlewaretoken:c},function(b){if("undefined"==typeof b.error){for(var c=$("div#sparql_result").append("<table></table>"),e=c.append("<tr></tr>"),q=0;q<b.head.vars.length;q++)e.append("<th>"+
b.head.vars[q]+"</th>");for(q=0;q<b.results.bindings.length;q++){var v=b.results.bindings[q],e=v.wine.value.split("#")[1],z=v.property.value.split("#")[1],v=v.value.value.split("#")[1];c.append("<tr><td>"+e+"</td><td>"+z+"</td><td>"+v+"</td></tr>")}}else $("div#sparql_result").html(b.error)})})});
function treeTransform(){function b(c){for(var e=getChildrenDataNodes(c.children_ids),o=[],n=0;n<e.length;n++){var q=b(e[n]);o.push(q)}c.children=o;return c}var e=getTopMostConcepts()[0],e=b(e);data.nodes=[e]}
function getTree0(){function b(c){if(0==c.children_ids.length)return null;var e={};e.id=""+c.id;e.name=c.intent.join(", ");e.lowerLabel=c.lowerLabel;e.upperLabel=c.upperLabel;e.support=c.support;e.intent=c.intent;e.extent=c.extent;e.depth=c.depth;e.children=[];for(var o=getChildrenData(c),n=0;n<o.length;n++)if(0<o[n].children_ids.length){var q=b(o[n]);q.id=c.id+"-"+q.id;e.children.push(q)}return e}var e=getTopMostConcepts()[0];return b(e)}
function getTree(){function b(c){for(var e=getChildrenDataNodes(c.children_ids),o=[],n=0;n<e.length;n++){var q=b(e[n]);o.push(q)}c.children=o;return c}var e=getTopMostConcepts()[0];return b(e)}function flatten(b){function e(b){var g={};g.name=b.name;g.children=[];for(var b=getChildrenDataNodes(b.children_ids),o=0;o<b.length;o++){var n=e(g,b[o]);g.children.push(n)}return g}return e(b)}
function flatten(b){function e(b){b.children&&b.children.forEach(e);b.id||(b.id=++g);c.push(b)}var c=[],g=0;e(b);return c}
function unique_set(b,e){e||(e=!1);arr=[];if(e)for(i=0;i<b.length;i++){flag=!0;for(j=0;j<arr.length;j++){var c;c=arr[j];var g=b[i];result=!0;if(c.length!==g.length)c=!1;else{for(k=0;k<c.length;k++)compare_objects(c[k],g[k])||(result=!1);c=result}c&&(flag=!1)}flag&&arr.push(b[i])}else for(i=0;i<b.length;i++){flag=!0;for(j=0;j<arr.length;j++)compare_objects(arr[j],b[i])&&(flag=!1);flag&&arr.push(b[i])}return arr}
var compare_objects=function(b,e){if(b===e)return!0;if(!(b instanceof Object)||!(e instanceof Object)||b.constructor!==e.constructor)return!1;for(var c in b)if(b.hasOwnProperty(c)&&(!e.hasOwnProperty(c)||b[c]!==e[c]&&("object"!==typeof b[c]||!Object.equals(b[c],e[c]))))return!1;for(c in e)if(e.hasOwnProperty(c)&&!b.hasOwnProperty(c))return!1;return!0};
function compare_a_rules(b,e){tmp1={};tmp2={};tmp1.prem=clone(b.premise);tmp1.conc=clone(b.conclusion);tmp2.prem=clone(e.premise);tmp2.conc=clone(e.conclusion);sub_sets_equal=compare_objects(tmp1.prem,tmp2.prem)&&compare_objects(tmp1.conc,tmp2.conc);tmp1=clone(b);tmp2=clone(e);tmp1.premise=1;tmp1.conclusion=1;tmp2.premise=1;tmp2.conclusion=1;return compare_objects(tmp1,tmp2)&&sub_sets_equal}
Array.prototype.transpose=function(){var b=this.length?this.length:0,e=this[0]instanceof Array?this[0].length:0;if(0===e||0===b)return[];var c,g,o=[];for(c=0;c<e;c++){o[c]=[];for(g=0;g<b;g++)o[c][g]=this[g][c]}return o};function clone(b){if(!b||"object"!==typeof b)return b;var e="function"===typeof b.pop?[]:{},c,g;for(c in b)b.hasOwnProperty(c)&&(g=b[c],e[c]=g&&"object"===typeof g?clone(g):g);return e}function ArrayAddAll(b,e){for(var c=0;c<b.length;c++)0>e.indexOf(b[c])&&e.push(b[c])}
function ArraySubtract(b,e){for(var c=[],g=0;g<b.length;g++)0<=e.indexOf(b[g])||c.push(b[g]);return c}function ArraySubtractId(b,e){for(var c=[],g=0;g<b.length;g++){for(var o=!1,n=0;n<e.length&&!o;n++)b[g].id==e[n].id&&(o=!0);o||c.push(b[g])}return c}function ArrayIntersect(b,e){for(var c=[],g=0;g<b.length;g++)!isBlank(b[g])&&0<=e.indexOf($.trim(b[g]))&&c.push(b[g]);return c}
function ArrayContainsAll(b,e){if(0==b.length)return!1;for(var c=0;c<e.length;c++)if(!isBlank(e[c])&&0>b.indexOf($.trim(e[c])))return!1;return!0}function ArrayIntersectId(b,e){for(var c=[],g=0;g<b.length;g++)for(var o=0;o<e.length;o++)b[g].id==e[o].id&&c.push(b[g]);return c}function ArrayRemove(b,e,c){c=b.slice((c||e)+1||b.length);b.length=0>e?b.length+e:e;return b.push.apply(b,c)}function HashClone(b){return jQuery.extend(!0,{},b)}function getKeys(b){var e=[],c;for(c in b)e.push(c);return e}
String.prototype.escapeHTML=function(){return this.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")};function isBlank(b){return!b||/^\s*$/.test(b)}function removeWhiteSpaces(b){return b=b.replace(/\s/g,"")}var labeling_type=LABEL_MULTILABEL,size_type="default",color_type="default",highlightPath=!0,currentVis="lattice",previousVis="lattice",w=DEFAULT_WIDTH,h=DEFAULT_HEIGHT,force,vis;function redrawVis(){"lattice"!=currentVis&&changeVis(currentVis)}
function changeVis(b){prevIndex=-1;d3.select("#chart").html("");"lattice"==b?initLattice():"static-lattice"==b?initThisLattice():"sunburst"==b?initSunburst():"icicle"==b?initIcicle():"treemap"==b?treemap():"tree"==b?initTree():"matrixview"==b?(initARView(),createRulesList()):"radiagram"==b?(initDiagonalARView(),createRulesList()):"gg_ar_plot"==b&&(init_gg_plot(),createRulesList());currentVis=b}
function updateVis(){redrawVis();"lattice"==currentVis?updateLattice():"static-lattice"==currentVis?updateStaticLattice():"sunburst"==currentVis?updateSunburst():"icicle"==currentVis?updateIcicle():"treemap"==currentVis?tm_updateTree(getTree0):"tree"==currentVis&&updateTree(getTree0())}function getNodeSize(b){return"default"==size_type?DEFAULT_NODE_RADIUS:Math.round(b[size_type]*(NODE_MAX_SIZE-NODE_MIN_SIZE))+NODE_MIN_SIZE}
function changeNodeSize(b){size_type=b;"treemap"==currentVis?(console.log("changin"),tm_updateTree(getTree0)):vis.selectAll("circle").attr("r",function(b){return getNodeSize(b)})}function changeNodeColor(b){size_type=b;"treemap"==currentVis?(console.log("changin"),tm_updateTree(getTree0)):vis.selectAll("circle").attr("r",function(b){return getNodeSize(b)})}
function changeNodeVisibility(b,e,c){vis.selectAll("circle").style("fill",function(g){if(null==c||"undefined"==typeof c){if(100*g[b]>=e)return"#ff0000"}else if(100*g[b]>=e&&100*g[b]<=c)return"#ff0000"})}function initStaticLattice(){(new MinIntersect).run()}
function initStaticLattice2(){vis=d3.select("#chart").append("svg:svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+w+" "+h);var b=lattice.concepts,e=data.links;clink=vis.selectAll("line.link").data(e);clink.enter().insert("svg:line",".node").attr("class","link").attr("x1",function(b){return b.source.x}).attr("y1",function(b){return b.source.y}).attr("x2",function(b){return b.target.x}).attr("y2",function(b){return b.target.y}).attr("source_id",function(b){return b.source.id}).attr("target_id",
function(b){return b.target.id});clink.exit().remove();cnode=vis.selectAll("circle.node").data(b,function(b){return b.id});cnode.enter().append("svg:circle").attr("class","node").attr("cx",function(b){return b.x}).attr("cy",function(b){return b.y}).attr("r",DEFAULT_NODE_RADIUS).attr("intent",function(b){return b.intent}).attr("extent",function(b){return b.extent}).attr("id",function(b){return b.id}).attr("children",function(b){return b.children}).on("click",nodeClick).on("mouseover",nodeMouseOver).on("mouseout",
nodeMouseOut);cnode.exit().remove()}function tickStatic(){}var partition,path,sbLabel,p=5,arc=d3.svg.arc().startAngle(function(b){return Math.max(0,Math.min(2*Math.PI,x(b.x)))}).endAngle(function(b){return Math.max(0,Math.min(2*Math.PI,x(b.x+b.dx)))}).innerRadius(function(b){return Math.max(0,y(b.y))}).outerRadius(function(b){return Math.max(0,y(b.y+b.dy))}),r,x,y,color;
function initSunburst(){r=Math.min(w,h)/2;x=d3.scale.linear().range([0,2*Math.PI]);y=d3.scale.sqrt().range([0,r]);color=d3.scale.category20c();vis=d3.select("#chart").append("svg:svg").attr("width",w).attr("height",h).append("svg:g").attr("transform","translate("+w/2+","+h/2+")");partition=d3.layout.partition().sort(null).value(function(){return 1});updateSunburst()}
function updateSunburst(){var b=getTree0();vis.data([b]);b=partition.nodes(b);path=vis.selectAll("path.sb").data(partition.nodes,function(b){return b.id});path.enter().append("svg:path").attr("class","sb").attr("id",function(b,c){return"path-"+c}).attr("d",arc).style("fill",function(b){return color((b.children?b:b.parent).name)}).on("mouseover",nodeMouseOver).on("mouseout",nodeMouseOut).on("click",nodeClick).on("dblclick",sbclick);path.exit().remove();sbLabel=vis.selectAll("text").data(b);b=sbLabel.enter().append("svg:text").style("opacity",
1).style("fill","#000").attr("text-anchor",function(b){return x(b.x+b.dx/2)>Math.PI?"end":"start"}).attr("dy",".2em").attr("transform",function(b){var c=1<(b.name||"").split(" ").length,g=180*x(b.x+b.dx/2)/Math.PI-90;return"rotate("+(g+(c?-0.5:0))+")translate("+(y(b.y)+p)+","+(x(b.x)+20*b.depth)+")rotate("+(90<g?-180:0)+")"}).on("click",nodeClick).on("dblclick",sbclick);b.append("svg:tspan").attr("x",0).text(function(b){return b.depth?b.name.split(" ")[0]:""});b.append("svg:tspan").attr("x",0).attr("dy",
"1em").text(function(b){return b.depth?b.name.split(" ")[1]||"":""})}function isParentOf(b,e){return b===e?!0:b.children?b.children.some(function(b){return isParentOf(b,e)}):!1}
function sbclick(b){path.transition().duration(750).attrTween("d",arcTween(b));sbLabel.style("visibility",function(e){return isParentOf(b,e)?null:d3.select(this).style("visibility")}).transition().duration(750).attrTween("text-anchor",function(b){return function(){return x(b.x+b.dx/2)>Math.PI?"end":"start"}}).attrTween("transform",function(b){var c=1<(b.name||"").split(" ").length;return function(){var g=180*x(b.x+b.dx/2)/Math.PI-90;return"rotate("+(g+(c?-0.5:0))+")translate("+(y(b.y)+p)+")rotate("+
(90<g?-180:0)+")"}}).style("opacity",function(e){return isParentOf(b,e)?1:1E-6}).each("end",function(e){d3.select(this).style("visibility",isParentOf(b,e)?null:"hidden")})}function arcTween(b){var e=d3.interpolate(x.domain(),[b.x,b.x+b.dx]),c=d3.interpolate(y.domain(),[b.y,1]),g=d3.interpolate(y.range(),[b.y?20:0,r]);return function(b,n){return n?function(){return arc(b)}:function(n){x.domain(e(n));y.domain(c(n)).range(g(n));return arc(b)}}}var rect;
function initIcicle(){x=d3.scale.linear().range([0,w]);y=d3.scale.linear().range([0,h]);vis=d3.select("#chart").append("svg:svg").attr("width",w).attr("height",h);partition=d3.layout.partition().value(function(){return 1});updateIcicle()}
function updateIcicle(){var b=getTree0();vis.data([b]);partition.nodes(b);rect=vis.selectAll("rect").data(partition.nodes);rect.enter().append("svg:rect").attr("x",function(b){return x(b.x)}).attr("y",function(b){return y(b.y)}).attr("width",function(b){return x(b.dx)}).attr("height",function(b){return y(b.dy)}).attr("fill",function(b){return color((b.children?b:b.parent).name)}).on("mouseover",nodeMouseOver).on("mouseout",nodeMouseOut).on("click",nodeClick).on("dblclick",icclick);vis.selectAll("rect").data(partition.nodes).enter().append("svg:text").attr("class",
"intent").attr("x",-22).attr("y","-1em").attr("id",function(b){return"intent_"+b.id}).text(d.intent.join(", "));rect.exit().remove()}function icclick(b){x.domain([b.x,b.x+b.dx]);y.domain([b.y,1]).range([b.y?20:0,h]);rect.transition().duration(750).attr("x",function(b){return x(b.x)}).attr("y",function(b){return y(b.y)}).attr("width",function(b){return x(b.x+b.dx)-x(b.x)}).attr("height",function(b){return y(b.y+b.dy)-y(b.y)})}var tree,root,diagonal,m,duration,treei=0;
function initTree(){function b(e){e.children&&(e._children=e.children,e._children.forEach(b),e.children=null)}m=[20,120,20,120];duration=500;tree=d3.layout.tree().size([h,w]);diagonal=d3.svg.diagonal().projection(function(b){return[b.y,b.x]});vis=d3.select("#chart").append("svg:svg").attr("width",w+m[1]+m[3]).attr("height",h+m[0]+m[2]).append("svg:g").attr("transform","translate("+m[3]+","+m[0]+")");root=getTree0();root.x0=h/2;root.y0=0;root.children.forEach(b);updateTree(root)}
function updateTree(b){var e=tree.nodes(root).reverse();e.forEach(function(b){b.y=180*b.depth});var c=vis.selectAll("g.node").data(e,function(b){return b.id}),g=c.enter().append("svg:g").attr("class","node").attr("transform",function(){return"translate("+b.y0+","+b.x0+")"}).on("dblclick",clickCollapse);g.append("svg:circle").attr("r",getNodeSize).on("click",nodeClick).on("mouseover",nodeMouseOver).on("mouseout",nodeMouseOut);g.append("svg:text").attr("class","intent").attr("x",function(b){return b.children||
b._children?-10:10}).attr("dy","-1.5em").attr("text-anchor",function(b){return b.children||b._children?"end":"start"}).text(get_upper_label).style("fill-opacity",1E-6);g.append("svg:text").attr("class","extent").attr("x",function(b){return b.children||b._children?-10:10}).attr("dy","1.5em").attr("text-anchor",function(b){return b.children||b._children?"end":"start"}).text(get_lower_label).style("fill-opacity",1E-6);c.transition().duration(duration).attr("transform",function(b){return"translate("+
b.y+","+b.x+")"}).selectAll("text").style("fill-opacity",1);c.exit().transition().duration(duration).attr("transform",function(){return"translate("+b.y+","+b.x+")"}).remove().selectAll("text").style("fill-opacity",1E-6);c=vis.selectAll("path.treelink").data(tree.links(e),function(b){return b.target.id});c.enter().insert("svg:path","g").attr("class","treelink").attr("d",function(){var c={x:b.x0,y:b.y0};return diagonal({source:c,target:c})}).transition().duration(duration).attr("d",diagonal);c.transition().duration(duration).attr("d",
diagonal);c.exit().transition().duration(duration).attr("d",function(){var c={x:b.x,y:b.y};return diagonal({source:c,target:c})}).remove();e.forEach(function(b){b.x0=b.x;b.y0=b.y})}function clickCollapse(b){b.children?(b._children=b.children,b.children=null):(b.children=b._children,b._children=null);updateTree(b)}var tm_root;
function treemap(){console.log("initilizing treemap");m=[20,120,20,120];duration=500;treemap=d3.layout.treemap().size([h,w]).sticky(!0).value(function(b){return size_type==SIZE_SUPPORT?b.support:size_type==SIZE_STABILITY?b.stability:1});vis=d3.select("#chart").append("svg:svg").attr("width",w+m[1]+m[3]).attr("height",h+m[0]+m[2]).append("svg:g");tm_root=getTree0();tm_root.x0=0;tm_root.y0=0;tm_updateTree(tm_root)}
function tm_updateTree(b){console.log("updating");color=d3.scale.category20c();var e=treemap.nodes(tm_root),e=vis.selectAll("g.node").data(e,function(){return size_type==SIZE_SUPPORT?d.support:size_type==SIZE_STABILITY?d.stability:1}),c=e.enter().append("svg:g").attr("class","node").attr("transform",function(){return"translate("+tm_root.y0+","+tm_root.x0+")"}).on("dblclick",clickCollapse);c.append("svg:rect").attr("x",function(b){return b.x}).attr("y",function(b){return b.y}).attr("width",function(b){return Math.max(0,
b.dx)}).attr("height",function(b){return Math.max(0,b.dy)}).style("fill",function(b){return color(b.depth)}).style("stroke","white").style("opacity",1).on("mouseover",nodeMouseOver).on("mouseout",nodeMouseOut);c.append("svg:text").attr("class","intent").attr("x",function(b){return b.x}).attr("y",function(b){return b.y+30}).text(get_upper_label).style("fill-opacity",1E-6);c.append("svg:text").attr("class","extent").attr("x",function(b){return b.x}).attr("y",function(b){return b.y+15}).text(get_lower_label).style("fill-opacity",
1E-6);e.transition().duration(duration).attr("transform",function(b){return"translate("+b.y0+","+b.x0+")"}).selectAll("text").style("fill-opacity",1);e.exit().transition().duration(duration).style("fill-opacity",1).attr("transform",function(){return"translate("+b.y0+","+b.x0+")"}).remove().selectAll("text").style("fill-opacity",1E-6)}
function init_matrix_view(){function b(b){d3.select(this).selectAll(".cell").data(b.filter(function(b){return b.z})).enter().append("rect").attr("class","cell").attr("x",function(b){return b.y*w/g}).attr("width",w/g).attr("height",h/myobject.length).style("fill-opacity",function(b){return b.confidence}).style("fill",function(b){return z(b.z)})}var e=[20,120,20,120],c=[],g=0,o=[];for(a in context.attributeNames)for(n=0;n<context.attributeNames[a].length;n++)"yes"==context.attributeNames[a][n][0]?o.push(a.toString()):
"no"!=context.attributeNames[a][n][0]&&o.push(a.toString()+"-"+context.attributeNames[a][n][0]);for(var g=o.length,n=0;n<myobject.length;n++)c[n]=[],c[n]=d3.range(g).map(function(b){return{x:n,y:b,z:0}});for(n=0;n<myobject.length;n++)for(var q=0;q<g;q++){for(var v=0;v<myobject[n].premise.length;v++)o[q]==myobject[n].premise[v]&&(c[n][q].z=1,c[n][q].confidence=myobject[n].confidence,c[n][q].premise_supp=myobject[n].premise_supp,c[n][q].conclusion_supp=myobject[n].conclusion_supp,c[n][q].premise=myobject[n].premise,
c[n][q].conclusion=myobject[n].conclusion);for(v=0;v<myobject[n].conclusion.length;v++)o[q]==myobject[n].conclusion[v]&&(c[n][q].z=2,c[n][q].confidence=myobject[n].confidence,c[n][q].premise_supp=myobject[n].premise_supp,c[n][q].conclusion_supp=myobject[n].conclusion_supp,c[n][q].premise=myobject[n].premise,c[n][q].conclusion=myobject[n].conclusion)}d3.scale.ordinal().rangeBand([0,w]);d3.scale.linear().domain([0,4]).clamp(!0);var z=d3.scale.category10().domain(d3.range(10)),q=0;for(n in context.attributeNames)q=
Math.max(q,n.length);e[0]=12*q;for(n=q=0;n<myobject.length;n++)q=Math.max(q,myobject[n].premise.toString().length);e[1]=10+10*Math.log(myobject.length)/Math.LN10;vis=d3.select("#chart").append("svg:svg").attr("width",w+e[1]+e[3]).attr("height",h+e[0]+e[2]).append("svg:g").attr("transform","translate("+e[1]+","+e[0]+")");vis.append("rect").attr("class","background").attr("width",width).attr("height",height);b=vis.selectAll(".row").data(c).enter().append("g").attr("class","row").attr("transform",function(b){return"translate(0,"+
b[0].x*h/myobject.length+")"}).each(b);b.append("line").attr("x2",w).attr("class","matrix_view_separator");b.append("text").attr("x",0).attr("dy","1em").attr("text-anchor","end").attr("class","label").text(function(b,c){return"R"+c.toString()});e=vis.selectAll(".column").data(c.transpose()).enter().append("g").attr("class","column").attr("transform",function(b,c){return"translate("+b[c].y*w/g+")rotate(-90)"});e.append("line").attr("x1",-w).attr("class","matrix_view_separator");e.append("text").attr("class",
"label").attr("x",0).attr("dy","1em").attr("text-anchor","start").text(function(b,c){return o[c]})}
function init_scatter_plot(){function b(c){var e=b.extent();v.selectAll("circle").attr("class",function(b){return e[0][0]<=b[c.x]&&b[c.x]<=e[1][0]&&e[0][1]<=b[c.y]&&b[c.y]<=e[1][1]?1:"spl"})}var e=[];for(a in context.attributeNames)for(i=0;i<context.attributeNames[a].length;i++)"yes"==context.attributeNames[a][i][0]?e.push(a.toString()):"no"!=context.attributeNames[a][i][0]&&e.push(a.toString()+"-"+context.attributeNames[a][i][0]);var e=eval('([{"confidence":0.75,"conclusion_supp":6,"premise_supp":8,"premise":[],"conclusion":["US-citizen"]},{"confidence":0.375,"conclusion_supp":3,"premise_supp":8,"premise":[],"conclusion":["age-30to<40"]},{"confidence":0.375,"conclusion_supp":3,"premise_supp":8,"premise":[],"conclusion":["employment-Managerial"]},{"confidence":0.25,"conclusion_supp":2,"premise_supp":8,"premise":[],"conclusion":["employment-Clerical"]},{"confidence":0.5,"conclusion_supp":4,"premise_supp":8,"premise":[],"conclusion":["sex-Female"]},{"confidence":0.5,"conclusion_supp":3,"premise_supp":6,"premise":["US-citizen"],"conclusion":["education-Bachelors"]},{"confidence":0.5,"conclusion_supp":3,"premise_supp":6,"premise":["US-citizen"],"conclusion":["age->=50"]},{"confidence":0.6666666666666666,"conclusion_supp":4,"premise_supp":6,"premise":["US-citizen"],"conclusion":["sex-Male"]},{"confidence":0.6666666666666666,"conclusion_supp":2,"premise_supp":3,"premise":["age-30to<40"],"conclusion":["US-citizen","sex-Male"]},{"confidence":0.3333333333333333,"conclusion_supp":1,"premise_supp":3,"premise":["age-30to<40"],"conclusion":["employment-Managerial","education-Masters","sex-Female"]},{"confidence":0.6666666666666666,"conclusion_supp":2,"premise_supp":3,"premise":["employment-Managerial"],"conclusion":["sex-Female"]},{"confidence":0.6666666666666666,"conclusion_supp":2,"premise_supp":3,"premise":["employment-Managerial"],"conclusion":["US-citizen","age->=50"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["employment-Clerical"],"conclusion":["education-Bachelors","US-citizen","sex-Male","age-30to<40"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["employment-Clerical"],"conclusion":["age-40to<50","sex-Female"]},{"confidence":0.5,"conclusion_supp":2,"premise_supp":4,"premise":["sex-Female"],"conclusion":["US-citizen","education-Bachelors"]},{"confidence":0.5,"conclusion_supp":2,"premise_supp":4,"premise":["sex-Female"],"conclusion":["employment-Managerial"]},{"confidence":0.25,"conclusion_supp":1,"premise_supp":4,"premise":["sex-Female"],"conclusion":["employment-Clerical","age-40to<50"]},{"confidence":0.3333333333333333,"conclusion_supp":1,"premise_supp":3,"premise":["US-citizen","education-Bachelors"],"conclusion":["sex-Male","employment-Clerical","age-30to<40"]},{"confidence":0.6666666666666666,"conclusion_supp":2,"premise_supp":3,"premise":["US-citizen","education-Bachelors"],"conclusion":["sex-Female"]},{"confidence":0.6666666666666666,"conclusion_supp":2,"premise_supp":3,"premise":["US-citizen","age->=50"],"conclusion":["employment-Managerial"]},{"confidence":0.6666666666666666,"conclusion_supp":2,"premise_supp":3,"premise":["US-citizen","age->=50"],"conclusion":["sex-Male"]},{"confidence":0.5,"conclusion_supp":2,"premise_supp":4,"premise":["US-citizen","sex-Male"],"conclusion":["age-30to<40"]},{"confidence":0.5,"conclusion_supp":2,"premise_supp":4,"premise":["US-citizen","sex-Male"],"conclusion":["employment-Unskilled"]},{"confidence":0.5,"conclusion_supp":2,"premise_supp":4,"premise":["US-citizen","sex-Male"],"conclusion":["age->=50"]},{"confidence":0.5,"conclusion_supp":2,"premise_supp":4,"premise":["US-citizen","sex-Male"],"conclusion":["education-HS-grad"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","sex-Male","age-30to<40"],"conclusion":["education-Bachelors","employment-Clerical"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","sex-Male","age-30to<40"],"conclusion":["education-HS-grad","employment-Unskilled"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["sex-Female","employment-Managerial"],"conclusion":["education-Bachelors","US-citizen","age->=50"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["sex-Female","employment-Managerial"],"conclusion":["age-30to<40","education-Masters"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","age->=50","employment-Managerial"],"conclusion":["education-Bachelors","sex-Female"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","age->=50","employment-Managerial"],"conclusion":["education-HS-grad","sex-Male"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","sex-Female","education-Bachelors"],"conclusion":["age->=50","employment-Managerial"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","sex-Female","education-Bachelors"],"conclusion":["employment-Professional","age-<30"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["sex-Female","employment-Managerial"],"conclusion":["education-Bachelors","US-citizen","age->=50"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["sex-Female","employment-Managerial"],"conclusion":["age-30to<40","education-Masters"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","sex-Female","education-Bachelors"],"conclusion":["age->=50","employment-Managerial"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","sex-Female","education-Bachelors"],"conclusion":["employment-Professional","age-<30"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","age->=50","employment-Managerial"],"conclusion":["education-Bachelors","sex-Female"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","age->=50","employment-Managerial"],"conclusion":["education-HS-grad","sex-Male"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","age->=50","sex-Male"],"conclusion":["employment-Unskilled","education-11th"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","age->=50","sex-Male"],"conclusion":["education-HS-grad","employment-Managerial"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","sex-Male","age-30to<40"],"conclusion":["education-Bachelors","employment-Clerical"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","sex-Male","age-30to<40"],"conclusion":["education-HS-grad","employment-Unskilled"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","sex-Male","employment-Unskilled"],"conclusion":["education-HS-grad","age-30to<40"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","sex-Male","employment-Unskilled"],"conclusion":["education-11th","age->=50"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","age->=50","sex-Male"],"conclusion":["employment-Unskilled","education-11th"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["US-citizen","age->=50","sex-Male"],"conclusion":["education-HS-grad","employment-Managerial"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["education-HS-grad","US-citizen","sex-Male"],"conclusion":["employment-Unskilled","age-30to<40"]},{"confidence":0.5,"conclusion_supp":1,"premise_supp":2,"premise":["education-HS-grad","US-citizen","sex-Male"],"conclusion":["age->=50","employment-Managerial"]}])'),
c=["confidence","conclusion_supp","premise_supp","lift"],g={},o={};e.forEach(function(b){b.lift=b.confidence/b.conclusion_supp});var n={traits:c};n.values=e;n.traits.forEach(function(b){var c=function(c){return c[b]},c=[d3.min(n.values,c),d3.max(n.values,c)],e=[9.75,140.25];g[b]=d3.scale.linear().domain(c).range(e);o[b]=d3.scale.linear().domain(c).range(e.slice().reverse())});var q=d3.svg.axis().ticks(5).tickSize(150*c.length),b=d3.svg.brush().on("brushstart",function(c){b.data!==c&&(z.call(b.clear()),
b.x(g[c.x]).y(o[c.y]).data=c)}).on("brush",b).on("brushend",function(){b.empty()&&v.selectAll("circle").attr("class",function(){return 1});d3.select("g.brush").style("pointer-events","all").selectAll(".resize").style("display","none");d3.select("g.brush").select(".extent").style("display","none");d3.select("body").style("cursor",null);d3.selectAll("rect.background").data([]).exit().remove()}),v=d3.select("#chart").append("svg").attr("width",150*c.length+19.5).attr("height",150*c.length+19.5);v.selectAll("g.x.axis").data(n.traits).enter().append("g").attr("class",
"x axis").attr("transform",function(b,c){return"translate("+150*c+",0)"}).each(function(b){d3.select(this).call(q.scale(g[b]).orient("bottom"))});v.selectAll("g.y.axis").data(n.traits).enter().append("g").attr("class","y axis").attr("transform",function(b,c){return"translate(0,"+150*c+")"}).each(function(b){d3.select(this).call(q.scale(o[b]).orient("right"))});var z=v.selectAll("g.cell").data(function(b,c){var e=[],g=b.length,n=c.length,o,q;for(o=-1;++o<g;)for(q=-1;++q<n;)e.push({x:b[o],i:o,y:c[q],
j:q});return e}(n.traits,n.traits)).enter().append("g").attr("class","cell").attr("transform",function(b){return"translate("+150*b.i+","+150*b.j+")"}).each(function(c){var e=d3.select(this);e.append("rect").attr("class","frame").attr("x",9.75).attr("y",9.75).attr("width",130.5).attr("height",130.5);e.selectAll("circle").data(n.values).enter().append("circle").attr("class",function(){return 1}).attr("cx",function(b){return g[c.x](b[c.x])}).attr("cy",function(b){return o[c.y](b[c.y])}).attr("r",function(){return 3}).on("mouseover",
Matrix_View_MouseOver).on("mouseout",Matrix_View_MouseOut);e.call(b.x(g[c.x]).y(o[c.y]));d3.selectAll("rect.background").data([]).exit().remove()});z.filter(function(b){return b.i==b.j}).append("text").attr("x",19.5).attr("y",19.5).attr("dy",".71em").text(function(b){return b.x})};
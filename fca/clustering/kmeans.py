'''
Created on Oct 7, 2012

@author: cassiomelo
'''
#!/usr/bin/env python
import os,sys,re,csv
import numpy as np
from spectralmix import DistanceMatrix
from spectralmix import SpectralCluster
from spectralmix.DataManipLib import make_input_graph

#from GenesExample import geneList, geneLabels, geneDistDict


if __name__ == '__main__':
    
    pathways1=['path:sce00770','path:sce00514']
    geneList1=['PAN6','PAN5','ILV5','ILV6','ECM31','ILV3','ILV2','BAT2','BAT1','CAB1','CAB5','KRE2','PMT6','MNN1','KTR3','KTR1','PMT5','PMT4','MNT3','MNT2','PMT1','PMT3','PMT2']
    labels1=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1]
    edges1 = {'PMT2#MNN1': 16.081256530200001, 'PMT2#ILV6': 27.832248600500002, 'ILV2#ILV3': 50.167996973299999, 'PMT2#ILV2': 29.487790961100004, 'PMT2#ILV3': 32.555779941700003, 'PMT4#ECM31': 29.411130968599998, 'PMT1#KTR1': 17.542175092600004, 'PMT6#ECM31': 29.411130968599998, 'PMT5#MNN1': 16.081256530200001, 'PMT5#ILV3': 32.555779941700003, 'PMT5#ILV2': 29.487790961100004, 'PMT5#ILV6': 27.832248600500002, 'PMT5#ILV5': 29.816198921099996, 'PMT3#ILV3': 32.555779941700003, 'PMT3#PMT1': 51.739787395599997, 'PMT5#ECM31': 29.411130968599998, 'PMT4#MNN1': 16.081256530200001, 'KTR1#ILV3': 30.077586123499998, 'KTR1#ILV2': 27.009597143000001, 'KTR1#ILV5': 30.077586123499998, 'PMT3#KTR1': 15.675791422099998, 'KTR1#ILV6': 25.354054782299997, 'PMT4#ILV5': 29.816198921099996, 'PMT4#ILV6': 27.832248600500002, 'PMT4#ILV2': 29.487790961100004, 'PMT4#ILV3': 32.555779941700003, 'PMT6#PAN5': 51.382759600599996, 'PMT6#PAN6': 31.689412107700001, 'PMT2#KTR1': 15.675791422099998, 'KTR1#PAN6': 30.966469781900003, 'KTR1#PAN5': 52.441147088000001, 'PMT1#PMT6': 51.739787395599997, 'PMT1#PMT5': 51.739787395599997, 'PMT1#PMT4': 51.739787395599997, 'KTR1#ECM31': 28.6881886428, 'ILV5#PAN5': 49.429943713699998, 'ILV5#PAN6': 25.427569686799998, 'ILV2#ILV6': 40.231701616599999, 'ILV2#ILV5': 34.582912086, 'ILV2#ECM31': 29.271073198099998, 'MNN1#ECM31': 30.980344079799998, 'PMT3#PAN6': 31.689412107700001, 'PMT3#PAN5': 51.382759600599996, 'PMT1#ILV6': 29.698632271000001, 'PMT1#ILV5': 31.682582591599996, 'PMT1#ILV3': 34.422163612200002, 'PMT1#ILV2': 31.354174631600003, 'KTR1#PMT6': 15.675791422099998, 'ILV3#ECM31': 45.019040139099999, 'ILV6#ILV5': 30.957993033500003, 'PMT4#KTR1': 15.675791422099998, 'PMT5#KTR1': 15.675791422099998, 'PMT2#PMT1': 51.739787395599997, 'ILV2#PAN5': 49.429943713699998, 'ILV2#PAN6': 24.328957398100002, 'MNN1#ILV3': 34.124993052800001, 'MNN1#ILV2': 31.057004072300003, 'MNN1#ILV5': 31.385412032200001, 'MNN1#ILV6': 29.4014617116, 'KTR1#MNN1': 31.122972684099999, 'PMT6#ILV2': 29.487790961100004, 'PMT6#ILV3': 32.555779941700003, 'ECM31#PAN6': 42.968822408900003, 'PMT6#ILV6': 27.832248600500002, 'PMT6#ILV5': 29.816198921099996, 'ILV3#PAN6': 25.427569686799998, 'ILV3#PAN5': 49.429943713699998, 'PMT4#PAN6': 31.689412107700001, 'PMT4#PAN5': 51.382759600599996, 'PMT3#ECM31': 29.411130968599998, 'PAN5#PAN6': 49.738848160800003, 'ECM31#PAN5': 49.429943713699998, 'PMT1#ECM31': 31.277514639100005, 'PMT2#ILV5': 29.816198921099996, 'PMT1#MNN1': 17.9476402007, 'PMT2#ECM31': 29.411130968599998, 'PMT5#PAN5': 51.382759600599996, 'PMT3#MNN1': 16.081256530200001, 'PMT5#PAN6': 31.689412107700001, 'ECM31#ILV6': 25.042918310000005, 'ECM31#ILV5': 29.766449651199999, 'PMT3#ILV5': 29.816198921099996, 'PMT3#ILV6': 27.832248600500002, 'MNN1#PAN6': 33.258625218900001, 'MNN1#PAN5': 52.441147088000001, 'PMT3#ILV2': 29.487790961100004, 'PMT2#PAN5': 51.382759600599996, 'PMT2#PAN6': 31.689412107700001, 'ILV3#ILV5': 35.681524374699997, 'ILV3#ILV6': 43.970465393300003, 'MNN1#PMT6': 16.081256530200001, 'PMT1#PAN5': 52.473936910799999, 'ILV6#PAN5': 49.429943713699998, 'ILV6#PAN6': 20.704038345599997, 'PMT1#PAN6': 35.144323094299999}
    data1 = {'pathways':pathways1,'geneList': geneList1,'labels':labels1,'edges': edges1}

    
    ########################################## example 1 ##########################################
    print "Example 1 -- genes from two different biological pathways"
    k = 2         # number of clusters
    sigma = 0.14  # bandwith parameter
    
    ## put the data into graph form
    geneList = data1['geneList']
    geneDistDict = data1['edges']
    geneLabels = data1['labels']
    G = make_input_graph(geneDistDict,geneList)
    
    ## run spectral clustering on original data
    np.random.seed(1234)
    sc = SpectralCluster(G,k=k,dataHeader=geneList,labels=geneLabels,projID=os.path.join(".","temp"),                                  
                         dtype='graph',weighted=True,verbose=True,sigma=sigma,penalty=True)    
    #sc.make_plot('graph',labels=sc.clustResults['labels'],name='example1')
    centroids = sc.clustResults['centroids']                                                                                                                                
    newLabels = sc.clustResults['labels']  
    
    print "fscore", sc.evaluation['f1score'], "\n"
